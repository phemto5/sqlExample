!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(159);r.init(),console.log("Started Server "+new Date)},function(e,t){"use strict";t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.__esModule=!0},function(e,t,n){"use strict";var r=n(76).default;t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),r(e,i.key,i)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t.__esModule=!0},function(e,t){(function(){var t,n,r,i,o;t={VarChar:function(e){return{type:t.VarChar,length:e}},NVarChar:function(e){return{type:t.NVarChar,length:e}},Text:function(){return{type:t.Text}},Int:function(){return{type:t.Int}},BigInt:function(){return{type:t.BigInt}},TinyInt:function(){return{type:t.TinyInt}},SmallInt:function(){return{type:t.SmallInt}},Bit:function(){return{type:t.Bit}},Float:function(){return{type:t.Float}},Numeric:function(e,n){return{type:t.Numeric,precision:e,scale:n}},Decimal:function(e,n){return{type:t.Decimal,precision:e,scale:n}},Real:function(){return{type:t.Real}},Date:function(){return{type:t.Date}},DateTime:function(){return{type:t.DateTime}},DateTime2:function(e){return{type:t.DateTime2,scale:e}},DateTimeOffset:function(e){return{type:t.DateTimeOffset,scale:e}},SmallDateTime:function(){return{type:t.SmallDateTime}},Time:function(e){return{type:t.Time,scale:e}},UniqueIdentifier:function(){return{type:t.UniqueIdentifier}},SmallMoney:function(){return{type:t.SmallMoney}},Money:function(){return{type:t.Money}},Binary:function(e){return{type:t.Binary,length:e}},VarBinary:function(e){return{type:t.VarBinary,length:e}},Image:function(){return{type:t.Image}},Xml:function(){return{type:t.Xml}},Char:function(e){return{type:t.Char,length:e}},NChar:function(e){return{type:t.NChar,length:e}},NText:function(){return{type:t.NText}},TVP:function(e){return{type:t.TVP,tvpType:e}},UDT:function(){return{type:t.UDT}},Geography:function(){return{type:t.Geography}},Geometry:function(){return{type:t.Geometry}},Variant:function(){return{type:t.Variant}}},e.exports.TYPES=t,e.exports.DECLARATIONS={},n=function(e,t){return t.inspect=function(){return"[sql."+e+"]"}};for(r in t)i=t[r],i.declaration=r.toLowerCase(),e.exports.DECLARATIONS[i.declaration]=i,n(r,i);e.exports.declare=function(e,n){var r,i,o,a,s,u;switch(e){case t.VarChar:case t.NVarChar:case t.VarBinary:return e.declaration+" ("+(n.length>8e3?"MAX":null!=(r=n.length)?r:"MAX")+")";case t.NVarChar:return e.declaration+" ("+(n.length>4e3?"MAX":null!=(i=n.length)?i:"MAX")+")";case t.Char:case t.NChar:case t.Binary:return e.declaration+" ("+(null!=(o=n.length)?o:1)+")";case t.Decimal:case t.Numeric:return e.declaration+" ("+(null!=(a=n.precision)?a:18)+", "+(null!=(s=n.scale)?s:0)+")";case t.Time:case t.DateTime2:case t.DateTimeOffset:return e.declaration+" ("+(null!=(u=n.scale)?u:7)+")";case t.TVP:return n.tvpType+" readonly";default:return e.declaration}},e.exports.cast=function(e,t,n){var r,i,a;if(null==e)return null;switch(typeof e){case"string":return"N'"+e.replace(/'/g,"''")+"'";case"number":return e;case"boolean":return e?1:0;case"object":return e instanceof Date?(r=e.getUTCMilliseconds()/1e3,null!=e.nanosecondDelta&&(r+=e.nanosecondDelta),a=null!=(i=n.scale)?i:7,r=a>0?String(r).substr(1,a+1):"","N'"+e.getUTCFullYear()+"-"+o(e.getUTCMonth()+1)+"-"+o(e.getUTCDate())+" "+o(e.getUTCHours())+":"+o(e.getUTCMinutes())+":"+o(e.getUTCSeconds())+r+"'"):Buffer.isBuffer(e)?"0x"+e.toString("hex"):null;default:return null}},o=function(e,t){var n,r,i;if(null==t&&(t=2),e=String(e),e.length<t)for(n=r=1,i=t-e.length;1<=i?r<=i:r>=i;n=1<=i?++r:--r)e="0"+e;return e}}).call(this)},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";var r=n(77).default;t.default=function(e,t,n){for(var i=!0;i;){var o=e,a=t,s=n;i=!1,null===o&&(o=Function.prototype);var u=r(o,a);if(void 0!==u){if("value"in u)return u.value;var c=u.get;if(void 0===c)return;return c.call(s)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=a,n=s,i=!0,u=l=void 0}},t.__esModule=!0},function(e,t,n){"use strict";var r=n(75).default,i=n(78).default;t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=r(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i?i(e,t):e.__proto__=t)},t.__esModule=!0},function(e,t){t.TdsConstants=function(){function e(){}var t,n,r,i,o,a,s,u,c;for(e.versionsByVersion={"7.0":1879048192,7.1:1895825408,"7.1.1":1895825409,7.2:1913192450,"7.3.A":1930035203,"7.3.B":1930100739,7.4:1946157060},e.versionsByNumber={},a=e.versionsByVersion,r=0,i=a.length;r<i;r++)n=a[r],e.versionsByNumber[r]=n;for(e.statesByNumber=["INITIAL","CONNECTING","CONNECTED","LOGGING IN","LOGGED IN"],e.statesByName={},s=e.statesByNumber,r=0,o=s.length;r<o;r++)n=s[r],e.statesByName[n]=r;e.dataTypesByType={31:{name:"NULLTYPE",sqlType:"Null",length:0},34:{name:"IMAGETYPE",sqlType:"Image",lengthType:"int32LE",hasTableName:!0,emptyPossible:!0},35:{name:"TEXTTYPE",sqlType:"Text",lengthType:"int32LE",hasCollation:!0,hasTableName:!0,emptyPossible:!0},36:{name:"GUIDTYPE",sqlType:"UniqueIndentifier"},37:{name:"VARBINARYTYPE",sqlType:"VarBinary",lengthType:"uint16LE",legacy:!0,emptyPossible:!0},38:{name:"INTNTYPE",lengthSubstitutes:{1:48,2:52,4:56,8:127}},39:{name:"VARCHARTYPE",sqlType:"VarChar",lengthType:"uint16LE",legacy:!0,emptyPossible:!0},40:{name:"DATENTYPE",sqlType:"Date",length:3},41:{name:"TIMENTYPE",sqlType:"Time",hasScaleWithoutLength:!0},42:{name:"DATETIME2NTYPE",sqlType:"DateTime2",hasScaleWithoutLength:!0},43:{name:"DATETIMEOFFSETNTYPE",sqlType:"DateTimeOffset",hasScaleWithoutLength:!0},45:{name:"BINARYTYPE",sqlType:"Binary",lengthType:"uint16LE",legacy:!0,emptyPossible:!0},47:{name:"CHARTYPE",sqlType:"Char",lengthType:"uint16LE",legacy:!0,emptyPossible:!0},48:{name:"INT1TYPE",sqlType:"TinyInt",length:1},50:{name:"BITTYPE",sqlType:"Bit",length:1},52:{name:"INT2TYPE",sqlType:"SmallInt",length:2},55:{name:"DECIMALTYPE",sqlType:"Decimal",legacy:!0,hasScaleAndPrecision:!0},56:{name:"INT4TYPE",sqlType:"Int",length:4},58:{name:"DATETIM4TYPE",sqlType:"SmallDateTime",length:4},59:{name:"FLT4TYPE",sqlType:"Real",length:4},60:{name:"MONEYTYPE",sqlType:"Money",length:8},61:{name:"DATETIMETYPE",sqlType:"DateTime",length:8},62:{name:"FLT8TYPE",sqlType:"Float",length:8},63:{name:"NUMERICTYPE",sqlType:"Numeric",legacy:!0,hasScaleAndPrecision:!0},98:{name:"SSVARIANTTYPE",sqlType:"Sql_Variant",lengthType:"int32LE"},99:{name:"NTEXTTYPE",sqlType:"NText",lengthType:"int32LE",hasCollation:!0,hasTableName:!0,emptyPossible:!0},104:{name:"BITNTYPE",lengthSubstitutes:{0:31,1:50}},106:{name:"DECIMALNTYPE",sqlType:"Decimal",hasScaleAndPrecision:!0},108:{name:"NUMERICNTYPE",sqlType:"Numeric",hasScaleAndPrecision:!0},109:{name:"FLTNTYPE",lengthSubstitutes:{4:59,8:62}},110:{name:"MONEYNTYPE",lengthSubstitutes:{4:122,8:60}},111:{name:"DATETIMNTYPE",lengthSubstitutes:{4:58,8:61}},122:{name:"MONEY4TYPE",sqlType:"SmallMoney",length:4},127:{name:"INT8TYPE",sqlType:"BigInt",length:8},165:{name:"BIGVARBINTYPE",sqlType:"VarBinary",lengthType:"uint16LE",emptyPossible:!0},167:{name:"BIGVARCHRTYPE",sqlType:"VarChar",lengthType:"uint16LE",emptyPossible:!0,hasCollation:!0},173:{name:"BIGBINARYTYPE",sqlType:"Binary",lengthType:"uint16LE",emptyPossible:!0},175:{name:"BIGCHARTYPE",sqlType:"Char",lengthType:"uint16LE",hasCollation:!0,emptyPossible:!0},231:{name:"NVARCHARTYPE",sqlType:"NVarChar",lengthType:"uint16LE",hasCollation:!0,emptyPossible:!0},239:{name:"NCHARTYPE",sqlType:"NChar",lengthType:"uint16LE",hasCollation:!0,emptyPossible:!0},240:{name:"UDTTYPE",sqlType:"CLR-UDT"},241:{name:"XMLTYPE",sqlType:"XML"}},e.dataTypesByName={},e.dataTypesBySqlType={},u=e.dataTypesByType;for(n in u)r=u[n],r.type=n,e.dataTypesByName[r.name]=r,null==r.lengthSubstitute||r.legacy||(e.dataTypesBySqlType[r.sqlType]=r,e.dataTypesBySqlType[r.sqlType.toLowerCase()]=r);for(e.specialStoredProceduresById=["None","Sp_Cursor","Sp_CursorOpen","Sp_CursorPrepare","Sp_CursorExecute","Sp_CursorPrepExec","Sp_CursorUnprepare","Sp_CursorFetch","Sp_CursorOption","Sp_CursorClose","Sp_ExecuteSql","Sp_Prepare","Sp_Execute","Sp_PrepExec","Sp_PrepExecRpc","Sp_Unprepare"],e.specialStoredProceduresByName={},t=0,c=e.specialStoredProceduresById.length-1;0<=c?t<=c:t>=c;0<=c?t++:t--)e.specialStoredProceduresByName[e.specialStoredProceduresById[t]]=t,e.specialStoredProceduresByName[e.specialStoredProceduresById[t].toLowerCase()]=t;return e.envChangeTypesByNumber={1:{name:"Database",oldValue:"string",newValue:"string"},2:{name:"Language",oldValue:"string",newValue:"string"},3:{name:"Character Set",oldValue:"string",newValue:"string"},4:{name:"Packet Size",oldValue:"string",newValue:"string"},5:{name:"Unicode data sorting local id",newValue:"string"},6:{name:"Unicode data sorting comparison flags",newValue:"string"},7:{name:"SQL Collation",oldValue:"bytes",newValue:"bytes"},8:{name:"Begin Transaction",newValue:"bytes"},9:{name:"Commit Transaction",oldValue:"bytes",newValue:"byte"},10:{name:"Rollback Transaction",oldValue:"bytes"},11:{name:"Enlist DTC Transaction",oldValue:"bytes"},12:{name:"Defect Transaction",newValue:"bytes"},13:{name:"Database Mirroring Partner",newValue:"string"},15:{name:"Promote Transaction",newValue:"longbytes"},16:{name:"Transaction Manager Address",newValue:"bytes"},17:{name:"Transaction Ended",oldValue:"bytes"},18:{name:"Reset Completion Acknowledgement"},19:{name:"User Instance Name",newValue:"string"},20:{name:"Routing",oldValue:"2byteskip",newValue:"shortbytes"}},e}()},function(e,t){t.Token=function(){function e(){}return e}()},function(e,t){e.exports=require("buffer")},function(e,t){(function(){e.exports={READ_UNCOMMITTED:1,READ_COMMITTED:2,REPEATABLE_READ:3,SERIALIZABLE:4,SNAPSHOT:5}}).call(this)},function(e,t,n){"use strict";function r(e){return this instanceof r?(c.call(this,e),l.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",i)):new r(e)}function i(){this.allowHalfOpen||this._writableState.ended||s(o,this)}function o(e){e.end()}var a=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var s=n(34),u=n(15);u.inherits=n(16);var c=n(54),l=n(56);u.inherits(r,c);for(var h=a(l.prototype),f=0;f<h.length;f++){var p=h[f];r.prototype[p]||(r.prototype[p]=l.prototype[p])}},function(e,t,n){t.Packet=function(){function e(){}return e.retrieveHeader=function(e,t){var n;return n={type:e.readByte(),status:e.readByte(),length:e.readUInt16BE(),processId:e.readUInt16BE(),packetId:e.readByte(),window:e.readByte()},t.logDebug&&console.log("Retrieved header: ",n),n},e.prototype.fromBuffer=function(e,t){throw new Error("Unimplemented")},e.prototype.toBuffer=function(e,t){throw new Error("Unimplemented")},e.prototype.insertPacketHeader=function(e,t,n){return null==n&&(n=!0),t.logDebug&&console.log("Inserting header for type: ",this.type),e.insertByte(this.type,0),e.insertByte(n?1:0,1),e.insertUInt16BE(e.length+6,2),e.insertUInt16BE(0,3),e.insertByte(1,4),e.insertByte(0,5),e},e.prototype.buildTransactionDescriptorAllHeader=function(e,t){return{type:2,transactionDescriptor:e,outstandingRequestCount:t}},e.prototype.insertAllHeaders=function(e,t,n){var r,i,o,a,s;for(o=0,i=0,a=0,s=n.length;a<s;a++)switch(r=n[a],r.type){case 2:i+=12,e.insertUInt32LE(12,o),o+=4,e.insertUInt16LE(r.type,o),o+=2,e.insertUInt32LE(r.transactionDescriptor%4294967296,o),o+=4,e.insertUInt32LE(r.transactionDescriptor/4294967296,o),o+=4,e.insertUInt32LE(r.outstandingRequestCount,o),o+=4;break;default:throw new Error("Unsupported all header type "+r.type)}return e.insertUInt32LE(i+4,0)},e.prototype.toString=function(){var e,t,r,i;t="",r=n(5);for(e in this)i=this[e],"function"!=typeof i&&(""!==t&&(t+=", "),t+=e+": "+r.format(i));return t},e}()},function(e,t){e.exports=require("stream")},function(e,t){function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===m(e)}function r(e){return"boolean"==typeof e}function i(e){return null===e}function o(e){return null==e}function a(e){return"number"==typeof e}function s(e){return"string"==typeof e}function u(e){return"symbol"==typeof e}function c(e){return void 0===e}function l(e){return"[object RegExp]"===m(e)}function h(e){return"object"==typeof e&&null!==e}function f(e){return"[object Date]"===m(e)}function p(e){return"[object Error]"===m(e)||e instanceof Error}function d(e){return"function"==typeof e}function g(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function m(e){return Object.prototype.toString.call(e)}t.isArray=n,t.isBoolean=r,t.isNull=i,t.isNullOrUndefined=o,t.isNumber=a,t.isString=s,t.isSymbol=u,t.isUndefined=c,t.isRegExp=l,t.isObject=h,t.isDate=f,t.isError=p,t.isFunction=d,t.isPrimitive=g,t.isBuffer=Buffer.isBuffer},function(e,t,n){try{var r=n(5);if("function"!=typeof r.inherits)throw"";e.exports=r.inherits}catch(t){e.exports=n(110)}},function(e,t){(function(){var e,n,r,i,o,a,s,u,c,l,h,f,p;e={INTERIOR_RING:0,STROKE:1,EXTERIOR_RING:2},n={POINT:0,LINE:1,ARC:2,COMPOSITE_CURVE:3},o={POINT:1,LINESTRING:2,POLYGON:3,MULTIPOINT:4,MULTILINESTRING:5,MULTIPOLYGON:6,GEOMETRY_COLLECTION:7},a={POINT:1,LINESTRING:2,POLYGON:3,MULTIPOINT:4,MULTILINESTRING:5,MULTIPOLYGON:6,GEOMETRY_COLLECTION:7,CIRCULAR_STRING:8,COMPOUND_CURVE:9,CURVE_POLYGON:10,FULL_GLOBE:11},i={LINE:0,ARC:1,FIRST_LINE:2,FIRST_ARC:3},r=function(){function e(){}return e.prototype.x=0,e.prototype.y=0,e.prototype.z=null,e.prototype.m=null,e}(),u=function(e,t){var n,r,i,o,a,u,d,g;return null==t&&(t=!1),d=e.readInt32LE(0),d===-1?null:(g={srid:d,version:e.readUInt8(4)},n=e.readUInt8(5),e.position=6,u={Z:!!(1&n),M:!!(2&n),V:!!(4&n),P:!!(8&n),L:!!(16&n)},2===g.version&&(u.H=!!(8&n)),u.P?i=1:u.L?i=2:(i=e.readUInt32LE(e.position),e.position+=4),g.points=l(e,i),u.Z&&p(e,g.points),u.M&&c(e,g.points),u.P?r=1:u.L?r=1:(r=e.readUInt32LE(e.position),e.position+=4),g.figures=s(e,r,u),u.P?a=1:u.L?a=1:(a=e.readUInt32LE(e.position),e.position+=4),g.shapes=f(e,a,u),2===g.version?(o=e.readUInt32LE(e.position),e.position+=4,g.segments=h(e,o)):g.segments=[],g)},l=function(e,t){var n,i,o,a,s;if(a=[],t<1)return a;for(n=i=1,s=t;1<=s?i<=s:i>=s;n=1<=s?++i:--i)a.push(o=new r),o.x=e.readDoubleLE(e.position),o.y=e.readDoubleLE(e.position+8),e.position+=16;return a},p=function(e,t){var n,r,i,o;if(!(t<1)){for(o=[],n=0,r=t.length;n<r;n++)i=t[n],i.z=e.readDoubleLE(e.position),o.push(e.position+=8);return o}},c=function(e,t){var n,r,i,o;if(!(t<1)){for(o=[],n=0,r=t.length;n<r;n++)i=t[n],i.m=e.readDoubleLE(e.position),o.push(e.position+=8);return o}},s=function(e,t,n){var r,i,o,a;if(r=[],t<1)return r;if(n.P)r.push({attribute:1,pointOffset:0});else if(n.L)r.push({attribute:1,pointOffset:0});else for(i=o=1,a=t;1<=a?o<=a:o>=a;i=1<=a?++o:--o)r.push({attribute:e.readUInt8(e.position),pointOffset:e.readInt32LE(e.position+1)}),e.position+=5;return r},f=function(e,t,n){var r,i,o,a;if(a=[],t<1)return a;if(n.P)a.push({parentOffset:-1,figureOffset:0,type:1});else if(n.L)a.push({parentOffset:-1,figureOffset:0,type:2});else for(r=i=1,o=t;1<=o?i<=o:i>=o;r=1<=o?++i:--i)a.push({parentOffset:e.readInt32LE(e.position),figureOffset:e.readInt32LE(e.position+4),type:e.readUInt8(e.position+8)}),e.position+=9;return a},h=function(e,t){var n,r,i,o;if(o=[],t<1)return o;for(n=r=1,i=t;1<=i?r<=i:r>=i;n=1<=i?++r:--r)o.push({type:e.readUInt8(e.position)}),e.position++;return o},t.PARSERS={geography:function(e){return u(e)},geometry:function(e){return u(e,!0)}}}).call(this)},function(e,t){var n=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.object_stringify=function(e,t,n,i){var o="";if(null!=e)switch(typeof e){case"function":return"[Function"+(e.name?": "+e.name:"")+"]";case"object":if(e instanceof Error)return"["+e.toString()+"]";if(t>=n)return"[Object]";if(i&&(i=i.slice(0),i.push(e)),null!=e.length){o+="[";var a=[];for(var s in e)i&&i.indexOf(e[s])>=0?a.push("[Circular]"):a.push(r.object_stringify(e[s],t+1,n,i));o+=a.join(", ")+"]"}else{if("getMonth"in e)return"Date("+e+")";o+="{";var a=[];for(var u in e)e.hasOwnProperty(u)&&(i&&i.indexOf(e[u])>=0?a.push(u+": [Circular]"):a.push(u+": "+r.object_stringify(e[u],t+1,n,i)));o+=a.join(", ")+"}"}return o;case"string":return'"'+e+'"'}return""+e},r.format=function(i,o){var a,s,u,c,l,h,f,p=1,d=i.length,g="",m=[];for(s=0;s<d;s++)if(g=e(i[s]),"string"===g)m.push(i[s]);else if("array"===g){if(c=i[s],c[2])for(a=o[p],u=0;u<c[2].length;u++){if(!a.hasOwnProperty(c[2][u]))throw new Error(n('[sprintf] property "%s" does not exist',c[2][u]));a=a[c[2][u]]}else a=c[1]?o[c[1]]:o[p++];if(/[^sO]/.test(c[8])&&"number"!=e(a))throw new Error(n('[sprintf] expecting number but found %s "'+a+'"',e(a)));switch(c[8]){case"b":a=a.toString(2);break;case"c":a=String.fromCharCode(a);break;case"d":a=parseInt(a,10);break;case"e":a=c[7]?a.toExponential(c[7]):a.toExponential();break;case"f":a=c[7]?parseFloat(a).toFixed(c[7]):parseFloat(a);break;case"O":a=r.object_stringify(a,0,parseInt(c[7])||5);break;case"o":a=a.toString(8);break;case"s":a=(a=String(a))&&c[7]?a.substring(0,c[7]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}a=/[def]/.test(c[8])&&c[3]&&a>=0?"+"+a:a,h=c[4]?"0"==c[4]?"0":c[4].charAt(1):" ",f=c[6]-String(a).length,l=c[6]?t(h,f):"",m.push(c[5]?a+l:l+a)}return m.join("")},r.cache={},r.parse=function(e){for(var t=e,n=[],r=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosOuxX])/.exec(t)))throw new Error("[sprintf] "+t);if(n[2]){i|=1;var o=[],a=n[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw new Error("[sprintf] "+a);for(o.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))o.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw new Error("[sprintf] "+a);o.push(s[1])}n[2]=o}else i|=2;if(3===i)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}t=t.substring(n[0].length)}return r},r}(),r=function(e,t){var r=t.slice();return r.unshift(e),n.apply(null,r)};e.exports=n,n.sprintf=n,n.vsprintf=r},function(e,t){"use strict";Buffer.concat||(Buffer.concat=function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e[r];n+=i.length}for(var o=new Buffer(n),a=0,r=0;r<t;r++){var i=e[r];i.copy(o,a,0),a+=i.length}return o}),Buffer.prototype.toByteArray=function(){return Array.prototype.slice.call(this,0)},Buffer.prototype.equals=function(e){if(this.length!==e.length)return!1;for(var t=0,n=this.length;t<n;t++)if(this[t]!==e[t])return!1;return!0}},function(e,t,n){"use strict";function r(e,t,n){if(32===(48&t.id)){if(t.dataLengthFromScale)return n(0);if(t.fixedDataLength)return n(t.fixedDataLength);switch(t.dataLengthLength){case 0:return n(void 0);case 1:return e.readUInt8(n);case 2:return e.readUInt16LE(n);case 4:return e.readUInt32LE(n);default:return e.emit(new Error("Unsupported dataLengthLength "+t.dataLengthLength+" for data type "+t.name))}}else n(void 0)}function i(e,t,n){t.hasPrecision?e.readUInt8(n):n(void 0)}function o(e,t,n){t.hasScale?e.readUInt8(n):n(void 0)}function a(e,t,n){t.hasCollation?e.readBuffer(5,function(e){var t={};t.lcid=(15&e[2])<<16,t.lcid|=e[1]<<8,t.lcid|=e[0],t.flags=e[3]>>4,t.flags|=240&e[2],t.version=15&e[3],t.sortId=e[4],t.codepage=l[t.sortId]||h[t.lcid]||"CP1252",n(t)}):n(void 0)}function s(e,t,n){t.hasSchemaPresent?e.readUInt8(function(t){1===t?e.readBVarChar(function(t){e.readBVarChar(function(r){e.readUsVarChar(function(e){n({dbname:t,owningSchema:r,xmlSchemaCollection:e})})})}):n(void 0)}):n(void 0)}function u(e,t,n){return t.hasUDTInfo?void e.readUInt16LE(function(t){e.readBVarChar(function(r){e.readBVarChar(function(i){e.readBVarChar(function(o){e.readUsVarChar(function(e){n({maxByteSize:t,dbname:r,owningSchema:i,typeName:o,assemblyName:e})})})})})}):n()}function c(e,t,n){(t.tdsVersion<"7_2"?e.readUInt16LE:e.readUInt32LE).call(e,function(t){e.readUInt16LE(function(c){e.readUInt8(function(l){var h=f[l];return h?void r(e,h,function(r){i(e,h,function(i){o(e,h,function(o){o&&h.dataLengthFromScale&&(r=h.dataLengthFromScale(o)),a(e,h,function(a){s(e,h,function(s){u(e,h,function(e){n({userType:t,flags:c,type:h,collation:a,precision:i,scale:o,dataLength:r,schema:s,udtInfo:e})})})})})})}):e.emit(new Error(p("Unrecognised data type 0x%02X",l)))})})})}var l=n(66).codepageBySortId,h=n(66).codepageByLcid,f=n(25).TYPE,p=n(18).sprintf;e.exports=c,e.exports.readPrecision=i,e.exports.readScale=o,e.exports.readCollation=a},function(e,t){var n=Object;e.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},function(e,t){function n(e){if(!(this instanceof n))return new n;this._size=e,this._slots=null,this._total=null,e=Math.max(0|+e,1),this._slots=[];for(var t=0;t<e;t+=1)this._slots.push([])}function r(e,t,n){var r=function(){e()?t(r):n()};r()}function i(e){if(!(this instanceof i))return new i(e);if(e.validate&&e.validateAsync)throw new Error("Only one of validate or validateAsync may be specified");e.idleTimeoutMillis=e.idleTimeoutMillis||3e4,e.returnToHead=e.returnToHead||!1,e.refreshIdle=!("refreshIdle"in e)||e.refreshIdle,e.reapInterval=e.reapIntervalMillis||1e3,e.priorityRange=e.priorityRange||1,e.validate=e.validate||function(){return!0},e.max=parseInt(e.max,10),e.min=parseInt(e.min,10),e.max=Math.max(isNaN(e.max)?1:e.max,1),e.min=Math.min(isNaN(e.min)?0:e.min,e.max-1),this._factory=e,this._inUseObjects=[],this._draining=!1,this._waitingClients=new n(e.priorityRange),this._availableObjects=[],this._count=0,this._removeIdleTimer=null,this._removeIdleScheduled=!1,this._ensureMinimum()}function o(e){"function"==typeof setImmediate?setImmediate(e):setTimeout(e,0)}n.prototype.size=function(){if(null===this._total){this._total=0;for(var e=0;e<this._size;e+=1)this._total+=this._slots[e].length}return this._total},n.prototype.enqueue=function(e,t){var n;t=t&&0|+t||0,this._total=null,t&&(n=t,(t<0||t>=this._size)&&(t=this._size-1,console.error("invalid priority: "+n+" must be between 0 and "+t))),this._slots[t].push(e)},n.prototype.dequeue=function(e){var t=null;this._total=null;for(var n=0,r=this._slots.length;n<r;n+=1)if(this._slots[n].length){t=this._slots[n].shift();break}return t},i.prototype._log=function(e,t){"function"==typeof this._factory.log?this._factory.log(e,t):this._factory.log&&console.log(t.toUpperCase()+" pool "+this._factory.name+" - "+e)},i.prototype.destroy=function(e){this._count-=1,this._count<0&&(this._count=0),this._availableObjects=this._availableObjects.filter(function(t){return t.obj!==e}),this._inUseObjects=this._inUseObjects.filter(function(t){return t!==e}),this._factory.destroy(e),this._ensureMinimum()},i.prototype._removeIdle=function(){var e,t,n=[],r=(new Date).getTime(),i=this._availableObjects.length,o=this._factory.refreshIdle,a=this._count-this._factory.min;for(this._removeIdleScheduled=!1,e=0;e<i&&(o||a>n.length);e++)t=this._availableObjects[e].timeout,r>=t&&(this._log("removeIdle() destroying obj - now:"+r+" timeout:"+t,"verbose"),n.push(this._availableObjects[e].obj));n.forEach(this.destroy,this),i=this._availableObjects.length,i>0?(this._log("this._availableObjects.length="+i,"verbose"),this._scheduleRemoveIdle()):this._log("removeIdle() all objects removed","verbose")},i.prototype._scheduleRemoveIdle=function(){var e=this;this._removeIdleScheduled||(this._removeIdleScheduled=!0,this._removeIdleTimer=setTimeout(function(){e._removeIdle()},this._factory.reapInterval))},i.prototype._dispense=function(){var e=this,t=null,n=null,i=null,o=this._waitingClients.size();if(this._log("dispense() clients="+o+" available="+this._availableObjects.length,"info"),o>0){if(this._factory.validateAsync)return void r(function(){return e._availableObjects.length>0},function(r){e._log("dispense() - reusing obj","verbose"),t=e._availableObjects[0],e._factory.validateAsync(t.obj,function(o){o?(e._availableObjects.shift(),e._inUseObjects.push(t.obj),(i=e._waitingClients.dequeue())(n,t.obj)):(e.destroy(t.obj),r())})},function(){e._count<e._factory.max&&e._createResource()});for(;this._availableObjects.length>0;){if(this._log("dispense() - reusing obj","verbose"),t=this._availableObjects[0],this._factory.validate(t.obj))return this._availableObjects.shift(),this._inUseObjects.push(t.obj),(i=this._waitingClients.dequeue())(n,t.obj);this.destroy(t.obj)}this._count<this._factory.max&&this._createResource()}},i.prototype._createResource=function(){this._count+=1,this._log("createResource() - creating obj - count="+this._count+" min="+this._factory.min+" max="+this._factory.max,"verbose");var e=this;this._factory.create(function(){var t,n,r=e._waitingClients.dequeue();arguments.length>1?(t=arguments[0],n=arguments[1]):(t=arguments[0]instanceof Error?arguments[0]:null,n=arguments[0]instanceof Error?null:arguments[0]),t?(e._count-=1,e._count<0&&(e._count=0),r&&r(t,n),process.nextTick(function(){e._dispense()})):(e._inUseObjects.push(n),r?r(t,n):e.release(n))})},i.prototype._ensureMinimum=function(){var e,t;if(!this._draining&&this._count<this._factory.min)for(t=this._factory.min-this._count,e=0;e<t;e++)this._createResource()},i.prototype.acquire=function(e,t){if(this._draining)throw new Error("pool is draining and cannot accept work");return process.domain&&(e=process.domain.bind(e)),this._waitingClients.enqueue(e,t),this._dispense(),this._count<this._factory.max},i.prototype.borrow=function(e,t){this._log("borrow() is deprecated. use acquire() instead","warn"),this.acquire(e,t)},i.prototype.release=function(e){if(this._availableObjects.some(function(t){return t.obj===e}))return void this._log("release called twice for the same resource: "+(new Error).stack,"error");var t=this._inUseObjects.indexOf(e);if(t<0)return void this._log("attempt to release an invalid resource: "+(new Error).stack,"error");this._inUseObjects.splice(t,1);var n={obj:e,timeout:(new Date).getTime()+this._factory.idleTimeoutMillis};this._factory.returnToHead?this._availableObjects.splice(0,0,n):this._availableObjects.push(n),this._log("timeout: "+n.timeout,"verbose"),this._dispense(),this._scheduleRemoveIdle()},i.prototype.returnToPool=function(e){this._log("returnToPool() is deprecated. use release() instead","warn"),this.release(e)},i.prototype.drain=function(e){this._log("draining","info"),this._draining=!0;var t=this,n=function(){t._waitingClients.size()>0?setTimeout(n,100):t._availableObjects.length!==t._count?setTimeout(n,100):e&&o(e)};n()},i.prototype.destroyAllNow=function(e){this._log("force destroying all objects","info");var t=this._availableObjects;this._availableObjects=[];for(var n=t.shift();null!==n&&void 0!==n;)this.destroy(n.obj),n=t.shift();this._removeIdleScheduled=!1,clearTimeout(this._removeIdleTimer),e&&o(e)},i.prototype.pooled=function(e,t){var n=this;return function(){var r=arguments,i=r[r.length-1],o="function"==typeof i;n.acquire(function(t,a){if(t)return void(o&&i(t));var s=[a].concat(Array.prototype.slice.call(r,0,o?-1:void 0));s.push(function(){n.release(a),o&&i.apply(null,arguments)}),e.apply(null,s)},t)}},i.prototype.getPoolSize=function(){return this._count},i.prototype.getName=function(){return this._factory.name},i.prototype.availableObjectsCount=function(){return this._availableObjects.length},i.prototype.inUseObjectsCount=function(){return this._inUseObjects.length},i.prototype.waitingClientsCount=function(){return this._waitingClients.size()},i.prototype.getMaxPoolSize=function(){return this._factory.max},i.prototype.getMinPoolSize=function(){return this._factory.min},t.Pool=i},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l,h,f,p,d,g,m,v,y,b,E,w,_,T,I,S,L=function(e,t){function n(){this.constructor=e}for(var r in t)N.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},N={}.hasOwnProperty,C=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},k=[].slice,U=function(e,t){return function(){return e.apply(t,arguments)}};a=n(4).EventEmitter,I=n(5),v=n(43),_=n(3),f=_.TYPES,m=_.declare,s=n(11),o=["msnodesql","tedious","tds","msnodesqlv8"],p=n(24),i=n(32),b=null,w=[],w.register=function(e,t){var n,r,i,o;for(r=n=0,o=this.length;n<o;r=++n)if(i=this[r],i.js===e){this.splice(r,1);break}return this.push({js:e,sql:t}),null},w.register(String,f.NVarChar),w.register(Number,f.Int),w.register(Boolean,f.Bit),w.register(Date,f.DateTime),w.register(Buffer,f.VarBinary),w.register(p,f.TVP),y=function(e){var t,n,r,i,o,a,s,u,c;if(null===e||void 0===e)return f.NVarChar;switch(typeof e){case"string":for(t=0,a=w.length;t<a;t++)if(n=w[t],n.js===String)return n.sql;return f.NVarChar;case"number":for(r=0,s=w.length;r<s;r++)if(n=w[r],n.js===Number)return n.sql;return f.Int;case"boolean":for(i=0,u=w.length;i<u;i++)if(n=w[i],n.js===Boolean)return n.sql;return f.Bit;case"object":for(o=0,c=w.length;o<c;o++)if(n=w[o],e instanceof n.js)return n.sql;return f.NVarChar;default:return f.NVarChar}},t=function(t){function a(t,a){var s,u,c,l,h,f,p,d;if(this.config=t,"string"==typeof this.config)try{this.config=i.resolve(this.config)}catch(e){if(p=e,a)return a(p);throw p}if(null==(s=this.config).driver&&(s.driver="tedious"),null==(u=this.config).port&&(u.port=1433),null==(c=this.config).options&&(c.options={}),null==(l=this.config).stream&&(l.stream=!1),null==(h=this.config).parseJSON&&(h.parseJSON=!1),/^(.*)\\(.*)$/.exec(this.config.server)&&(this.config.server=RegExp.$1,this.config.options.instanceName=RegExp.$2),d=this.config.driver,!(C.call(o,d)>=0)){if(f=new r("Unknown driver "+this.config.driver+"!","EDRIVER"),a)return a(f);throw f}this.driver=this.initializeDriver(n(119)("./"+this.config.driver)),e.exports.fix&&this.driver.fix(),a&&this.connect(a)}return L(a,t),a.prototype.connected=!1,a.prototype.connecting=!1,a.prototype.driver=null,a.prototype._debug=function(e){var t;return null!=(t=this._debugStream)?t.write(String(e).replace(/\x1B\[[0-9;]*m/g,"")+"\n"):void 0},a.prototype.initializeDriver=function(e){return e(a,d,l,r,g,h)},a.prototype.connect=function(t){return null!=t?this._connect(t):new e.exports.Promise(function(e){return function(t,n){return e._connect(function(r){return r?n(r):t(e)})}}(this))},a.prototype._connect=function(e){var t;return this.driver?this.connected?e(new r("Database is already connected! Call close before connecting to different database.","EALREADYCONNECTED")):this.connecting?e(new r("Already connecting to database! Call close before connecting to different database.","EALREADYCONNECTING")):(t=function(t){return function(){return t.connecting=!0,t.driver.Connection.prototype.connect.call(t,t.config,function(n){if(t.connecting)return t.connecting=!1,n?t._debugStream&&(t._debugStream.removeAllListeners(),t._debugStream.end(),t._debugStream=null):(t.connected=!0,t.emit("connect")),e(n)})}}(this),this.config.debug?(this._debugStream=v.createWriteStream("./mssql_debug_"+Date.now()+".log"),this._debugStream.once("open",t),this._debugStream.on("error",function(n){return this.connecting||this.connected?console.error(n.stack):(this._debugStream.removeListener("open",t),
e(new r("Failed to open debug stream. "+n.message,"EDEBUG")))})):t(),this):e(new r("Connection was closed. Create a new instance."))},a.prototype.close=function(t){return null!=t?this._close(t):new e.exports.Promise(function(e){return function(t,n){return e._close(function(e){return e?n(e):t()})}}(this))},a.prototype._close=function(e){return this._debugStream&&(this._debugStream.removeAllListeners(),this._debugStream.end(),this._debugStream=null),this.connecting?(this.connecting=!1,this.driver.Connection.prototype.close.call(this,function(t){return function(t){return e(t)}}(this)),this.driver=null):this.connected&&(this.connected=!1,this.driver.Connection.prototype.close.call(this,function(t){return function(n){return n||(t.connected=!1,t.emit("close")),e(n)}}(this)),this.driver=null),this},a.prototype.request=function(){return new l(this)},a.prototype.transaction=function(){return new d(this)},a.prototype.query=function(){var e,t;return e=arguments[0],t=2<=arguments.length?k.call(arguments,1):[],new l(this)._template("query",e,t)},a.prototype.batch=function(){var e,t;return e=arguments[0],t=2<=arguments.length?k.call(arguments,1):[],new l(this)._template("batch",e,t)},a}(a),u=function(n){function r(e){e instanceof d?(this.transaction=e,this.connection=e.connection):e instanceof t?this.connection=e:this.connection=b,this._queue=[],this.parameters={}}return L(r,n),r.prototype._pooledConnection=null,r.prototype._queue=null,r.prototype._working=!1,r.prototype._handle=0,r.prototype.connection=null,r.prototype.transaction=null,r.prototype.prepared=!1,r.prototype.statement=null,r.prototype.parameters=null,r.prototype.multiple=!1,r.prototype.stream=null,r.prototype.lastRequest=null,r.prototype.input=function(e,t){if(/(--| |\/\*|\*\/|')/.test(e))throw new c("SQL injection warning for param '"+e+"'","EINJECT");if(arguments.length<2)throw new c("Invalid number of arguments. 2 arguments expected.","EARGS");return t instanceof Function&&(t=t()),this.parameters[e]={name:e,type:t.type,io:1,length:t.length,scale:t.scale,precision:t.precision,tvpType:t.tvpType},this},r.prototype.output=function(e,t){if(/(--| |\/\*|\*\/|')/.test(e))throw new c("SQL injection warning for param '"+e+"'","EINJECT");if(arguments.length<2)throw new c("Invalid number of arguments. 2 arguments expected.","EARGS");return t instanceof Function&&(t=t()),this.parameters[e]={name:e,type:t.type,io:2,length:t.length,scale:t.scale,precision:t.precision},this},r.prototype.prepare=function(t,n){return null!=n?this._prepare(t,n):new e.exports.Promise(function(e){return function(n,r){return e._prepare(t,function(t){return t?r(t):n(e)})}}(this))},r.prototype._prepare=function(e,t){var n;if(this._pooledConnection)return t(new c("Statement is already prepared.","EALREADYPREPARED")),this;if("function"==typeof e&&(t=e,e=void 0),null!=e&&(this.statement=e),n=function(e){return function(n,r){var i,o,a;return n?t(n):(e._pooledConnection=r,a=new l(e),a.stream=!1,a.output("handle",f.Int),a.input("params",f.NVarChar,function(){var e,t;e=this.parameters,t=[];for(i in e)o=e[i],t.push("@"+i+" "+m(o.type,o)+(2===o.io?" output":""));return t}.call(e).join(",")),a.input("stmt",f.NVarChar,e.statement),a.execute("sp_prepare",function(n){return n?(e.transaction?e.transaction.next():(e.connection.pool.release(e._pooledConnection),e._pooledConnection=null),t(n)):(e._handle=a.parameters.handle.value,t(null))}))}}(this),this.transaction){if(!this.transaction._pooledConnection)return t(new g("Transaction has not begun. Call begin() first.","ENOTBEGUN")),this;this.transaction.queue(n)}else this.connection.pool.acquire(n);return this},r.prototype.next=function(){return this._queue.length?process.nextTick(function(e){return function(){return e._queue.shift()(null,e._pooledConnection)}}(this)):this._working=!1,this},r.prototype.queue=function(e){return this._pooledConnection?(this._working?this._queue.push(e):(this._working=!0,e(null,this._pooledConnection)),this):(e(new c("Statement is not prepared. Call prepare() first.","ENOTPREPARED")),this)},r.prototype.execute=function(t,n){return null!=n?this._execute(t,n):new e.exports.Promise(function(e){return function(n,r){return e._execute(t,function(e,t){return e?r(e):n(t)})}}(this))},r.prototype._execute=function(e,t){var n,r,i,o;o=this.lastRequest=new l(this),null!=this.stream&&(o.stream=this.stream),o.input("handle",f.Int,this._handle),i=this.parameters;for(n in i)r=i[n],o.parameters[n]={name:n,type:r.type,io:r.io,value:e[n],length:r.length,scale:r.scale,precision:r.precision};return o.execute("sp_execute",function(e){return function(n,r,i){return n?t(n):t(null,e.multiple?r:r[0],o.rowsAffected)}}(this)),o},r.prototype.unprepare=function(t){return null!=t?this._unprepare(t):new e.exports.Promise(function(e){return function(t,n){return e._unprepare(function(e){return e?n(e):t()})}}(this))},r.prototype._unprepare=function(e){var t,n;return this._pooledConnection?(t=function(t){return function(n){return n?e(n):(t.transaction?t.transaction.next():(t.connection.pool.release(t._pooledConnection),t._pooledConnection=null),t._handle=0,e(null))}}(this),n=new l(this),n.stream=!1,n.input("handle",f.Int,this._handle),n.execute("sp_unprepare",t),this):(e(new c("Statement is not prepared. Call prepare() first.","ENOTPREPARED")),this)},r}(a),d=function(t){function n(e){this._abort=U(this._abort,this),this.connection=null!=e?e:b,this._queue=[]}return L(n,t),n.prototype._pooledConnection=null,n.prototype._queue=null,n.prototype._aborted=!1,n.prototype._working=!1,n.prototype.name="",n.prototype.connection=null,n.prototype.isolationLevel=s.READ_COMMITTED,n.prototype._abort=function(){return this.connection.driver.Transaction.prototype._abort.call(this)},n.prototype.begin=function(t,n){return t instanceof Function&&(n=t,t=void 0),null!=n?this._begin(t,n):new e.exports.Promise(function(e){return function(n,r){return e._begin(t,function(t){return t?r(t):n(e)})}}(this))},n.prototype._begin=function(e,t){return null!=e&&(this.isolationLevel=e),this._pooledConnection?(t(new g("Transaction has already begun.","EALREADYBEGUN")),this):(this.connection.driver.Transaction.prototype.begin.call(this,function(e){return function(n){return n||e.emit("begin"),t(n)}}(this)),this)},n.prototype.commit=function(t){return null!=t?this._commit(t):new e.exports.Promise(function(e){return function(t,n){return e._commit(function(e){return e?n(e):t()})}}(this))},n.prototype._commit=function(e){return this._pooledConnection?this._working?(e(new g("Can't commit transaction. There is a request in progress.","EREQINPROG")),this):this._queue.length?(e(new g("Can't commit transaction. There are request in queue.","EREQINPROG")),this):(this.connection.driver.Transaction.prototype.commit.call(this,function(t){return function(n){return n||t.emit("commit"),e(n)}}(this)),this):(e(new g("Transaction has not begun. Call begin() first.","ENOTBEGUN")),this)},n.prototype.next=function(){var e;return this._aborted&&(e=this._queue,this._queue=[],process.nextTick(function(t){return function(){var t;for(t=[];e.length;)t.push(e.shift()(new g("Transaction aborted.","EABORT")));return t}}(this))),this._working=!1,this._queue.length&&process.nextTick(function(e){return function(){return e._aborted?e.next():(e._working=!0,e._queue.shift()(null,e._pooledConnection))}}(this)),this},n.prototype.queue=function(e){return this._pooledConnection?(this._working||this._queue.length?this._queue.push(e):(this._working=!0,e(null,this._pooledConnection)),this):(e(new g("Transaction has not begun. Call begin() first.","ENOTBEGUN")),this)},n.prototype.request=function(){return new l(this)},n.prototype.rollback=function(t){return null!=t?this._rollback(t):new e.exports.Promise(function(e){return function(t,n){return e._rollback(function(e){return e?n(e):t()})}}(this))},n.prototype._rollback=function(e){return this._aborted?(e(new g("Transaction has been aborted.","EABORT")),this):this._pooledConnection?this._working?(e(new g("Can't rollback transaction. There is a request in progress.","EREQINPROG")),this):(this._queue.length&&(this._aborted=!0),this.connection.driver.Transaction.prototype.rollback.call(this,function(t){return function(n){return n||t.emit("rollback",t._aborted),e(n)}}(this)),this):(e(new g("Transaction has not begun. Call begin() first.","ENOTBEGUN")),this)},n}(a),l=function(n){function i(e){e instanceof d?(this.transaction=e,this.connection=e.connection):e instanceof u?(this.pstatement=e,this.connection=e.connection):e instanceof t?this.connection=e:this.connection=b,this.parameters={}}return L(i,n),i.prototype.connection=null,i.prototype.transaction=null,i.prototype.pstatement=null,i.prototype.parameters=null,i.prototype.verbose=!1,i.prototype.multiple=!1,i.prototype.canceled=!1,i.prototype.stream=null,i.prototype.rowsAffected=null,i.prototype._log=function(e){return"function"==typeof this.logger?this.logger(e):console.log(e)},i.prototype._template=function(e,t,n){var r,i,o,a,s;for(r=[t[0]],o=i=0,a=n.length;i<a;o=++i)s=n[o],this.input("param"+(o+1),s),r.push("@param"+(o+1),t[o+1]);return this[e](r.join(""))},i.prototype._acquire=function(e){return this.transaction?this.transaction.queue(e):this.pstatement?this.pstatement.queue(e):this.connection.pool?this.connection.pool.acquire(e):e(new r("Connection not yet open.","ENOTOPEN"))},i.prototype._dedicated=function(e){return this._acquire=function(t){return t(null,e)},this._release=function(){},this},i.prototype._release=function(e){return this.transaction?this.transaction.next():this.pstatement?this.pstatement.next():this.connection.pool.release(e)},i.prototype.input=function(e,t,n){if(/(--| |\/\*|\*\/|')/.test(e))throw new h("SQL injection warning for param '"+e+"'","EINJECT");if(1===arguments.length)throw new h("Invalid number of arguments. At least 2 arguments expected.","EARGS");return 2===arguments.length&&(n=t,t=y(n)),null==n||!n.valueOf||n instanceof Date||(n=n.valueOf()),void 0===n&&(n=null),n!==n&&(n=null),t instanceof Function&&(t=t()),this.parameters[e]={name:e,type:t.type,io:1,value:n,length:t.length,scale:t.scale,precision:t.precision,tvpType:t.tvpType},this},i.prototype.output=function(e,t,n){if(t||(t=f.NVarChar),/(--| |\/\*|\*\/|')/.test(e))throw new h("SQL injection warning for param '"+e+"'","EINJECT");if(t===f.Text||t===f.NText||t===f.Image)throw new h("Deprecated types (Text, NText, Image) are not supported as OUTPUT parameters.","EDEPRECATED");return null==n||!n.valueOf||n instanceof Date||(n=n.valueOf()),void 0===n&&(n=null),n!==n&&(n=null),t instanceof Function&&(t=t()),this.parameters[e]={name:e,type:t.type,io:2,value:n,length:t.length,scale:t.scale,precision:t.precision},this},i.prototype.batch=function(t,n){var r;return null==this.stream&&(this.stream=null!=(r=this.connection)?r.config.stream:void 0),this.rowsAffected=0,this.stream||null!=n?this._batch(t,n):new e.exports.Promise(function(e){return function(n,r){return e._batch(t,function(e,t){return e?r(e):n(t)})}}(this))},i.prototype._batch=function(e,t){return this.connection?this.connection.connected?(this.canceled=!1,this.connection.driver.Request.prototype.batch.call(this,e,function(e){return function(n,r){return e.stream?(n&&e.emit("error",n),e.emit("done",e.rowsAffected)):t(n,r,e.rowsAffected)}}(this)),this):process.nextTick(function(e){return function(){var n;return n=new r("Connection is closed.","ECONNCLOSED"),e.stream?(e.emit("error",n),e.emit("done")):t(n)}}(this)):process.nextTick(function(e){return function(){var n;return n=new h("No connection is specified for that request.","ENOCONN"),e.stream?(e.emit("error",n),e.emit("done")):t(n)}}(this))},i.prototype.bulk=function(t,n){var r;return null==this.stream&&(this.stream=null!=(r=this.connection)?r.config.stream:void 0),this.stream||null!=n?this._bulk(t,n):new e.exports.Promise(function(e){return function(n,r){return e._bulk(t,function(e,t){return e?r(e):n(t)})}}(this))},i.prototype._bulk=function(e,t){return this.connection?this.connection.connected?(this.canceled=!1,this.connection.driver.Request.prototype.bulk.call(this,e,function(e){return function(n,r){return e.stream?(n&&e.emit("error",n),e.emit("done")):t(n,r)}}(this)),this):process.nextTick(function(e){return function(){var n;return n=new r("Connection is closed.","ECONNCLOSED"),e.stream?(e.emit("error",n),e.emit("done")):t(n)}}(this)):process.nextTick(function(e){return function(){var n;return n=new h("No connection is specified for that request.","ENOCONN"),e.stream?(e.emit("error",n),e.emit("done")):t(n)}}(this))},i.prototype.pipe=function(e){return this.stream=!0,this.on("row",e.write.bind(e)),this.on("error",e.emit.bind(e,"error")),this.on("done",function(){return setImmediate(function(){return e.end()})}),e.emit("pipe",this),e},i.prototype.query=function(t,n){var r;return null==this.stream&&(this.stream=null!=(r=this.connection)?r.config.stream:void 0),this.rowsAffected=0,this.stream||null!=n?this._query(t,n):new e.exports.Promise(function(e){return function(n,r){return e._query(t,function(e,t){return e?r(e):n(t)})}}(this))},i.prototype._query=function(e,t){return this.connection?this.connection.connected?(this.canceled=!1,this.connection.driver.Request.prototype.query.call(this,e,function(e){return function(n,r){return e.stream?(n&&e.emit("error",n),e.emit("done",e.rowsAffected)):t(n,r,e.rowsAffected)}}(this)),this):process.nextTick(function(e){return function(){var n;return n=new r("Connection is closed.","ECONNCLOSED"),e.stream?(e.emit("error",n),e.emit("done")):t(n)}}(this)):process.nextTick(function(e){return function(){var n;return n=new h("No connection is specified for that request.","ENOCONN"),e.stream?(e.emit("error",n),e.emit("done")):t(n)}}(this))},i.prototype.execute=function(t,n){var r;return null==this.stream&&(this.stream=null!=(r=this.connection)?r.config.stream:void 0),this.rowsAffected=0,this.stream||null!=n?this._execute(t,n):new e.exports.Promise(function(e){return function(n,r){return e._execute(t,function(e,t){return e?r(e):n(t)})}}(this))},i.prototype._execute=function(e,t){return this.connection?this.connection.connected?(this.canceled=!1,this.connection.driver.Request.prototype.execute.call(this,e,function(e){return function(n,r,i){return e.stream?(n&&e.emit("error",n),e.emit("done",i,e.rowsAffected)):t(n,r,i,e.rowsAffected)}}(this)),this):process.nextTick(function(e){return function(){var n;return n=new r("Connection is closed.","ECONNCLOSED"),e.stream?(e.emit("error",n),e.emit("done")):t(n)}}(this)):process.nextTick(function(){var e;return e=new h("No connection is specified for that request.","ENOCONN"),this.stream?(this.emit("error",e),this.emit("done")):t(e)})},i.prototype.cancel=function(){return this.canceled=!0,this.connection.driver.Request.prototype.cancel.call(this),this},i}(a),r=function(e){function t(e,n){var r;return this instanceof t?(this.name=this.constructor.name,this.message=e,null!=n&&(this.code=n),t.__super__.constructor.call(this),void Error.captureStackTrace(this,this.constructor)):e instanceof Error?(r=new t(e.message,e.code),Object.defineProperty(r,"originalError",{value:e}),Error.captureStackTrace(r,arguments.callee),r):(r=new t(e),Error.captureStackTrace(r,arguments.callee),r)}return L(t,e),t}(Error),g=function(e){function t(e,n){var r;return this instanceof t?(this.name=this.constructor.name,this.message=e,null!=n&&(this.code=n),t.__super__.constructor.call(this),void Error.captureStackTrace(this,this.constructor)):e instanceof Error?(r=new t(e.message,e.code),Object.defineProperty(r,"originalError",{value:e}),Error.captureStackTrace(r,arguments.callee),r):(r=new t(e),Error.captureStackTrace(r,arguments.callee),r)}return L(t,e),t}(Error),h=function(e){function t(e,n){var r,i,o,a,s,u,c,l,h,f,p,d;return this instanceof t?(this.name=this.constructor.name,this.message=e,null!=n&&(this.code=n),t.__super__.constructor.call(this),void Error.captureStackTrace(this,this.constructor)):e instanceof Error?(r=new t(e.message,null!=(i=e.code)?i:n),r.number=null!=(s=null!=(u=e.info)?u.number:void 0)?s:e.code,r.lineNumber=null!=(c=e.info)?c.lineNumber:void 0,r.state=null!=(l=null!=(h=e.info)?h.state:void 0)?l:e.sqlstate,r.class=null!=(f=null!=(p=e.info)?p.class:void 0)?f:null!=(d=e.info)?d.severity:void 0,r.serverName=null!=(o=e.info)?o.serverName:void 0,r.procName=null!=(a=e.info)?a.procName:void 0,Object.defineProperty(r,"originalError",{value:e}),Error.captureStackTrace(r,arguments.callee),r):(r=new t(e),Error.captureStackTrace(r,arguments.callee),r)}return L(t,e),t}(Error),c=function(e){function t(e,n){var r;return this instanceof t?(this.name=this.constructor.name,this.message=e,this.code=n,t.__super__.constructor.call(this),void Error.captureStackTrace(this,this.constructor)):e instanceof Error?(r=new t(e.message,e.code),r.originalError=e,Error.captureStackTrace(r,arguments.callee),r):(r=new t(e),Error.captureStackTrace(r,arguments.callee),r)}return L(t,e),t}(Error),e.exports.connect=function(e,n){return b=new t(e),b.connect(n)},e.exports.close=function(e){return null!=b?b.close(e):void 0},e.exports.on=function(e,t){return null!=b?b.on(e,t):void 0},e.exports.query=function(){var e,t;return e=arguments[0],t=2<=arguments.length?k.call(arguments,1):[],(new l)._template("query",e,t)},e.exports.batch=function(){var e,t;return e=arguments[0],t=2<=arguments.length?k.call(arguments,1):[],(new l)._template("batch",e,t)},e.exports.Connection=t,e.exports.Transaction=d,e.exports.Request=l,e.exports.Table=p,e.exports.PreparedStatement=u,e.exports.ConnectionError=r,e.exports.TransactionError=g,e.exports.RequestError=h,e.exports.PreparedStatementError=c,e.exports.ISOLATION_LEVEL=s,e.exports.DRIVERS=o,e.exports.TYPES=f,e.exports.MAX=65535,e.exports.map=w,e.exports.fix=!0,e.exports.Promise=null!=(T=global.Promise)?T:n(72);for(E in f)S=f[E],e.exports[E]=S,e.exports[E.toUpperCase()]=S;e.exports.pool={max:10,min:0,idleTimeoutMillis:3e4},e.exports.connection={userName:"",password:"",server:""},e.exports.init=function(){return e.exports.connect({user:e.exports.connection.userName,password:e.exports.connection.password,server:e.exports.connection.server,options:e.exports.connection.options,driver:"tedious",pool:e.exports.pool})}}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u=[].slice;s=n(3),i=s.TYPES,a=s.declare,r=65535,t="JSON_F52E2B61-18A1-11d1-B105-00805F49916B",o=function(){function e(t){var n;t&&(n=e.parseName(t),this.name=n.name,this.schema=n.schema,this.database=n.database,this.path=""+(this.database?"["+this.database+"].":"")+(this.schema?"["+this.schema+"].":"")+"["+this.name+"]",this.temporary="#"===this.name.charAt(0)),this.columns=[],this.rows=[],Object.defineProperty(this.columns,"add",{value:function(e,t,n){if(null==n&&(n={}),null==t)throw new Error("Column data type is not defined.");return t instanceof Function&&(t=t()),t.name=e,t.nullable=n.nullable,t.primary=n.primary,this.push(t)}}),Object.defineProperty(this.rows,"add",{value:function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],this.push(e)}})}return e.prototype._makeBulk=function(){var e,t,n,o;for(o=this.columns,t=0,n=o.length;t<n;t++)switch(e=o[t],e.type){case i.Xml:e.type=i.NVarChar(r).type;break;case i.UDT:case i.Geography:case i.Geometry:e.type=i.VarBinary(r).type}return this},e.prototype.declare=function(){var e,t;return t=this.columns.filter(function(e){return e.primary===!0}).map(function(e){return e.name}),e=this.columns.map(function(e){var n;return n=["["+e.name+"] "+a(e.type,e)],e.nullable===!0?n.push("null"):e.nullable===!1&&n.push("not null"),e.primary===!0&&1===t.length&&n.push("primary key"),n.join(" ")}),"create table "+this.path+" ("+e.join(", ")+(t.length>1?", constraint PK_"+(this.temporary?this.name.substr(1):this.name)+" primary key ("+t.join(", ")+")":"")+")"},e.fromRecordset=function(e,n){var r,i,o,a,s,u,c,l,h;h=new this(n),u=e.columns;for(n in u)r=u[n],h.columns.add(n,{type:r.type,length:r.length,scale:r.scale,precision:r.precision},{nullable:r.nullable});if(1===h.columns.length&&h.columns[0].name===t)for(i=0,a=e.length;i<a;i++)l=e[i],h.rows.add(JSON.stringify(l));else for(o=0,s=e.length;o<s;o++)l=e[o],(c=h.rows).add.apply(c,function(){var e,t,n,i;for(n=h.columns,i=[],e=0,t=n.length;e<t;e++)r=n[e],i.push(l[r.name]);return i}());return h},e.parseName=function(e){var t,n,r,i,o,a;for(o=e.length,r=-1,t="",i=!1,a=[];++r<o;)if(n=e.charAt(r),"["===n)i?t+=n:i=!0;else if("]"===n){if(!i)throw new Error("Invalid table name.");i=!1}else"."===n?i?t+=n:(a.push(t),t=""):t+=n;switch(t&&a.push(t),a.length){case 1:return{name:a[0],schema:null,database:null};case 2:return{name:a[1],schema:a[0],database:null};case 3:return{name:a[2],schema:a[1],database:a[0]};default:throw new Error("Invalid table name.")}},e}(),e.exports=o}).call(this)},function(e,t,n){"use strict";var r=n(67),i=65535,o=new Date(1900,0,1),a=new Date(Date.UTC(1900,0,1)),s=new Date(2e3,0,-730118),u=Date.UTC(2e3,0,-730118),c=65535,l=e.exports.typeByName={},h=e.exports.TYPE={31:{type:"NULL",name:"Null"},48:{type:"INT1",name:"TinyInt",declaration:function(){return"tinyint"},writeTypeInfo:function(e){return e.writeUInt8(l.IntN.id),e.writeUInt8(1)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt8(1),e.writeUInt8(parseInt(t.value))):e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseInt(e),isNaN(e)?new TypeError("Invalid number."):e<0||e>255?new TypeError("Value must be between 0 and 255."):e)}},50:{type:"BIT",name:"Bit",declaration:function(){return"bit"},writeTypeInfo:function(e){return e.writeUInt8(l.BitN.id),e.writeUInt8(1)},writeParameterData:function(e,t){return"undefined"==typeof t.value||null===t.value?e.writeUInt8(0):(e.writeUInt8(1),e.writeUInt8(t.value?1:0))},validate:function(e){return null==e?null:!!e}},52:{type:"INT2",name:"SmallInt",declaration:function(){return"smallint"},writeTypeInfo:function(e){return e.writeUInt8(l.IntN.id),e.writeUInt8(2)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt8(2),e.writeInt16LE(parseInt(t.value))):e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseInt(e),isNaN(e)?new TypeError("Invalid number."):e<-32768||e>32767?new TypeError("Value must be between -32768 and 32767."):e)}},56:{type:"INT4",name:"Int",declaration:function(){return"int"},writeTypeInfo:function(e){return e.writeUInt8(l.IntN.id),e.writeUInt8(4)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt8(4),e.writeInt32LE(parseInt(t.value))):e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseInt(e),isNaN(e)?new TypeError("Invalid number."):e<-2147483648||e>2147483647?new TypeError("Value must be between -2147483648 and 2147483647."):e)}},58:{type:"DATETIM4",name:"SmallDateTime",declaration:function(){return"smalldatetime"},writeTypeInfo:function(e){return e.writeUInt8(l.DateTimeN.id),e.writeUInt8(4)},writeParameterData:function(e,t,n){if(null!=t.value){var r=void 0,i=void 0,s=void 0;return n.useUTC?(r=Math.floor((t.value.getTime()-a.getTime())/864e5),s=60*t.value.getUTCHours()+t.value.getUTCMinutes()):(i=60*-(t.value.getTimezoneOffset()-o.getTimezoneOffset())*1e3,r=Math.floor((t.value.getTime()-o.getTime()+i)/864e5),s=60*t.value.getHours()+t.value.getMinutes()),e.writeUInt8(4),e.writeUInt16LE(r),e.writeUInt16LE(s)}return e.writeUInt8(0)},validate:function(e){return null==e?null:(e instanceof Date||(e=Date.parse(e)),isNaN(e)?new TypeError("Invalid date."):e)}},59:{type:"FLT4",name:"Real",declaration:function(){return"real"},writeTypeInfo:function(e){return e.writeUInt8(l.FloatN.id),e.writeUInt8(4)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt8(4),e.writeFloatLE(parseFloat(t.value))):e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseFloat(e),isNaN(e)?new TypeError("Invalid number."):e)}},60:{type:"MONEY",name:"Money",declaration:function(){return"money"},writeTypeInfo:function(e){return e.writeUInt8(l.MoneyN.id),e.writeUInt8(8)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt8(8),e.writeMoney(1e4*t.value)):e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseFloat(e),isNaN(e)?new TypeError("Invalid number."):e)}},61:{type:"DATETIME",name:"DateTime",declaration:function(){return"datetime"},writeTypeInfo:function(e){return e.writeUInt8(l.DateTimeN.id),e.writeUInt8(8)},writeParameterData:function(e,t,n){if(null!=t.value){var r=void 0,i=void 0,s=void 0,u=void 0,c=void 0;return n.useUTC?(r=Math.floor((t.value.getTime()-a.getTime())/864e5),u=60*t.value.getUTCHours()*60,u+=60*t.value.getUTCMinutes(),u+=t.value.getUTCSeconds(),s=1e3*u+t.value.getUTCMilliseconds()):(i=60*-(t.value.getTimezoneOffset()-o.getTimezoneOffset())*1e3,r=Math.floor((t.value.getTime()-o.getTime()+i)/864e5),u=60*t.value.getHours()*60,u+=60*t.value.getMinutes(),u+=t.value.getSeconds(),s=1e3*u+t.value.getMilliseconds()),c=s/(3+1/3),c=Math.floor(c),e.writeUInt8(8),e.writeInt32LE(r),e.writeUInt32LE(c)}return e.writeUInt8(0)},validate:function(e){return null==e?null:(e instanceof Date||(e=Date.parse(e)),isNaN(e)?new TypeError("Invalid date."):e)}},62:{type:"FLT8",name:"Float",declaration:function(){return"float"},writeTypeInfo:function(e){return e.writeUInt8(l.FloatN.id),e.writeUInt8(8)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt8(8),e.writeDoubleLE(parseFloat(t.value))):e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseFloat(e),isNaN(e)?new TypeError("Invalid number."):e)}},55:{type:"DECIMAL",name:"Decimal",hasPrecision:!0,hasScale:!0,declaration:function(e){return"decimal("+this.resolvePrecision(e)+", "+this.resolveScale(e)+")"},resolvePrecision:function(e){return null!=e.precision?e.precision:null===e.value?1:18},resolveScale:function(e){return null!=e.scale?e.scale:0},writeTypeInfo:function(e,t){return e.writeUInt8(l.DecimalN.id),t.precision<=9?e.writeUInt8(5):t.precision<=19?e.writeUInt8(9):t.precision<=28?e.writeUInt8(13):e.writeUInt8(17),e.writeUInt8(t.precision),e.writeUInt8(t.scale)},writeParameterData:function(e,t){if(null!=t.value){var n=t.value<0?0:1,r=Math.round(Math.abs(t.value*Math.pow(10,t.scale)));return t.precision<=9?(e.writeUInt8(5),e.writeUInt8(n),e.writeUInt32LE(r)):t.precision<=19?(e.writeUInt8(9),e.writeUInt8(n),e.writeUInt64LE(r)):t.precision<=28?(e.writeUInt8(13),e.writeUInt8(n),e.writeUInt64LE(r),e.writeUInt32LE(0)):(e.writeUInt8(17),e.writeUInt8(n),e.writeUInt64LE(r),e.writeUInt32LE(0),e.writeUInt32LE(0))}return e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseFloat(e),isNaN(e)?new TypeError("Invalid number."):e)}},63:{type:"NUMERIC",name:"Numeric",hasPrecision:!0,hasScale:!0,declaration:function(e){return"numeric("+this.resolvePrecision(e)+", "+this.resolveScale(e)+")"},resolvePrecision:function(e){return null!=e.precision?e.precision:null===e.value?1:18},resolveScale:function(e){return null!=e.scale?e.scale:0},writeTypeInfo:function(e,t){return e.writeUInt8(l.NumericN.id),t.precision<=9?e.writeUInt8(5):t.precision<=19?e.writeUInt8(9):t.precision<=28?e.writeUInt8(13):e.writeUInt8(17),e.writeUInt8(t.precision),e.writeUInt8(t.scale)},writeParameterData:function(e,t){if(null!=t.value){var n=t.value<0?0:1,r=Math.round(Math.abs(t.value*Math.pow(10,t.scale)));return t.precision<=9?(e.writeUInt8(5),e.writeUInt8(n),e.writeUInt32LE(r)):t.precision<=19?(e.writeUInt8(9),e.writeUInt8(n),e.writeUInt64LE(r)):t.precision<=28?(e.writeUInt8(13),e.writeUInt8(n),e.writeUInt64LE(r),e.writeUInt32LE(0)):(e.writeUInt8(17),e.writeUInt8(n),e.writeUInt64LE(r),e.writeUInt32LE(0),e.writeUInt32LE(0))}return e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseFloat(e),isNaN(e)?new TypeError("Invalid number."):e)}},122:{type:"MONEY4",name:"SmallMoney",declaration:function(){return"smallmoney"},writeTypeInfo:function(e){return e.writeUInt8(l.MoneyN.id),e.writeUInt8(4)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt8(4),e.writeInt32LE(1e4*t.value)):e.writeUInt8(0)},validate:function(e){return null==e?null:(e=parseFloat(e),isNaN(e)?new TypeError("Invalid number."):e<-214748.3648||e>214748.3647?new TypeError("Value must be between -214748.3648 and 214748.3647."):e)}},127:{type:"INT8",name:"BigInt",declaration:function(){return"bigint"},writeTypeInfo:function(e){return e.writeUInt8(l.IntN.id),e.writeUInt8(8)},writeParameterData:function(e,t){if(null!=t.value){var n="number"!=typeof t.value?t.value:parseInt(t.value);return e.writeUInt8(8),e.writeInt64LE(n)}return e.writeUInt8(0)},validate:function(e){return null==e?null:e}},34:{type:"IMAGE",name:"Image",hasTableName:!0,hasTextPointerAndTimestamp:!0,dataLengthLength:4,declaration:function(){return"image"},resolveLength:function(e){return null!=e.value?e.value.length:-1},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),e.writeInt32LE(t.length)},writeParameterData:function(e,t){return null!=t.value?(e.writeInt32LE(t.length),e.writeBuffer(t.value)):e.writeInt32LE(t.length)},validate:function(e){return null==e?null:Buffer.isBuffer(e)?e:new TypeError("Invalid buffer.")}},35:{type:"TEXT",name:"Text",hasCollation:!0,hasTableName:!0,hasTextPointerAndTimestamp:!0,dataLengthLength:4,declaration:function(){return"text"},resolveLength:function(e){return null!=e.value?e.value.length:-1},writeTypeInfo:function(e,t){return e.writeUInt8(l.Text.id),e.writeInt32LE(t.length)},writeParameterData:function(e,t){return e.writeBuffer(new Buffer([0,0,0,0,0])),null!=t.value?(e.writeInt32LE(t.length),e.writeString(t.value.toString(),"ascii")):e.writeInt32LE(t.length)},validate:function(e){if(null==e)return null;if("string"!=typeof e){if("function"!=typeof e.toString)return TypeError("Invalid string.");e=e.toString()}return e}},36:{type:"GUIDN",name:"UniqueIdentifierN",aliases:["UniqueIdentifier"],dataLengthLength:1,declaration:function(){return"uniqueidentifier"},resolveLength:function(){return 16},writeTypeInfo:function(e){return e.writeUInt8(l.UniqueIdentifierN.id),e.writeUInt8(16)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt8(16),e.writeBuffer(new Buffer(r.guidToArray(t.value)))):e.writeUInt8(0)},validate:function(e){if(null==e)return null;if("string"!=typeof e){if("function"!=typeof e.toString)return TypeError("Invalid string.");e=e.toString()}return e}},38:{type:"INTN",name:"IntN",dataLengthLength:1},99:{type:"NTEXT",name:"NText",hasCollation:!0,hasTableName:!0,hasTextPointerAndTimestamp:!0,dataLengthLength:4},104:{type:"BITN",name:"BitN",dataLengthLength:1},106:{type:"DECIMALN",name:"DecimalN",dataLengthLength:1,hasPrecision:!0,hasScale:!0},108:{type:"NUMERICN",name:"NumericN",dataLengthLength:1,hasPrecision:!0,hasScale:!0},109:{type:"FLTN",name:"FloatN",dataLengthLength:1},110:{type:"MONEYN",name:"MoneyN",dataLengthLength:1},111:{type:"DATETIMN",name:"DateTimeN",dataLengthLength:1},165:{type:"BIGVARBIN",name:"VarBinary",dataLengthLength:2,maximumLength:8e3,declaration:function(e){var t=void 0;return t=e.length?e.length:null!=e.value?e.value.length||1:null!==e.value||e.output?this.maximumLength:1,t<=this.maximumLength?"varbinary("+t+")":"varbinary(max)"},resolveLength:function(e){return null!=e.length?e.length:null!=e.value?e.value.length:this.maximumLength},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),t.length<=this.maximumLength?e.writeUInt16LE(this.maximumLength):e.writeUInt16LE(c)},writeParameterData:function(e,t){return null!=t.value?t.length<=this.maximumLength?e.writeUsVarbyte(t.value):e.writePLPBody(t.value):t.length<=this.maximumLength?e.writeUInt16LE(i):(e.writeUInt32LE(4294967295),e.writeUInt32LE(4294967295))},validate:function(e){return null==e?null:Buffer.isBuffer(e)?e:new TypeError("Invalid buffer.")}},167:{type:"BIGVARCHR",name:"VarChar",hasCollation:!0,dataLengthLength:2,maximumLength:8e3,declaration:function(e){var t=void 0;return t=e.length?e.length:null!=e.value?e.value.toString().length||1:null!==e.value||e.output?this.maximumLength:1,t<=this.maximumLength?"varchar("+t+")":"varchar(max)"},resolveLength:function(e){return null!=e.length?e.length:null!=e.value?Buffer.isBuffer(e.value)?e.value.length||1:e.value.toString().length||1:this.maximumLength},
writeTypeInfo:function(e,t){return e.writeUInt8(this.id),t.length<=this.maximumLength?e.writeUInt16LE(this.maximumLength):e.writeUInt16LE(c),e.writeBuffer(new Buffer([0,0,0,0,0]))},writeParameterData:function(e,t){return null!=t.value?t.length<=this.maximumLength?e.writeUsVarbyte(t.value,"ascii"):e.writePLPBody(t.value,"ascii"):t.length<=this.maximumLength?e.writeUInt16LE(i):(e.writeUInt32LE(4294967295),e.writeUInt32LE(4294967295))},validate:function(e){if(null==e)return null;if("string"!=typeof e){if("function"!=typeof e.toString)return TypeError("Invalid string.");e=e.toString()}return e}},173:{type:"BIGBinary",name:"Binary",dataLengthLength:2,maximumLength:8e3,declaration:function(e){var t;return t=e.length?e.length:null!=e.value?e.value.length||1:null!==e.value||e.output?this.maximumLength:1,"binary("+t+")"},resolveLength:function(e){return null!=e.value?e.value.length:this.maximumLength},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),e.writeUInt16LE(t.length)},writeParameterData:function(e,t){return null!=t.value?(e.writeUInt16LE(t.length),e.writeBuffer(t.value.slice(0,Math.min(t.length,this.maximumLength)))):e.writeUInt16LE(i)},validate:function(e){return null==e?null:Buffer.isBuffer(e)?e:new TypeError("Invalid buffer.")}},175:{type:"BIGCHAR",name:"Char",hasCollation:!0,dataLengthLength:2,maximumLength:8e3,declaration:function(e){var t=void 0;return t=e.length?e.length:null!=e.value?e.value.toString().length||1:null!==e.value||e.output?this.maximumLength:1,t<this.maximumLength?"char("+t+")":"char("+this.maximumLength+")"},resolveLength:function(e){return null!=e.length?e.length:null!=e.value?Buffer.isBuffer(e.value)?e.value.length||1:e.value.toString().length||1:this.maximumLength},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),e.writeUInt16LE(t.length),e.writeBuffer(new Buffer([0,0,0,0,0]))},writeParameterData:function(e,t){return null!=t.value?e.writeUsVarbyte(t.value,"ascii"):e.writeUInt16LE(i)},validate:function(e){if(null==e)return null;if("string"!=typeof e){if("function"!=typeof e.toString)return TypeError("Invalid string.");e=e.toString()}return e}},231:{type:"NVARCHAR",name:"NVarChar",hasCollation:!0,dataLengthLength:2,maximumLength:4e3,declaration:function(e){var t=void 0;return t=e.length?e.length:null!=e.value?e.value.toString().length||1:null!==e.value||e.output?this.maximumLength:1,t<=this.maximumLength?"nvarchar("+t+")":"nvarchar(max)"},resolveLength:function(e){return null!=e.length?e.length:null!=e.value?Buffer.isBuffer(e.value)?e.value.length/2||1:e.value.toString().length||1:this.maximumLength},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),t.length<=this.maximumLength?e.writeUInt16LE(2*t.length):e.writeUInt16LE(c),e.writeBuffer(new Buffer([0,0,0,0,0]))},writeParameterData:function(e,t){return null!=t.value?t.length<=this.maximumLength?e.writeUsVarbyte(t.value,"ucs2"):e.writePLPBody(t.value,"ucs2"):t.length<=this.maximumLength?e.writeUInt16LE(i):(e.writeUInt32LE(4294967295),e.writeUInt32LE(4294967295))},validate:function(e){if(null==e)return null;if("string"!=typeof e){if("function"!=typeof e.toString)return TypeError("Invalid string.");e=e.toString()}return e}},239:{type:"NCHAR",name:"NChar",hasCollation:!0,dataLengthLength:2,maximumLength:4e3,declaration:function(e){var t=void 0;return t=e.length?e.length:null!=e.value?e.value.toString().length||1:null!==e.value||e.output?this.maximumLength:1,t<this.maximumLength?"nchar("+t+")":"nchar("+this.maximumLength+")"},resolveLength:function(e){return null!=e.length?e.length:null!=e.value?Buffer.isBuffer(e.value)?e.value.length/2||1:e.value.toString().length||1:this.maximumLength},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),e.writeUInt16LE(2*t.length),e.writeBuffer(new Buffer([0,0,0,0,0]))},writeParameterData:function(e,t){return null!=t.value?e.writeUsVarbyte(t.value,"ucs2"):e.writeUInt16LE(i)},validate:function(e){if(null==e)return null;if("string"!=typeof e){if("function"!=typeof e.toString)return TypeError("Invalid string.");e=e.toString()}return e}},241:{type:"XML",name:"Xml",hasSchemaPresent:!0},41:{type:"TIMEN",name:"TimeN",aliases:["Time"],hasScale:!0,dataLengthLength:1,dataLengthFromScale:function(e){switch(e){case 0:case 1:case 2:return 3;case 3:case 4:return 4;case 5:case 6:case 7:return 5}},declaration:function(e){return"time("+this.resolveScale(e)+")"},resolveScale:function(e){return null!=e.scale?e.scale:null===e.value?0:7},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),e.writeUInt8(t.scale)},writeParameterData:function(e,t,n){if(null==t.value)return e.writeUInt8(0);var r=void 0,i=new Date(+t.value);switch(i=n.useUTC?1e3*(60*(60*i.getUTCHours()+i.getUTCMinutes())+i.getUTCSeconds())+i.getUTCMilliseconds():1e3*(60*(60*i.getHours()+i.getMinutes())+i.getSeconds())+i.getMilliseconds(),i=(i/1e3+(null!=(r=t.value.nanosecondDelta)?r:0))*Math.pow(10,t.scale),t.scale){case 0:case 1:case 2:return e.writeUInt8(3),e.writeUInt24LE(i);case 3:case 4:return e.writeUInt8(4),e.writeUInt32LE(i);case 5:case 6:case 7:return e.writeUInt8(5),e.writeUInt40LE(i)}},validate:function(e){return null==e?null:e instanceof Date?e:(e=Date.parse(e),isNaN(e)?new TypeError("Invalid time."):e)}},40:{type:"DATEN",name:"DateN",aliases:["Date"],dataLengthLength:1,fixedDataLength:3,declaration:function(){return"date"},writeTypeInfo:function(e){return e.writeUInt8(this.id)},writeParameterData:function(e,t,n){if(null!=t.value){if(e.writeUInt8(3),n.useUTC)return e.writeUInt24LE(Math.floor((+t.value-u)/864e5));var r=60*-(t.value.getTimezoneOffset()-s.getTimezoneOffset())*1e3;return e.writeUInt24LE(Math.floor((+t.value-s+r)/864e5))}return e.writeUInt8(0)},validate:function(e){return null==e?null:(e instanceof Date||(e=Date.parse(e)),isNaN(e)?new TypeError("Invalid date."):e)}},42:{type:"DATETIME2N",name:"DateTime2N",aliases:["DateTime2"],hasScale:!0,dataLengthLength:1,dataLengthFromScale:function(e){switch(e){case 0:case 1:case 2:return 3;case 3:case 4:return 4;case 5:case 6:case 7:return 5}},declaration:function(e){return"datetime2("+this.resolveScale(e)+")"},resolveScale:function(e){return null!=e.scale?e.scale:null===e.value?0:7},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),e.writeUInt8(t.scale)},writeParameterData:function(e,t,n){if(null!=t.value){var r=void 0,i=new Date(+t.value);switch(i=n.useUTC?1e3*(60*(60*i.getUTCHours()+i.getUTCMinutes())+i.getUTCSeconds())+i.getUTCMilliseconds():1e3*(60*(60*i.getHours()+i.getMinutes())+i.getSeconds())+i.getMilliseconds(),i=(i/1e3+(null!=(r=t.value.nanosecondDelta)?r:0))*Math.pow(10,t.scale),t.scale){case 0:case 1:case 2:e.writeUInt8(6),e.writeUInt24LE(i);break;case 3:case 4:e.writeUInt8(7),e.writeUInt32LE(i);break;case 5:case 6:case 7:e.writeUInt8(8),e.writeUInt40LE(i)}if(n.useUTC)return e.writeUInt24LE(Math.floor((+t.value-u)/864e5));var o=60*-(t.value.getTimezoneOffset()-s.getTimezoneOffset())*1e3;return e.writeUInt24LE(Math.floor((+t.value-s+o)/864e5))}return e.writeUInt8(0)},validate:function(e){return null==e?null:(e instanceof Date||(e=Date.parse(e)),isNaN(e)?new TypeError("Invalid date."):e)}},43:{type:"DATETIMEOFFSETN",name:"DateTimeOffsetN",aliases:["DateTimeOffset"],hasScale:!0,dataLengthLength:1,dataLengthFromScale:function(e){switch(e){case 0:case 1:case 2:return 3;case 3:case 4:return 4;case 5:case 6:case 7:return 5}},declaration:function(e){return"datetimeoffset("+this.resolveScale(e)+")"},resolveScale:function(e){return null!=e.scale?e.scale:null===e.value?0:7},writeTypeInfo:function(e,t){return e.writeUInt8(this.id),e.writeUInt8(t.scale)},writeParameterData:function(e,t){if(null!=t.value){var n=void 0,r=new Date(+t.value);r.setUTCFullYear(1970),r.setUTCMonth(0),r.setUTCDate(1),r=(+r/1e3+(null!=(n=t.value.nanosecondDelta)?n:0))*Math.pow(10,t.scale);var i=-t.value.getTimezoneOffset();switch(t.scale){case 0:case 1:case 2:e.writeUInt8(8),e.writeUInt24LE(r);break;case 3:case 4:e.writeUInt8(9),e.writeUInt32LE(r);break;case 5:case 6:case 7:e.writeUInt8(10),e.writeUInt40LE(r)}return e.writeUInt24LE(Math.floor((+t.value-u)/864e5)),e.writeInt16LE(i)}return e.writeUInt8(0)},validate:function(e){return null==e?null:(e instanceof Date||(e=Date.parse(e)),isNaN(e)?new TypeError("Invalid date."):e)}},240:{type:"UDTTYPE",name:"UDT",hasUDTInfo:!0},243:{type:"TVPTYPE",name:"TVP",declaration:function(e){return e.value.name+" readonly"},writeTypeInfo:function(e,t){var n=void 0,r=void 0,i=void 0,o=void 0;e.writeUInt8(this.id),e.writeBVarchar(""),e.writeBVarchar(null!=(n=null!=(r=t.value)?r.schema:void 0)?n:""),e.writeBVarchar(null!=(i=null!=(o=t.value)?o.name:void 0)?i:"")},writeParameterData:function(e,t,n){if(null==t.value)return e.writeUInt16LE(65535),e.writeUInt8(0),void e.writeUInt8(0);e.writeUInt16LE(t.value.columns.length);for(var r=t.value.columns,i=0,o=r.length;i<o;i++){var a=r[i];e.writeUInt32LE(0),e.writeUInt16LE(0),a.type.writeTypeInfo(e,a),e.writeBVarchar("")}e.writeUInt8(0);for(var s=t.value.rows,u=0,c=s.length;u<c;u++){var l=s[u];e.writeUInt8(1);for(var h=0,f=l.length;h<f;h++){var p=l[h],d={value:p,length:t.value.columns[h].length,scale:t.value.columns[h].scale,precision:t.value.columns[h].precision};t.value.columns[h].type.writeParameterData(e,d,n)}}e.writeUInt8(0)},validate:function(e){return null==e?null:"object"!=typeof e?new TypeError("Invalid table."):Array.isArray(e.columns)&&Array.isArray(e.rows)?e:new TypeError("Invalid table.")}},98:{type:"SSVARIANTTYPE",name:"Variant",dataLengthLength:4,declaration:function(e){return"sql_variant"}}};for(var f in h){var p=h[f];if(p.id=parseInt(f,10),l[p.name]=p,null!=p.aliases&&p.aliases instanceof Array)for(var d=p.aliases,g=d.length,m=0;m<g;m++){var v=d[m];l[v]||(l[v]=p)}}},function(e,t,n){"use strict";function r(e){return!(e.length<u)&&e.length>=e.readUInt16BE(p.Length)}function i(e){return e.readUInt16BE(p.Length)}var o=n(2).default,a=n(1).default;n(19);var s=n(18).sprintf,u=e.exports.HEADER_LENGTH=8,c=e.exports.TYPE={SQL_BATCH:1,RPC_REQUEST:3,TABULAR_RESULT:4,ATTENTION:6,BULK_LOAD:7,TRANSACTION_MANAGER:14,LOGIN7:16,NTLMAUTH_PKT:17,PRELOGIN:18},l={};for(var h in c)l[c[h]]=h;var f={NORMAL:0,EOM:1,IGNORE:2,RESETCONNECTION:8,RESETCONNECTIONSKIPTRAN:16},p=e.exports.OFFSET={Type:0,Status:1,Length:2,SPID:4,PacketID:6,Window:7},d=0,g=1,m=0,v="\n",y=function(){function e(t){if(a(this,e),t instanceof Buffer)this.buffer=t;else{var n=t;this.buffer=new Buffer(u),this.buffer.writeUInt8(n,p.Type),this.buffer.writeUInt8(f.NORMAL,p.Status),this.buffer.writeUInt16BE(d,p.SPID),this.buffer.writeUInt8(g,p.PacketID),this.buffer.writeUInt8(m,p.Window),this.setLength()}}return o(e,[{key:"setLength",value:function(){return this.buffer.writeUInt16BE(this.buffer.length,p.Length)}},{key:"length",value:function(){return this.buffer.readUInt16BE(p.Length)}},{key:"resetConnection",value:function(e){var t=this.buffer.readUInt8(p.Status);return e?t|=f.RESETCONNECTION:t&=255-f.RESETCONNECTION,this.buffer.writeUInt8(t,p.Status)}},{key:"last",value:function(e){var t=this.buffer.readUInt8(p.Status);return arguments.length>0&&(e?t|=f.EOM:t&=255-f.EOM,this.buffer.writeUInt8(t,p.Status)),this.isLast()}},{key:"isLast",value:function(){return!!(this.buffer.readUInt8(p.Status)&f.EOM)}},{key:"packetId",value:function(e){return e&&this.buffer.writeUInt8(e%256,p.PacketID),this.buffer.readUInt8(p.PacketID)}},{key:"addData",value:function(e){return this.buffer=Buffer.concat([this.buffer,e]),this.setLength(),this}},{key:"data",value:function(){return this.buffer.slice(u)}},{key:"type",value:function(){return this.buffer.readUInt8(p.Type)}},{key:"statusAsString",value:function(){var e=this.buffer.readUInt8(p.Status),t=[];for(var n in f){var r=f[n];e&r?t.push(n):t.push(void 0)}return t.join(" ").trim()}},{key:"headerToString",value:function(e){e||(e="");var t=s("type:0x%02X(%s), status:0x%02X(%s), length:0x%04X, spid:0x%04X, packetId:0x%02X, window:0x%02X",this.buffer.readUInt8(p.Type),l[this.buffer.readUInt8(p.Type)],this.buffer.readUInt8(p.Status),this.statusAsString(),this.buffer.readUInt16BE(p.Length),this.buffer.readUInt16BE(p.SPID),this.buffer.readUInt8(p.PacketID),this.buffer.readUInt8(p.Window));return e+t}},{key:"dataToString",value:function(e){e||(e="");for(var t=4,n=8,r=32,i=this.data(),o="",a="",u=0;u<i.length;u++)u%r===0&&(o+=e,o+=s("%04X  ",u)),i[u]<32||i[u]>126?(a+=".",(u+1)%n===0&&(u+1)%r!==0&&(a+=" ")):a+=String.fromCharCode(i[u]),null!=i[u]&&(o+=s("%02X",i[u])),(u+1)%t===0&&(u+1)%r!==0&&(o+=" "),(u+1)%r===0&&(o+="  "+a,a="",u<i.length-1&&(o+=v));return a.length&&(o+="  "+a),o}},{key:"toString",value:function(e){return e||(e=""),this.headerToString(e)+"\n"+this.dataToString(e+e)}},{key:"payloadString",value:function(){return""}}]),e}();e.exports.Packet=y,e.exports.isPacketComplete=r,e.exports.packetLength=i},function(e,t,n){"use strict";e.exports.ReadableTrackingBuffer=n(156),e.exports.WritableTrackingBuffer=n(28)},function(e,t,n){"use strict";var r=n(2).default,i=n(1).default,o=n(39);n(19);var a=4294967296,s=1/a,u=new Buffer([254,255,255,255,255,255,255,255]);e.exports=function(){function e(t,n,r){i(this,e),this.initialSize=t,this.encoding=n,this.doubleSizeGrowth=r,this.doubleSizeGrowth||(this.doubleSizeGrowth=!1),this.encoding||(this.encoding="ucs2"),this.buffer=new Buffer(this.initialSize),this.position=0}return r(e,[{key:"copyFrom",value:function(e){var t=e.length;return this.makeRoomFor(t),e.copy(this.buffer,this.position),this.position+=t}},{key:"makeRoomFor",value:function(e){if(this.buffer.length-this.position<e){if(this.doubleSizeGrowth){for(var t=2*this.buffer.length;t<e;)t*=2;return this.newBuffer(t)}return this.newBuffer(e)}}},{key:"newBuffer",value:function(e){e||(e=this.initialSize);var t=this.buffer.slice(0,this.position);return this.compositeBuffer?this.compositeBuffer=Buffer.concat([this.compositeBuffer,t]):this.compositeBuffer=t,this.buffer=new Buffer(e),this.position=0}},{key:"writeUInt8",value:function(e){var t=1;return this.makeRoomFor(t),this.buffer.writeUInt8(e,this.position),this.position+=t}},{key:"writeUInt16LE",value:function(e){var t=2;return this.makeRoomFor(t),this.buffer.writeUInt16LE(e,this.position),this.position+=t}},{key:"writeUShort",value:function(e){return this.writeUInt16LE(e)}},{key:"writeUInt16BE",value:function(e){var t=2;return this.makeRoomFor(t),this.buffer.writeUInt16BE(e,this.position),this.position+=t}},{key:"writeUInt24LE",value:function(e){var t=3;return this.makeRoomFor(t),this.buffer[this.position+2]=e>>>16&255,this.buffer[this.position+1]=e>>>8&255,this.buffer[this.position]=255&e,this.position+=t}},{key:"writeUInt32LE",value:function(e){var t=4;return this.makeRoomFor(t),this.buffer.writeUInt32LE(e,this.position),this.position+=t}},{key:"writeUInt64LE",value:function(e){var t=e%4294967296,n=Math.floor(e/4294967296);return this.writeUInt32LE(t),this.writeUInt32LE(n)}},{key:"writeInt64LE",value:function(e){var t=o.numberToInt64LE(e);return this.copyFrom(t)}},{key:"writeUInt32BE",value:function(e){var t=4;return this.makeRoomFor(t),this.buffer.writeUInt32BE(e,this.position),this.position+=t}},{key:"writeUInt40LE",value:function(e){return this.writeInt32LE(e&-1),this.writeUInt8(Math.floor(e*s))}},{key:"writeUInt64LE",value:function(e){return this.writeInt32LE(e&-1),this.writeUInt32LE(Math.floor(e*s))}},{key:"writeInt8",value:function(e){var t=1;return this.makeRoomFor(t),this.buffer.writeInt8(e,this.position),this.position+=t}},{key:"writeInt16LE",value:function(e){var t=2;return this.makeRoomFor(t),this.buffer.writeInt16LE(e,this.position),this.position+=t}},{key:"writeInt16BE",value:function(e){var t=2;return this.makeRoomFor(t),this.buffer.writeInt16BE(e,this.position),this.position+=t}},{key:"writeInt32LE",value:function(e){var t=4;return this.makeRoomFor(t),this.buffer.writeInt32LE(e,this.position),this.position+=t}},{key:"writeInt32BE",value:function(e){var t=4;return this.makeRoomFor(t),this.buffer.writeInt32BE(e,this.position),this.position+=t}},{key:"writeFloatLE",value:function(e){var t=4;return this.makeRoomFor(t),this.buffer.writeFloatLE(e,this.position),this.position+=t}},{key:"writeDoubleLE",value:function(e){var t=8;return this.makeRoomFor(t),this.buffer.writeDoubleLE(e,this.position),this.position+=t}},{key:"writeString",value:function(e,t){t||(t=this.encoding);var n=Buffer.byteLength(e,t);this.makeRoomFor(n);var r=this.buffer.write(e,this.position,t);return this.position+=n,r}},{key:"writeBVarchar",value:function(e,t){return this.writeUInt8(e.length),this.writeString(e,t)}},{key:"writeUsVarchar",value:function(e,t){return this.writeUInt16LE(e.length),this.writeString(e,t)}},{key:"writeUsVarbyte",value:function(e,t){null==t&&(t=this.encoding);var n=void 0;return Buffer.isBuffer(e)?n=e.length:(e=e.toString(),n=Buffer.byteLength(e,t)),this.writeUInt16LE(n),Buffer.isBuffer(e)?this.writeBuffer(e):(this.makeRoomFor(n),this.buffer.write(e,this.position,t),this.position+=n)}},{key:"writePLPBody",value:function(e,t){null==t&&(t=this.encoding);var n=void 0;return Buffer.isBuffer(e)?n=e.length:(e=e.toString(),n=Buffer.byteLength(e,t)),this.writeBuffer(u),n>0&&(this.writeUInt32LE(n),Buffer.isBuffer(e)?this.writeBuffer(e):(this.makeRoomFor(n),this.buffer.write(e,this.position,t),this.position+=n)),this.writeUInt32LE(0)}},{key:"writeBuffer",value:function(e){var t=e.length;return this.makeRoomFor(t),e.copy(this.buffer,this.position),this.position+=t}},{key:"writeMoney",value:function(e){return this.writeInt32LE(Math.floor(e*s)),this.writeInt32LE(e&-1)}},{key:"data",get:function(){return this.newBuffer(0),this.compositeBuffer}}]),e}()},function(e,t,n){"use strict";var r=n(10),i=r.Buffer,o=r.SlowBuffer,a=r.kMaxLength||2147483647;t.alloc=function(e,t,n){if("function"==typeof i.alloc)return i.alloc(e,t,n);if("number"==typeof n)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>a)throw new RangeError("size is too large");var r=n,o=t;void 0===o&&(r=void 0,o=0);var s=new i(e);if("string"==typeof o)for(var u=new i(o,r),c=u.length,l=-1;++l<e;)s[l]=u[l%c];else s.fill(o);return s},t.allocUnsafe=function(e){if("function"==typeof i.allocUnsafe)return i.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>a)throw new RangeError("size is too large");return new i(e)},t.from=function(e,t,n){if("function"==typeof i.from&&(!global.Uint8Array||Uint8Array.from!==i.from))return i.from(e,t,n);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new i(e,t);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var r=t;if(1===arguments.length)return new i(e);"undefined"==typeof r&&(r=0);var o=n;if("undefined"==typeof o&&(o=e.byteLength-r),r>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(o>e.byteLength-r)throw new RangeError("'length' is out of bounds");return new i(e.slice(r,r+o))}if(i.isBuffer(e)){var a=new i(e.length);return e.copy(a,0,0,e.length),a}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new i(e);if("Buffer"===e.type&&Array.isArray(e.data))return new i(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},t.allocUnsafeSlow=function(e){if("function"==typeof i.allocUnsafeSlow)return i.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=a)throw new RangeError("size is too large");return new o(e)}},function(e,t){var n=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports=[["0","\0",127,""],["8140","",5,"",9,"",6,""],["8180","",6,"",4,"",4,"",5,""],["8240","",4,"",8,"",4,"",11],["8280","",10,"",4,"",7,"",5,"",8,"",20,"",4,"",6,""],["8340","",17,"",5,"",10,"",4,"",9,""],["8380","",5,"",13,"",28,"",4,"",4,"",5],["8440","",5,"",5,""],["8480","",9,"",4,"",6,"",6,"",9,"",5,"",10,"",7,""],["8540","",9,""],["8580","",4,"",6,"",4,"",4,"",7,""],["8640","",4,"",5,"",4,"",5,""],["8680","",4,"",4,"",5,"",6,"",8,"",4,"",4,"",4,""],["8740","",7,"",11,"",4,"",4],["8780","",7,"",6,"",14,"",10,"",6,"",12,"",8,"",5,"",6],["8840","",9,"",4,"",4,""],["8880","",4,"",6,"",8,"",6,"",7,"",4,"",4,"",7],["8940","",5,"",6,"",4,"",5,"",4,"",16,""],["8980","",4,"",4,"",7,"",17,"",10,"",13,"",5,"",7,"",4,""],["8a40","",4,"",12,""],["8a80","",5,"",6,"",4,"",11,"",6,"",4,"",4,"",9,"",5],["8b40","",8,"",17,"",6,"",13,""],["8b80","",4,"",4,"",5,"",4,"",4,"",22,"",11,"",25,"",7,"",6],["8c40","",7,""],["8c80","",8,"",4,"",6,"",6,"",6,"",4,"",4,"",4],["8d40","",5,"",5,"",5,"",6,"",9,"",4],["8d80","",5,"",4,"",4,"",4,"",7,"",7,"",10,"",10,"",12,"",21,""],["8e40","",21,"",12,"",6,"",12,""],["8e80","",4,"",7,"",4,"",4,"",5,"",6,"",4,"",14,"",4,"",4,"",6],["8f40","",5,"",11,"",8,""],["8f80","",6,"",14,"",5,"",5,"",4,""],["9040","",4,"",4,"",6,""],["9080","",7,"",4,"",4,"",4,"",4,"",18,"",6],["9140","",6,"",6,"",18,"",4,""],["9180","",6,"",8,"",9,"",5,"",4,"",4,"",16,"",13,"",8,"",5,"",4,""],["9240","",6,"",5,""],["9280","",5,"",7,"",6,""],["9340","",6,"",4,"",4,"",5,""],["9380","",5,"",4,"",6,"",4,"",7,"",9,"",6,"",8,"",4,"",6,""],["9440","",24,"",7,"",7,"",4,"",8],["9480","",4,"",4,"",14,"",7,"",7,""],["9540","",4,"",4,"",6,""],["9580","",4,"",4,"",8,"",4,"",4,"",25,"",7,"",5,""],["9640","",5,"",4,""],["9680","",7,"",9,"",7,"",4,"",6,"",6,"",5],["9740","",7,"",8,"",7,"",9,""],["9780","",6,"",5,"",4,"",9,"",4,"",11,"",7,"",16,""],["9840","",4,"",5,"",9,""],["9880","",7,"",5,"",11,"",9,"",9,"",11,"",5,"",5,"",6,"",4,"",7,"",6,""],["9940","",4,"",10,"",6,"",8,"",4,"",7,"",5],["9980","",114,"",6],["9a40","",11,"",7,"",13,""],["9a80","",4,"",7,"",7,"",6,"",4,"",4,"",7,"",6,"",4,"",4,""],["9b40","",4,""],["9b80","",5,"",4,"",4,"",5,""],["9c40","",7,""],["9c80","",7,"",7,"",10,"",14,"",4,"",6,"",5],["9d40","",7,"",4,"",9,"",6,""],["9d80","",9,"",5,"",6,"",12,"",4,"",10,"",5,"",5,"",6,"",10,""],["9e40","",7,"",32,"",7,"",6,"",6],["9e80","",9,"",17,"",13,"",11,"",12,"",12,""],["9f40","",6,"",10,"",4,"",10,"",7,""],["9f80","",13,"",12,"",4,"",4,"",5,"",4,"",4,"",6,"",5,"",8,"",9,"",4],["a040","",9,"",5,"",9,"",11,"",19],["a080","",9,"",6,"",4,"",11,"",11,"",6,""],["a1a1","",7,""],["a2a1","",9],["a2b1","",19,"",19,"",9],["a2e5","",9],["a2f1","",11],["a3a1","",88,""],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a6e0",""],["a6ee",""],["a6f4",""],["a7a1","",5,"",25],["a7d1","",5,"",25],["a840","",35,"",6],["a880","",7,""],["a8a1",""],["a8bd",""],["a8c0",""],["a8c5","",36],["a940","",8,""],["a959",""],["a95c",""],["a960","",9,"",8],["a980","",4,""],["a996",""],["a9a4","",75],["aa40","",5,"",5,"",8],["aa80","",7,"",10,""],["ab40","",11,"",4,"",5,"",4],["ab80","",6,"",4],["ac40","",10,"",8,"",5,"",4,"",11],["ac80","",6,"",12,"",4,""],["ad40","",10,"",7,"",15,"",12],["ad80","",9,"",8,"",6,""],["ae40","",6,"",7,"",4,""],["ae80","",7,"",6,"",4,""],["af40","",4,""],["af80",""],["b040","",6,"",5,"",4,"",6,"",7,""],["b080","",7,"",8,"",9,""],["b140","",4,"",7,"",10,""],["b180","",4,"",7,"",7,""],["b240","",11,"",5,"",11,"",4],["b280","",12,"",8,"",4,""],["b340","",5,""],["b380","",11,"",7,"",6,""],["b440","",7,"",9],["b480","",4,"",5,"",6,""],["b540","",5,"",9,"",4,"",14,"",4,"",8,""],["b580","",6,"",4,""],["b640","",6,"",11,"",10,"",4,"",5,""],["b680","",6,"",4,""],["b740","",14,"",5,"",9,"",4,"",16],["b780","",6,""],["b840","",4,"",10,"",10,"",9,"",5,""],["b880","",4,""],["b940","",5,"",10,"",6,""],["b980","",7,""],["ba40","",4,"",4,"",7,"",5,""],["ba80","",4,"",5,"",12,"",5,""],["bb40","",9,"",36,"",5,"",9],["bb80","",6,"",4,""],["bc40","",6,"",6,"",5,"",7,"",13,"",5],["bc80","",14,"",6,""],["bd40","",54,"",7],["bd80","",32,""],["be40","",12,"",6,"",42],["be80","",32,""],["bf40","",62],["bf80","",4,"",4,"",21,""],["c040","",35,"",23,""],["c080","",6,"",9,""],["c140","",4,"",7,"",4,"",4,"",6,""],["c180","",4,"",4,"",5,""],["c240","",6,"",5,""],["c280","",13,"",5,"",11,""],["c340","",5,"",4,"",6,""],["c380","",12,"",4,""],["c440","",5,"",4,"",4,"",5,"",4,""],["c480","",7,"",5,"",6,""],["c540","",14,"",4,"",5,"",4,"",5,""],["c580","",7,"",7,""],["c640",""],["c680","",4,"",9,""],["c740","",4,"",4,"",6,"",6,"",6,""],["c780",""],["c840","",4,"",5,"",5,"",7,"",5,"",7,""],["c880","",6,"",4,"",4,""],["c940","",4,"",7,"",12,""],["c980","",4,"",4,"",10,""],["ca40","",8,"",8,"",9,"",4,"",10],["ca80","",4,"",8,""],["cb40","",6,"",10,"",6,"",5,"",6,"",6,"",4,""],["cb80","",5,"",6,"",14,""],["cc40","",4,"",10,"",15,"",13,""],["cc80","",11,"",4,"",7,""],["cd40","",6,"",6,"",4,"",5,"",4,"",4,""],["cd80",""],["ce40","",6,"",5,"",7,""],["ce80","",4,"",6,"",4,""],["cf40","",4,"",4,"",6,"",9],["cf80","",5,"",7,"",4,""],["d040","",13,"",5,"",5,"",5,"",6,""],["d080","",4,"",4,"",5,""],["d140","",4,"",4,"",6,"",5],["d180","",4,"",4,"",4,""],["d240","",8,"",24,"",5,"",19,""],["d280","",26,""],["d340","",30,"",6],["d380","",4,"",5,"",21,""],["d440","",31,"",8,"",21],["d480","",25,"",6,""],["d540","",7,"",7,"",46],["d580","",32,""],["d640","",34,"",27],["d680","",30,""],["d740","",31,"",4,"",25],["d780","",24,""],["d840","",8,"",7,"",5,"",6,"",6,"",6,""],["d880","",6,"",20,""],["d940","",62],["d980","",32,""],["da40","",14,"",8,"",4,"",9,""],["da80","",12,""],["db40","",6,"",7,"",4,""],["db80","",4,"",5,"",11,""],["dc40","",4,"",6,"",6,"",11,"",6,"",7],["dc80","",10,"",21,""],["dd40","",62],["dd80","",32,""],["de40","",32,""],["de80","",4,""],["df40","",5,"",4,"",4,"",5,"",4,"",6,""],["df80","",4,""],["e040","",19,""],["e080","",10,"",6,"",8,""],["e140","",4,"",6,"",5,"",5,""],["e180","",10,"",9,"",8,""],["e240","",62],["e280","",32,"",5,""],["e340","",45,"",16],["e380","",7,"",24,""],["e440","",5,"",24,"",31],["e480","",32,""],["e540","",51,"",10],["e580","",31,""],["e640","",34,"",27],["e680","",29,""],["e740","",7,"",54],["e780","",32,"",6,"",4,""],["e840","",14,"",43,""],["e880","",20,""],["e940","",7,"",42],["e980","",32,""],["ea40","",27,"",6,""],["ea80","",4,"",12,""],["eb40","",9,"",7,"",9,"",6,""],["eb80","",4,""],["ec40","",8,"",4,"",18,"",7],["ec80","",4,"",7,"",4,"",4,""],["ed40","",6,"",46],["ed80","",4,"",23,""],["ee40","",62],["ee80","",32,"",4,"",6,""],["ef40","",5,"",37,"",4],["ef80","",30,"",4,"",8,""],["f040","",4,"",28,"",26],["f080","",9,"",12,"",4,"",6,""],["f140","",10,"",47],["f180","",32,""],["f240","",62],["f280","",32,""],["f340","",17,"",6,"",4,""],["f380","",8,"",6,""],["f440","",5,"",10,"",10,"",7,"",5],["f480","",32,""],["f540","",62],["f580","",32,""],["f640","",62],["f680","",32,"",5,"",5,"",4,"",7,""],["f740","",62],["f780","",4,"",4,""],["f840","",62],["f880","",32],["f940","",62],["f980","",32],["fa40","",62],["fa80","",32],["fb40","",27,"",9,""],["fb80","",5,"",8,"",5,""],["fc40","",8,"",4,"",8,"",6],["fc80","",4,"",5,"",8,""],["fd40","",4,"",4,"",10,"",38],["fd80","",5,"",11,"",4,""],["fe40",""]];
},function(e,t,n){(function(){var t,r,i,o,a,s,u=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};s=n(168),o=n(165),t=["stream"],i=function(e){var n,r,i,a,c,l,h,f,p;if(a=s.parse(e),l=a.pathname.substr(1).split("/"),l.length>1&&(n=l.shift()),a.auth&&(a.auth=a.auth.split(":"),f=a.auth.shift(),c=a.auth.join(":")),i={server:""+a.hostname+(a.port?","+a.port:n?"\\"+n:""),uid:f||"",pwd:c||"",database:l[0]},a.query){h=o.parse(a.query);for(r in h)p=h[r],"domain"===r?i.uid=p+"\\"+i.uid:i[r]=p}return Object.defineProperty(i,"toString",{value:function(){return function(){var e;e=[];for(r in this)p=this[r],u.call(t,r)<0&&e.push(r+"={"+p+"}");return e}.call(this).join(";")}}),i},r=function(e){var n,r,i,o,a,s,c,l;for(i=0,c="name",a=null,n="",l=null,s={},o={},Object.defineProperty(s,"__original__",{value:o}),Object.defineProperty(s,"toString",{value:function(){var e,n;return function(){var r,i,a,s,c;c=[];for(e in this)n=this[e],u.call(t,e)<0&&c.push(o[e].name+"="+(null!=(r=null!=(i=o[e].escape)?i[0]:void 0)?r:"")+n+(null!=(a=null!=(s=o[e].escape)?s[1]:void 0)?a:""));return c}.call(this).join(";")}});i<e.length;){switch(r=e.charAt(i)){case"=":"name"===c?(n=n.trim(),a=n.toLowerCase(),o[a]={name:n},c="value",n=""):n+=r;break;case"'":case'"':if("value"!==c)throw new Error("Invalid connection string.");n.trim().length?l&&r===l?r===e.charAt(i+1)?(n+=r,i++):(s[a]=n,a=null,c=null,n="",l=null):n+=r:(o[a].escape=[r,r],l=r,n="");break;case"{":if("value"!==c)throw new Error("Invalid connection string.");n.trim().length?n+=r:(o[a].escape=["{","}"],l="{}",n="");break;case"}":if("value"!==c)throw new Error("Invalid connection string.");"{}"===l?(s[a]=n,a=null,c=null,n="",l=null):n+=r;break;case";":"value"===c?l?n+=r:(s[a]=n,a=null,c="name",n=""):(n="",c="name");break;default:n+=r}i++}return"value"===c&&(s[a]=n),s},a=function(e){var t,n,o,a,s,u,c,l,h,f,p,d,g,m,v,y,b,E,w,_,T,I;if(n=/^(mssql|tedious|msnodesql|tds)\:\/\//i.test(e)?i(e):r(e),"msnodesql"===n.driver)return n.driver="SQL Server Native Client 11.0",null!=(o=n.__original__)&&(o.driver={name:"Driver",escape:["{","}"]}),{driver:"msnodesql",connectionString:n.toString()};if(I=null!=(a=n.uid)?a:n["user id"],T=null!=(g=null!=(m=null!=(v=null!=(y=n.server)?y:n.address)?v:n.addr)?m:n["data source"])?g:n["network address"],t={driver:n.driver,password:null!=(b=n.pwd)?b:n.password,database:null!=(E=n.database)?E:n["initial catalog"],connectionTimeout:null!=(w=null!=(_=null!=(s=n.connectionTimeout)?s:n.timeout)?_:n["connect timeout"])?w:n["connection timeout"],requestTimeout:null!=(u=n.requestTimeout)?u:n["request timeout"],stream:"true"===(c=null!=(l=n.stream)?l.toLowerCase():void 0)||"yes"===c||"1"===c,options:{encrypt:"true"===(h=null!=(f=n.encrypt)?f.toLowerCase():void 0)||"yes"===h||"1"===h}},null!=n.useUTC&&(t.options.useUTC="true"===(p=n.useUTC.toLowerCase())||"yes"===p||"1"===p),null!=t.connectionTimeout&&(t.connectionTimeout=parseInt(t.connectionTimeout)),null!=t.requestTimeout&&(t.requestTimeout=parseInt(t.requestTimeout)),/^(.*)\\(.*)$/.exec(I)&&(t.domain=RegExp.$1,I=RegExp.$2),T){if(T=T.trim(),/^np\:/i.test(T))throw new Error("Connection via Named Pipes is not supported.");/^tcp\:/i.test(T)&&(T=T.substr(4)),/^(.*)\\(.*)$/.exec(T)&&(T=RegExp.$1,t.options.instanceName=RegExp.$2),/^(.*),(.*)$/.exec(T)&&(T=RegExp.$1.trim(),t.port=parseInt(RegExp.$2.trim())),"."!==(d=T.toLowerCase())&&"(.)"!==d&&"(localdb)"!==d&&"(local)"!==d||(T="localhost")}return t.user=I,t.server=T,t},e.exports={parse:r,resolve:a}}).call(this)},function(e,t,n){(function(){var e;try{if("0.1.0"!==n(117).version)return;n(8).TdsConstants.dataTypesByName.GUIDTYPE.sqlType="UniqueIdentifier",n(64).Connection.prototype.setAutoCommit=function(e,t){if(this._autoCommit===e)return t();if(null!=this._currentStatement)throw new Error("Cannot change auto commit while statement is executing");return this._pendingCallback=t,this._currentStatement="#setAutoCommit",e?this._client.sqlBatch("SET IMPLICIT_TRANSACTIONS OFF"):this._client.sqlBatch("SET IMPLICIT_TRANSACTIONS ON")}}catch(t){e=t,console.log(e)}}).call(this)},function(e,t){"use strict";function n(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,a=arguments.length;switch(a){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,n)});case 4:return process.nextTick(function(){e.call(null,t,n,r)});default:for(i=new Array(a-1),o=0;o<i.length;)i[o++]=arguments[o];return process.nextTick(function(){e.apply(null,i)})}}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports=n:e.exports=process.nextTick},function(e,t){"use strict";function n(e,t,n){e.writeUInt32LE(0),e.writeUInt32LE(o),e.writeUInt16LE(r.TXN_DESCRIPTOR),e.writeBuffer(t),e.writeUInt32LE(n);var i=e.data;return i.writeUInt32LE(i.length,0),e}var r={QUERY_NOTIFICATIONS:1,TXN_DESCRIPTOR:2,TRACE_ACTIVITY:3},i=12,o=6+i;e.exports.writeToTrackingBuffer=n},function(e,t,n){"use strict";function r(e,t){return this instanceof r?(Error.call(this),this.message=e,this.code=t,void Error.captureStackTrace(this,this.constructor)):e instanceof r?e:new r(e,t)}function i(e,t){return this instanceof i?(Error.call(this),this.message=e,this.code=t,void Error.captureStackTrace(this,this.constructor)):e instanceof i?e:new i(e,t)}var o=n(5);e.exports.ConnectionError=r,o.inherits(r,Error),r.prototype.name="ConnectionError",e.exports.RequestError=i,o.inherits(i,Error),i.prototype.name="RequestError"},function(e,t){"use strict";var n=e.exports.versions={"7_1":1895825409,"7_2":1913192450,"7_3_A":1930035203,"7_3_B":1930100739,"7_4":1946157060},r=e.exports.versionsByValue={};for(var i in n)r[n[i]]=i},function(e,t){"use strict";function n(e,t,n){e.readUInt16LE(function(r){var i=!!(r&a.MORE),o=!!(r&a.ERROR),s=!!(r&a.COUNT),u=!!(r&a.ATTN),c=!!(r&a.SRVERROR);e.readUInt16LE(function(r){(t.tdsVersion<"7_2"?e.readUInt32LE:e.readUInt64LE).call(e,function(e){n({name:"DONE",event:"done",more:i,sqlError:o,attention:u,serverError:c,rowCount:s?e:void 0,curCmd:r})})})})}function r(e,t,r,i){n(e,r,function(e){e.name="DONE",e.event="done",i(e)})}function i(e,t,r,i){n(e,r,function(e){e.name="DONEINPROC",e.event="doneInProc",i(e)})}function o(e,t,r,i){n(e,r,function(e){e.name="DONEPROC",e.event="doneProc",i(e)})}var a={MORE:1,ERROR:2,INXACT:4,COUNT:16,ATTN:32,SRVERROR:256};e.exports.doneParser=r,e.exports.doneInProcParser=i,e.exports.doneProcParser=o},function(e,t){"use strict";function n(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];if(0!==r)return!1}return!0}function r(e){for(var t=0,n=e.length-1;n>=0;n--){var r=256*t+e[n];e[n]=Math.floor(r/10),t=r%10}return t}function i(e){for(var t=e.length,n=0;n<t;n++)e[n]=255^e[n];for(var n=0;n<t&&(e[n]=e[n]+1,e[n]>255);n++)e[n]=0}function o(e){var t=Array.prototype.slice.call(e,0,e.length);if(n(t))return"0";var o=void 0;128&t[t.length-1]?(o="-",i(t)):o="";for(var a="";!n(t);){var s=r(t);a=s+a}return o+a}function a(e){var t=e<0,n=Math.abs(e),r=n%4294967296;n=n/4294967296|0;for(var i=new Buffer(8),o=0;o<=7;o++)i[o]=255&r,r=3===o?n:r>>>8;if(t)for(var a=1,o=0;o<=7;o++){var s=(255^i[o])+a;i[o]=255&s,a=s>>8}return i}e.exports.convertLEBytesToString=o,e.exports.numberToInt64LE=a},function(e,t,n){"use strict";var r=n(2).default,i=n(1).default,o=n(28),a=n(35).writeToTrackingBuffer,s=e.exports.OPERATION_TYPE={TM_GET_DTC_ADDRESS:0,TM_PROPAGATE_XACT:1,TM_BEGIN_XACT:5,TM_PROMOTE_XACT:6,TM_COMMIT_XACT:7,TM_ROLLBACK_XACT:8,TM_SAVE_XACT:9},u=e.exports.ISOLATION_LEVEL={NO_CHANGE:0,READ_UNCOMMITTED:1,READ_COMMITTED:2,REPEATABLE_READ:3,SERIALIZABLE:4,SNAPSHOT:5},c={};for(var l in u){var h=u[l];c[h]=l}var f=function(){function e(t,n){i(this,e),this.name=t,this.isolationLevel=n,this.outstandingRequestCount=1}return r(e,[{key:"beginPayload",value:function(e){var t=this,n=new o(100,"ucs2");return a(n,e,this.outstandingRequestCount),n.writeUShort(s.TM_BEGIN_XACT),n.writeUInt8(this.isolationLevel),n.writeUInt8(2*this.name.length),n.writeString(this.name,"ucs2"),{data:n.data,toString:function(){return"Begin Transaction: name="+t.name+", isolationLevel="+c[t.isolationLevel]}}}},{key:"commitPayload",value:function(e){var t=this,n=new o(100,"ascii");return a(n,e,this.outstandingRequestCount),n.writeUShort(s.TM_COMMIT_XACT),n.writeUInt8(2*this.name.length),n.writeString(this.name,"ucs2"),n.writeUInt8(0),{data:n.data,toString:function(){return"Commit Transaction: name="+t.name}}}},{key:"rollbackPayload",value:function(e){var t=this,n=new o(100,"ascii");return a(n,e,this.outstandingRequestCount),n.writeUShort(s.TM_ROLLBACK_XACT),n.writeUInt8(2*this.name.length),n.writeString(this.name,"ucs2"),n.writeUInt8(0),{data:n.data,toString:function(){return"Rollback Transaction: name="+t.name}}}},{key:"savePayload",value:function(e){var t=this,n=new o(100,"ascii");return a(n,e,this.outstandingRequestCount),n.writeUShort(s.TM_SAVE_XACT),n.writeUInt8(2*this.name.length),n.writeString(this.name,"ucs2"),{data:n.data,toString:function(){return"Save Transaction: name="+t.name}}}},{key:"isolationLevelToTSQL",value:function(){switch(this.isolationLevel){case u.READ_UNCOMMITTED:return"READ UNCOMMITTED";case u.READ_COMMITTED:return"READ COMMITTED";case u.REPEATABLE_READ:return"REPEATABLE READ";case u.SERIALIZABLE:return"SERIALIZABLE";case u.SNAPSHOT:return"SNAPSHOT"}return""}}]),e}();e.exports.Transaction=f},function(e,t,n){"use strict";function r(e,t,n){t.hasTextPointerAndTimestamp?e.readUInt8(function(t){0!==t?e.readBuffer(t,function(){e.readBuffer(8,function(){n(void 0)})}):n(!0)}):n(void 0)}function i(e,t,n,r,i){if(r)return i(0);if(n.isVariantValue)return i(n.dataLength);switch(48&t.id){case 16:return i(0);case 32:if(n.dataLength===U)return i(void 0);switch(t.dataLengthLength){case 0:return i(void 0);case 1:return e.readUInt8(i);case 2:return e.readUInt16LE(i);case 4:return e.readUInt32LE(i);default:return e.emit("error",new Error("Unsupported dataLengthLength "+t.dataLengthLength+" for data type "+t.name))}break;case 48:return i(1<<((12&t.id)>>2))}}function o(e,t,n,f){var p=t.type;r(e,p,function(r){i(e,p,t,r,function(d){switch(p.name){case"Null":return f(null);case"TinyInt":return e.readUInt8(f);case"Int":return e.readInt32LE(f);case"SmallInt":return e.readInt16LE(f);case"BigInt":return e.readBuffer(8,function(e){f(C(e))});case"IntN":switch(d){case 0:return f(null);case 1:return e.readUInt8(f);case 2:return e.readInt16LE(f);case 4:return e.readInt32LE(f);case 8:return e.readBuffer(8,function(e){f(C(e))});default:return e.emit("error",new Error("Unsupported dataLength "+d+" for IntN"))}break;case"Real":return e.readFloatLE(f);case"Float":return e.readDoubleLE(f);case"FloatN":switch(d){case 0:return f(null);case 4:return e.readFloatLE(f);case 8:return e.readDoubleLE(f);default:return e.emit("error",new Error("Unsupported dataLength "+d+" for FloatN"))}break;case"Money":case"SmallMoney":case"MoneyN":switch(d){case 0:return f(null);case 4:return e.readInt32LE(function(e){f(e/B)});case 8:return e.readInt32LE(function(t){e.readUInt32LE(function(e){f((e+4294967296*t)/B)})});default:return e.emit("error",new Error("Unsupported dataLength "+d+" for MoneyN"))}break;case"Bit":return e.readUInt8(function(e){f(!!e)});case"BitN":switch(d){case 0:return f(null);case 1:return e.readUInt8(function(e){f(!!e)})}break;case"VarChar":case"Char":var w=t.collation.codepage;return t.dataLength===U?l(e,w,f):s(e,d,w,f);case"NVarChar":case"NChar":return t.dataLength===U?h(e,f):u(e,d,f);case"VarBinary":case"Binary":return t.dataLength===U?c(e,f):a(e,d,f);case"Text":return r?f(null):s(e,d,t.collation.codepage,f);case"NText":return r?f(null):u(e,d,f);case"Image":return r?f(null):a(e,d,f);case"Xml":return h(e,f);case"SmallDateTime":return g(e,n.useUTC,f);case"DateTime":return m(e,n.useUTC,f);case"DateTimeN":switch(d){case 0:return f(null);case 4:return g(e,n.useUTC,f);case 8:return m(e,n.useUTC,f)}break;case"TimeN":return 0===d?f(null):v(e,d,t.scale,n.useUTC,f);case"DateN":return 0===d?f(null):y(e,n.useUTC,f);case"DateTime2N":return 0===d?f(null):b(e,d,t.scale,n.useUTC,f);case"DateTimeOffsetN":return 0===d?f(null):E(e,d,t.scale,f);case"NumericN":case"DecimalN":return 0===d?f(null):e.readUInt8(function(n){n=1===n?1:-1;var r=void 0;switch(d-1){case 4:r=e.readUInt32LE;break;case 8:r=e.readUNumeric64LE;break;case 12:r=e.readUNumeric96LE;break;case 16:r=e.readUNumeric128LE;break;default:return e.emit("error",new Error(_("Unsupported numeric size %d",d-1)))}r.call(e,function(e){f(e*n/Math.pow(10,t.scale))})});case"UniqueIdentifierN":switch(d){case 0:return f(null);case 16:return e.readBuffer(16,function(e){f(I.arrayToGuid(e))});default:return e.emit("error",new Error(_("Unsupported guid size %d",d-1)))}break;case"UDT":return c(e,f);case"Variant":var k=t.valueMetaData={};return Object.defineProperty(k,"isVariantValue",{value:!0}),e.readUInt8(function(t){return e.readUInt8(function(r){return k.dataLength=d-r-2,k.type=T[t],S(e,k.type,function(r){return k.precision=r,L(e,k.type,function(r){return k.scale=r,N(e,k.type,function(r){return k.collation=r,165===t||173===t||167===t||175===t||231===t||239===t?i(e,k.type,{},null,function(t){return k.dataLength=t,o(e,k,n,f)}):o(e,k,n,f)})})})})});default:return e.emit("error",new Error(_("Unrecognised type %s",p.name)))}})})}function a(e,t,n){return t===k?n(null):e.readBuffer(t,n)}function s(e,t,n,r){return null==n&&(n=O),t===k?r(null):e.readBuffer(t,function(e){r(w.decode(e,n))})}function u(e,t,n){return t===k?n(null):e.readBuffer(t,function(e){n(e.toString("ucs2"))})}function c(e,t){return f(e,t)}function l(e,t,n){null==t&&(t=O),f(e,function(e){n(e?w.decode(e,t):null)})}function h(e,t){f(e,function(e){t(e?e.toString("ucs2"):null)})}function f(e,t){e.readBuffer(8,function(n){if(n.equals(D))return t(null);if(n.equals(A))return d(e,t);var r=n.readUInt32LE(0),i=n.readUInt32LE(4);i>=2<<21&&console.warn("Read UInt64LE > 53 bits : high="+i+", low="+r);var o=r+4294967296*i;return p(e,o,t)})}function p(e,t,n){function r(t){e.readUInt32LE(function(n){return n?void e.readBuffer(n,function(e){e.copy(i,o),o+=n,r(t)}):t()})}var i=new Buffer(t),o=0;r(function(){o!==t&&e.emit("error",new Error("Partially Length-prefixed Bytes unmatched lengths : expected "+t+", but got "+o+" bytes")),n(i)})}function d(e,t){function n(t){e.readUInt32LE(function(o){return o?void e.readBuffer(o,function(e){r.push(e),i+=o,n(t)}):t()})}var r=[],i=0;n(function(){t(Buffer.concat(r,i))})}function g(e,t,n){e.readUInt16LE(function(r){e.readUInt16LE(function(e){var i=void 0;t?(i=new Date(Date.UTC(1900,0,1)),i.setUTCDate(i.getUTCDate()+r),i.setUTCMinutes(i.getUTCMinutes()+e)):(i=new Date(1900,0,1),i.setDate(i.getDate()+r),i.setMinutes(i.getMinutes()+e)),n(i)})})}function m(e,t,n){e.readInt32LE(function(r){e.readUInt32LE(function(e){var i=e*P,o=void 0;t?(o=new Date(Date.UTC(1900,0,1)),o.setUTCDate(o.getUTCDate()+r),o.setUTCMilliseconds(o.getUTCMilliseconds()+i)):(o=new Date(1900,0,1),o.setDate(o.getDate()+r),o.setMilliseconds(o.getMilliseconds()+i)),n(o)})})}function v(e,t,n,r,i){var o=void 0;switch(t){case 3:o=e.readUInt24LE;break;case 4:o=e.readUInt32LE;break;case 5:o=e.readUInt40LE}o.call(e,function(e){if(n<7)for(var t=n;t<7;t++)e*=10;var o=void 0;o=r?new Date(Date.UTC(1970,0,1,0,0,0,e/1e4)):new Date(1970,0,1,0,0,0,e/1e4),Object.defineProperty(o,"nanosecondsDelta",{enumerable:!1,value:e%1e4/Math.pow(10,7)}),i(o)})}function y(e,t,n){e.readUInt24LE(function(e){n(t?new Date(Date.UTC(2e3,0,e-730118)):new Date(2e3,0,e-730118))})}function b(e,t,n,r,i){v(e,t-3,n,r,function(t){e.readUInt24LE(function(e){var n=void 0;n=r?new Date(Date.UTC(2e3,0,e-730118,0,0,0,+t)):new Date(2e3,0,e-730118,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),Object.defineProperty(n,"nanosecondsDelta",{enumerable:!1,value:t.nanosecondsDelta}),i(n)})})}function E(e,t,n,r){v(e,t-5,n,!0,function(t){e.readUInt24LE(function(n){e.readInt16LE(function(){var e=new Date(Date.UTC(2e3,0,n-730118,0,0,0,+t));Object.defineProperty(e,"nanosecondsDelta",{enumerable:!1,value:t.nanosecondsDelta}),r(e)})})})}var w=n(108),_=n(18).sprintf,T=n(25).TYPE,I=n(67),S=n(20).readPrecision,L=n(20).readScale,N=n(20).readCollation,C=n(39).convertLEBytesToString,k=65535,U=65535,P=3+1/3,B=1e4,D=new Buffer([255,255,255,255,255,255,255,255]),A=new Buffer([254,255,255,255,255,255,255,255]),O="utf8";e.exports=o},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("fs")},function(e,t,n){var r=n(85);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(90),i=n(30),o=n(44),a="prototype",s=function(e,t,n){var u,c,l,h=e&s.F,f=e&s.G,p=e&s.S,d=e&s.P,g=e&s.B,m=e&s.W,v=f?i:i[t]||(i[t]={}),y=f?r:p?r[t]:(r[t]||{})[a];f&&(n=t);for(u in n)c=!h&&y&&u in y,c&&u in v||(l=c?y[u]:n[u],v[u]=f&&"function"!=typeof y[u]?n[u]:g&&c?o(l,r):m&&y[u]==l?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t[a]=e[a],t}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((v[a]||(v[a]={}))[u]=l))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,e.exports=s},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=[["0","\0",127],["a140",""],["a1a1","",4,""],["a240","",7,""],["a2a1","",9,"",9,"",8,"",25,"",21],["a340","",16,"",6,"",16,"",6,"",10],["a3a1","",25,""],["a3e1",""],["a440",""],["a4a1",""],["a540",""],["a5a1",""],["a640",""],["a6a1",""],["a740",""],["a7a1",""],["a840",""],["a8a1",""],["a940",""],["a9a1",""],["aa40",""],["aaa1",""],["ab40",""],["aba1",""],["ac40",""],["aca1",""],["ad40",""],["ada1",""],["ae40",""],["aea1",""],["af40",""],["afa1",""],["b040",""],["b0a1",""],["b140",""],["b1a1",""],["b240",""],["b2a1",""],["b340",""],["b3a1",""],["b440",""],["b4a1",""],["b540",""],["b5a1",""],["b640",""],["b6a1",""],["b740",""],["b7a1",""],["b840",""],["b8a1",""],["b940",""],["b9a1",""],["ba40",""],["baa1",""],["bb40",""],["bba1",""],["bc40",""],["bca1",""],["bd40",""],["bda1",""],["be40",""],["bea1",""],["bf40",""],["bfa1",""],["c040",""],["c0a1",""],["c140",""],["c1a1",""],["c240",""],["c2a1",""],["c340",""],["c3a1",""],["c440",""],["c4a1",""],["c540",""],["c5a1",""],["c640",""],["c940",""],["c9a1",""],["ca40",""],["caa1",""],["cb40",""],["cba1",""],["cc40",""],["cca1",""],["cd40",""],["cda1",""],["ce40",""],["cea1",""],["cf40",""],["cfa1",""],["d040",""],["d0a1",""],["d140",""],["d1a1",""],["d240",""],["d2a1",""],["d340",""],["d3a1",""],["d440",""],["d4a1",""],["d540",""],["d5a1",""],["d640",""],["d6a1",""],["d740",""],["d7a1",""],["d840",""],["d8a1",""],["d940",""],["d9a1",""],["da40",""],["daa1",""],["db40",""],["dba1",""],["dc40",""],["dca1",""],["dd40",""],["dda1",""],["de40",""],["dea1",""],["df40",""],["dfa1",""],["e040",""],["e0a1",""],["e140",""],["e1a1",""],["e240",""],["e2a1",""],["e340",""],["e3a1",""],["e440",""],["e4a1",""],["e540",""],["e5a1",""],["e640",""],["e6a1",""],["e740",""],["e7a1",""],["e840",""],["e8a1",""],["e940",""],["e9a1",""],["ea40",""],["eaa1",""],["eb40",""],["eba1",""],["ec40",""],["eca1",""],["ed40",""],["eda1",""],["ee40",""],["eea1",""],["ef40",""],["efa1",""],["f040",""],["f0a1",""],["f140",""],["f1a1",""],["f240",""],["f2a1",""],["f340",""],["f3a1",""],["f440",""],["f4a1",""],["f540",""],["f5a1",""],["f640",""],["f6a1",""],["f740",""],["f7a1",""],["f840",""],["f8a1",""],["f940",""],["f9a1",""]];
},function(e,t){e.exports=[["a140","",62],["a180","",32],["a240","",62],["a280","",32],["a2ab","",5],["a2e3",""],["a2ef",""],["a2fd",""],["a340","",62],["a380","",31,""],["a440","",62],["a480","",32],["a4f4","",10],["a540","",62],["a580","",32],["a5f7","",7],["a640","",62],["a680","",32],["a6b9","",7],["a6d9","",6],["a6ec",""],["a6f3",""],["a6f6","",8],["a740","",62],["a780","",32],["a7c2","",14],["a7f2","",12],["a896","",10],["a8bc",""],["a8bf",""],["a8c1",""],["a8ea","",20],["a958",""],["a95b",""],["a95d",""],["a989","",11],["a997","",12],["a9f0","",14],["aaa1","",93],["aba1","",93],["aca1","",93],["ada1","",93],["aea1","",93],["afa1","",93],["d7fa","",4],["f8a1","",93],["f9a1","",93],["faa1","",93],["fba1","",93],["fca1","",93],["fda1","",93],["fe50",""],["fe80","",6,"",93]]},function(e,t,n){(function(){var e,t,r,i,o,a,s,u;o=n(43),a=n(164),s=n(23),u=function(e){return process.stdout.write(e)},Buffer.prototype.toJSON=function(){return"0x"+this.toString("hex")},t=process.argv[2],t||(t=process.cwd()),t=a.resolve(t),o.lstatSync(t).isDirectory()&&(t=a.resolve(t,"./.mssql.json")),o.existsSync(t)||(console.error("Config file not found."),process.exit(1));try{r=o.readFileSync(t)}catch(e){i=e,console.error("Failed to load config file. "+i.message),process.exit(1)}try{r=JSON.parse(r)}catch(e){i=e,console.error("Failed to parse config file. "+i.message),process.exit(1)}e=[],process.stdin.setEncoding("utf8"),process.stdin.on("readable",function(){return e.push(process.stdin.read())}),process.stdin.on("end",function(){var t,n,i;return i=e.join(""),n=0,t=0,i.length||(console.error("Statement is empty."),process.exit(1)),s.connect(r,function(e){var r;return e&&(console.error(e.message),process.exit(1)),u("["),r=new s.Request,r.stream=!0,r.on("recordset",function(e){return t=0,n++>0&&u("],"),u("[")}),r.on("error",function(e){return console.error(e.message),s.close(),process.exit(1)}),r.on("row",function(e){return t++>0&&u(","),u(JSON.stringify(e))}),r.on("done",function(){return n>0&&u("]"),u("]\n"),s.close(),process.exit(0)}),r.query(i)})}),process.on("uncaughtException",function(e){return"EPIPE"===e.code?console.error("Failed to pipe output stream."):console.error(e.message),process.exit(1)})}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l,h,f,p,d,g,m,v,y,b,E=function(e,t){function n(){this.constructor=e}for(var r in t)w.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},w={}.hasOwnProperty;u=n(22).Pool,m=n(162),y=n(5),v=n(3),c=v.TYPES,d=v.declare,l=n(17).PARSERS,a=n(11),i=n(3).DECLARATIONS,o=new Buffer(0),s="JSON_F52E2B61-18A1-11d1-B105-00805F49916B",h="XML_F52E2B61-18A1-11d1-B105-00805F49916B",r="Driver={SQL Server Native Client 11.0};Server={#{server},#{port}};Database={#{database}};Uid={#{user}};Pwd={#{password}};Trusted_Connection={#{trusted}};",t="Driver={SQL Server Native Client 11.0};Server={#{server}\\#{instance}};Database={#{database}};Uid={#{user}};Pwd={#{password}};Trusted_Connection={#{trusted}};",f=function(e,t){if(null==e)return t===c.Binary||t===c.VarBinary||t===c.Image?o:null;switch(t){case c.VarChar:case c.NVarChar:case c.Char:case c.NChar:case c.Xml:case c.Text:case c.NText:"string"==typeof e||e instanceof String||(e=e.toString());break;case c.Int:case c.TinyInt:case c.BigInt:case c.SmallInt:"number"==typeof e||e instanceof Number||(e=parseInt(e),isNaN(e)&&(e=null));break;case c.Float:case c.Real:case c.Decimal:case c.Numeric:case c.SmallMoney:case c.Money:"number"==typeof e||e instanceof Number||(e=parseFloat(e),isNaN(e)&&(e=null));break;case c.Bit:"boolean"==typeof e||e instanceof Boolean||(e=Boolean(e));break;case c.DateTime:case c.SmallDateTime:case c.DateTimeOffset:case c.Date:e instanceof Date||(e=new Date(e));break;case c.Binary:case c.VarBinary:case c.Image:e instanceof Buffer||(e=new Buffer(e.toString()))}return e},p=function(e){var t,n,r,o,a;for(a={},r=n=0,o=e.length;n<o;r=++n)t=e[r],a[t.name]={index:r,name:t.name,length:t.size,type:i[t.sqlType]},null!=t.udtType&&(a[t.name].udt={name:t.udtType},i[t.udtType]&&(a[t.name].type=i[t.udtType]));return a},g=function(e){switch(e){case a.READ_UNCOMMITTED:return"READ UNCOMMITTED";case a.READ_COMMITTED:return"READ COMMITTED";case a.REPEATABLE_READ:return"REPEATABLE READ";case a.SERIALIZABLE:return"SERIALIZABLE";case a.SNAPSHOT:return"SNAPSHOT";default:throw new TransactionError("Invalid isolation level.")}},b=function(e,t){return"time"===t.sqlType&&null!=e?(e.setFullYear(1970),e):"udt"===t.sqlType&&null!=e&&l[t.udtType]?l[t.udtType](e):e},e.exports=function(e,n,i,o,a,c){var l,v,w;return l=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return E(n,e),n.prototype.pool=null,n.prototype.connect=function(e,n){var i,a,s,c,l,h,f;if(s=r,null!=e.options.instanceName&&(s=t),i={connectionString:null!=(l=e.connectionString)?l:s},i.connectionString=i.connectionString.replace(new RegExp("#{([^}]*)}","g"),function(t){var n,r;return n=t.substr(2,t.length-3),"instance"===n?e.options.instanceName:"trusted"===n?e.options.trustedConnection?"Yes":"No":null!=(r=e[n])?r:""}),a={name:"mssql",max:10,min:0,idleTimeoutMillis:3e4,create:function(e){return function(e){return m.open(i.connectionString,function(t,n){return t&&(t=o(t)),t?e(t,null):e(null,n)})}}(this),validate:function(e){return null!=e&&!e.hasError},destroy:function(e){return null!=e?e.close():void 0}},e.pool){h=e.pool;for(c in h)f=h[c],a[c]=f}return this.pool=u(a,i),this.pool.acquire(function(e){return function(t,r){return!t||t instanceof Error||(t=new Error(t)),t?e.pool.drain(function(){var t;return null!=(t=e.pool)&&t.destroyAllNow(),e.pool=null}):e.pool.release(r),n(t)}}(this))},n.prototype.close=function(e){return this.pool?this.pool.drain(function(t){return function(){var n;return null!=(n=t.pool)&&n.destroyAllNow(),t.pool=null,e(null)}}(this)):e(null)},n}(e),w=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.begin=function(e){return this.connection.pool.acquire(function(t){return function(n,r){return n?e(n):(t._pooledConnection=r,t.request()._dedicated(t._pooledConnection).query("set transaction isolation level "+g(t.isolationLevel)+";begin tran;",e))}}(this))},t.prototype.commit=function(e){return this.request()._dedicated(this._pooledConnection).query("commit tran",function(t){return function(n){return t.connection.pool.release(t._pooledConnection),t._pooledConnection=null,e(n)}}(this))},t.prototype.rollback=function(e){return this.request()._dedicated(this._pooledConnection).query("rollback tran",function(t){return function(n){return t.connection.pool.release(t._pooledConnection),t._pooledConnection=null,e(n)}}(this))},t}(n),v=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.batch=function(e,n){return t.prototype.query.call(this,e,n)},t.prototype.bulk=function(e,t){return process.nextTick(function(){return t(c("Bulk insert is not supported in 'msnodesql' driver.","ENOTSUPP"))})},t.prototype.query=function(e,t){var n,r,i,o,a,u,l,g,m,v,E,w,_;return 0===e.length?process.nextTick(function(){var e;return this.verbose&&!this.nested&&(this._log("---------- response -----------"),e=Date.now()-_,this._log(" duration: "+e+"ms"),this._log("---------- completed ----------")),"function"==typeof t?t(null,this.multiple||this.nested?[]:null):void 0}):(E=null,r=null,m=null,v=[],_=Date.now(),i=!1,a=!1,n=null,this.nested||(o=function(){var e,t;e=this.parameters,t=[];for(u in e)g=e[u],t.push("@"+g.name+" "+d(g.type,g));return t}.call(this),w=function(){var e,t;e=this.parameters,t=[];for(u in e)g=e[u],1===g.io&&t.push("set @"+g.name+"=?");return t}.call(this),l=function(){var e,t;e=this.parameters,t=[];for(u in e)g=e[u],2===g.io&&t.push("@"+g.name+" as '"+g.name+"'");return t}.call(this),o.length&&(e="declare "+o.join(",")+";"+w.join(";")+";"+e+";"),l.length&&(e+="select "+l.join(",")+";",i=!0)),this._acquire(function(o){return function(l,d){var w;return l?(d&&o._release(d),"function"==typeof t?t(l):void 0):(o.verbose&&!o.nested&&o._log("---------- sql query ----------\n    query: "+e),w=d.queryRaw(e,function(){var e,t;e=this.parameters,t=[];for(u in e)g=e[u],1===g.io&&t.push(f(g.value,g.type));return t}.call(o)),o.verbose&&!o.nested&&o._log("---------- response -----------"),w.on("meta",function(e){var t,i;if(E){if(a){if(r[0].name===s&&o.connection.config.parseJSON===!0)try{E=JSON.parse(n.join("")),o.stream||(v[v.length-1][0]=E)}catch(e){t=e,E=null,t=c(new Error("Failed to parse incoming JSON. "+t.message),"EJSON"),o.stream?o.emit("error",t):console.error(t)}else E[r[0].name]=n.join("");n=null}o.verbose&&(o._log(y.inspect(E)),o._log("---------- --------------------")),null==E.___return___&&o.stream&&o.emit("row",E)}return E=null,r=e,m=[],Object.defineProperty(m,"columns",{enumerable:!1,value:p(e)}),a=!1,1!==e.length||(i=e[0].name)!==s&&i!==h||(a=!0,n=[]),o.stream?null==m.columns.___return___?o.emit("recordset",m.columns):void 0:v.push(m)}),w.on("row",function(e){if(E){if(a)return;o.verbose&&(o._log(y.inspect(E)),o._log("---------- --------------------")),null==E.___return___&&o.stream&&o.emit("row",E)}if(E={},!o.stream)return m.push(E)}),w.on("column",function(e,t,i){var o;return a?n.push(t):(t=b(t,r[e]),o=E[r[e].name],null!=o?o instanceof Array?o.push(t):E[r[e].name]=[o,t]:E[r[e].name]=t)}),w.on("rowcount",function(e){if(e>0)return o.rowsAffected+=e}),w.once("error",function(e){var n,r;return"string"==typeof e.sqlstate&&"08s01"===e.sqlstate.toLowerCase()&&(d.hasError=!0),n=c(e),/^\[Microsoft\]\[SQL Server Native Client 11\.0\](?:\[SQL Server\])?([\s\S]*)$/.exec(e.message)&&(n.message=RegExp.$1),n.code="EREQUEST",o.verbose&&!o.nested&&(r=Date.now()-_,o._log("    error: "+e),o._log(" duration: "+r+"ms"),o._log("---------- completed ----------")),o._release(d),"function"==typeof t?t(n):void 0}),w.once("done",function(){var e,l,h,f,p;if(!o.nested){if(E){if(a){if(r[0].name===s&&o.connection.config.parseJSON===!0)try{E=JSON.parse(n.join("")),o.stream||(v[v.length-1][0]=E)}catch(e){l=e,E=null,l=c(new Error("Failed to parse incoming JSON. "+l.message),"EJSON"),o.stream?o.emit("error",l):console.error(l)}else E[r[0].name]=n.join("");n=null}o.verbose&&(o._log(y.inspect(E)),o._log("---------- --------------------")),null==E.___return___&&o.stream&&o.emit("row",E)}if(i){h=null!=(f=v.pop())?f[0]:void 0,p=o.parameters;for(u in p)g=p[u],2===g.io&&(g.value=h[g.name],o.verbose&&o._log("   output: @"+g.name+", "+g.type.declaration+", "+g.value))}o.verbose&&(e=Date.now()-_,o._log(" duration: "+e+"ms"),o._log("---------- completed ----------"))}return o._release(d),o.stream?t(null,o.nested?E:null):"function"==typeof t?t(null,o.multiple||o.nested?v:v[0]):void 0}))}}(this)))},t.prototype.execute=function(e,n){var r,i,o,a,s,u;this.verbose&&this._log("---------- sql execute --------\n     proc: "+e),u=Date.now(),r="declare "+["@___return___ int"].concat(function(){var e,t;e=this.parameters,t=[];for(i in e)o=e[i],2===o.io&&t.push("@"+o.name+" "+d(o.type,o));return t}.call(this)).join(", ")+";",r+="exec @___return___ = "+e+" ",s=[],a=this.parameters;for(i in a)o=a[i],this.verbose&&this._log("   "+(1===o.io?" input":"output")+": @"+o.name+", "+o.type.declaration+", "+o.value),2===o.io?s.push("@"+o.name+"=@"+o.name+" output"):s.push("@"+o.name+"=?");return r+=s.join(", ")+";",r+="select "+["@___return___ as '___return___'"].concat(function(){var e,t;e=this.parameters,t=[];for(i in e)o=e[i],2===o.io&&t.push("@"+o.name+" as '"+o.name+"'");return t}.call(this)).join(", ")+";",this.verbose&&this._log("---------- response -----------"),this.nested=!0,t.prototype.query.call(this,r,function(e){return function(t,r){var a,s,c,l,h;if(e.nested=!1,t)return e.verbose&&(a=Date.now()-u,e._log("    error: "+t),e._log(" duration: "+a+"ms"),e._log("---------- completed ----------")),"function"==typeof n?n(t):void 0;if(s=e.stream?r:null!=(c=r.pop())?c[0]:void 0,s&&null!=s.___return___){h=s.___return___,l=e.parameters;for(i in l)o=l[i],2===o.io&&(o.value=s[o.name],e.verbose&&e._log("   output: @"+o.name+", "+o.type.declaration+", "+o.value))}return e.verbose&&(a=Date.now()-u,e._log("   return: "+h),e._log(" duration: "+a+"ms"),e._log("---------- completed ----------")),e.stream?n(null,null,h):(r.returnValue=h,"function"==typeof n?n(null,r,h):void 0)}}(this))},t.prototype.cancel=function(){return!1},t}(i),{Connection:l,Transaction:w,Request:v,fix:function(){}}}}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l,h,f,p,d,g,m,v,y,b,E=function(e,t){function n(){this.constructor=e}for(var r in t)w.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},w={}.hasOwnProperty;u=n(22).Pool,m=n(163),y=n(5),v=n(3),c=v.TYPES,d=v.declare,l=n(17).PARSERS,a=n(11),i=n(3).DECLARATIONS,o=new Buffer(0),s="JSON_F52E2B61-18A1-11d1-B105-00805F49916B",h="XML_F52E2B61-18A1-11d1-B105-00805F49916B",r="Driver={SQL Server Native Client 11.0};Server={#{server},#{port}};Database={#{database}};Uid={#{user}};Pwd={#{password}};Trusted_Connection={#{trusted}};",t="Driver={SQL Server Native Client 11.0};Server={#{server}\\#{instance}};Database={#{database}};Uid={#{user}};Pwd={#{password}};Trusted_Connection={#{trusted}};",f=function(e,t){if(null==e)return t===c.Binary||t===c.VarBinary||t===c.Image?o:null;switch(t){case c.VarChar:case c.NVarChar:case c.Char:case c.NChar:case c.Xml:case c.Text:case c.NText:"string"==typeof e||e instanceof String||(e=e.toString());break;case c.Int:case c.TinyInt:case c.BigInt:case c.SmallInt:"number"==typeof e||e instanceof Number||(e=parseInt(e),isNaN(e)&&(e=null));break;case c.Float:case c.Real:case c.Decimal:case c.Numeric:case c.SmallMoney:case c.Money:"number"==typeof e||e instanceof Number||(e=parseFloat(e),isNaN(e)&&(e=null));break;case c.Bit:"boolean"==typeof e||e instanceof Boolean||(e=Boolean(e));break;case c.DateTime:case c.SmallDateTime:case c.DateTimeOffset:case c.Date:e instanceof Date||(e=new Date(e));break;case c.Binary:case c.VarBinary:case c.Image:e instanceof Buffer||(e=new Buffer(e.toString()))}return e},p=function(e){var t,n,r,o,a;for(a={},r=n=0,o=e.length;n<o;r=++n)t=e[r],a[t.name]={index:r,name:t.name,length:t.size,type:i[t.sqlType]},null!=t.udtType&&(a[t.name].udt={name:t.udtType},i[t.udtType]&&(a[t.name].type=i[t.udtType]));return a},g=function(e){switch(e){case a.READ_UNCOMMITTED:return"READ UNCOMMITTED";case a.READ_COMMITTED:return"READ COMMITTED";case a.REPEATABLE_READ:return"REPEATABLE READ";case a.SERIALIZABLE:return"SERIALIZABLE";case a.SNAPSHOT:return"SNAPSHOT";default:throw new TransactionError("Invalid isolation level.")}},b=function(e,t){return"time"===t.sqlType&&null!=e?(e.setFullYear(1970),e):"udt"===t.sqlType&&null!=e&&l[t.udtType]?l[t.udtType](e):e},e.exports=function(e,n,i,o,a,c){var l,v,w;return l=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return E(n,e),n.prototype.pool=null,n.prototype.connect=function(e,n){var i,a,s,c,l,h,f,p,d;if(s=r,null!=e.options.instanceName&&(s=t),i={conn_str:null!=(l=e.connectionString)?l:s,conn_timeout:(null!=(h=null!=(f=e.connectionTimeout)?f:e.timeout)?h:15e3)/1e3},i.conn_str=i.conn_str.replace(new RegExp("#{([^}]*)}","g"),function(t){var n,r;return n=t.substr(2,t.length-3),"instance"===n?e.options.instanceName:"trusted"===n?e.options.trustedConnection?"Yes":"No":null!=(r=e[n])?r:""}),a={name:"mssql",max:10,min:0,idleTimeoutMillis:3e4,create:function(e){return function(e){return m.open(i,function(t,n){return t&&(t=o(t)),t?e(t,null):e(null,n)})}}(this),validate:function(e){return null!=e&&!e.hasError},destroy:function(e){return null!=e?e.close():void 0}},e.pool){p=e.pool;for(c in p)d=p[c],a[c]=d}return this.pool=u(a,i),this.pool.acquire(function(e){return function(t,r){return!t||t instanceof Error||(t=new Error(t)),t?e.pool.drain(function(){var t;return null!=(t=e.pool)&&t.destroyAllNow(),e.pool=null}):e.pool.release(r),n(t)}}(this))},n.prototype.close=function(e){return this.pool?this.pool.drain(function(t){return function(){var n;return null!=(n=t.pool)&&n.destroyAllNow(),t.pool=null,e(null)}}(this)):e(null)},n}(e),w=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.begin=function(e){return this.connection.pool.acquire(function(t){return function(n,r){return n?e(n):(t._pooledConnection=r,t.request()._dedicated(t._pooledConnection).query("set transaction isolation level "+g(t.isolationLevel)+";begin tran;",e))}}(this))},t.prototype.commit=function(e){return this.request()._dedicated(this._pooledConnection).query("commit tran",function(t){return function(n){return t.connection.pool.release(t._pooledConnection),t._pooledConnection=null,e(n)}}(this))},t.prototype.rollback=function(e){return this.request()._dedicated(this._pooledConnection).query("rollback tran",function(t){return function(n){return t.connection.pool.release(t._pooledConnection),t._pooledConnection=null,e(n)}}(this))},t}(n),v=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.batch=function(e,n){return t.prototype.query.call(this,e,n)},t.prototype.bulk=function(e,t){var n;return e._makeBulk(),e.name||process.nextTick(function(){return t(c("Table name must be specified for bulk insert.","ENAME"))}),"@"===e.name.charAt(0)&&process.nextTick(function(){return t(c("You can't use table variables for bulk insert.","ENAME"))}),n=Date.now(),this._acquire(function(r){return function(i,o){var a,s,u,l,h;if(!i)return r.verbose&&r._log("-------- sql bulk load --------\n    table: "+e.name),a=function(i,a){var s,u;return i&&("string"==typeof i.sqlstate&&"08s01"===i.sqlstate.toLowerCase()&&(o.hasError=!0),s=c(i),/^\[Microsoft\]\[SQL Server Native Client 11\.0\](?:\[SQL Server\])?([\s\S]*)$/.exec(i.message)&&(s.message=RegExp.$1),s.code="EREQUEST",r.verbose&&!r.nested&&r._log("    error: "+s)),r.verbose&&(u=Date.now()-n,r._log(" duration: "+u+"ms"),r._log("---------- completed ----------")),r._release(o),s?"function"==typeof t?t(s):void 0:"function"==typeof t?t(null,e.rows.length):void 0},u=function(){var t;return t=o.tableMgr(),t.bind(e.path.replace(/\[|\]/g,""),function(t){var n,r,i,o,s,u,l,h,f,p,d;if(0===t.columns.length)return a(new c("Table was not found on the server.","ENAME"));for(d=[],h=e.rows,r=0,u=h.length;r<u;r++){for(p=h[r],o={},f=e.columns,i=s=0,l=f.length;s<l;i=++s)n=f[i],o[n.name]=p[i];d.push(o)}return t.insertRows(d,a)})},e.create?(l=e.temporary?"tempdb..["+e.name+"]":e.path,r.verbose&&(s=Date.now()-n,r._log("  message: attempting to create table "+e.path+" if not exists")),h=o.queryRaw("if object_id('"+l.replace(/'/g,"''")+"') is null "+e.declare(),function(e){return e?a(e):u()})):u()}}(this))},t.prototype.query=function(e,t){var n,r,i,o,a,u,l,g,m,v,E,w,_;return 0===e.length?process.nextTick(function(){var e;return this.verbose&&!this.nested&&(this._log("---------- response -----------"),e=Date.now()-_,this._log(" duration: "+e+"ms"),this._log("---------- completed ----------")),"function"==typeof t?t(null,this.multiple||this.nested?[]:null):void 0}):(E=null,r=null,m=null,v=[],_=Date.now(),i=!1,a=!1,n=null,this.nested||(o=function(){var e,t;e=this.parameters,t=[];for(u in e)g=e[u],t.push("@"+g.name+" "+d(g.type,g));return t}.call(this),w=function(){var e,t;e=this.parameters,t=[];for(u in e)g=e[u],1===g.io&&t.push("set @"+g.name+"=?");return t}.call(this),l=function(){var e,t;e=this.parameters,t=[];for(u in e)g=e[u],2===g.io&&t.push("@"+g.name+" as '"+g.name+"'");return t}.call(this),o.length&&(e="declare "+o.join(",")+";"+w.join(";")+";"+e+";"),l.length&&(e+="select "+l.join(",")+";",i=!0)),this._acquire(function(o){return function(l,d){var w;return l?(d&&o._release(d),"function"==typeof t?t(l):void 0):(o.verbose&&!o.nested&&o._log("---------- sql query ----------\n    query: "+e),w=d.queryRaw(e,function(){var e,t;e=this.parameters,t=[];for(u in e)g=e[u],1===g.io&&t.push(f(g.value,g.type));return t}.call(o)),o.verbose&&!o.nested&&o._log("---------- response -----------"),w.on("meta",function(e){var t,i;if(E){if(a){if(r[0].name===s&&o.connection.config.parseJSON===!0)try{E=JSON.parse(n.join("")),o.stream||(v[v.length-1][0]=E)}catch(e){t=e,E=null,t=c(new Error("Failed to parse incoming JSON. "+t.message),"EJSON"),o.stream?o.emit("error",t):console.error(t)}else E[r[0].name]=n.join("");n=null}o.verbose&&(o._log(y.inspect(E)),o._log("---------- --------------------")),null==E.___return___&&o.stream&&o.emit("row",E)}return E=null,r=e,m=[],Object.defineProperty(m,"columns",{enumerable:!1,value:p(e)}),a=!1,1!==e.length||(i=e[0].name)!==s&&i!==h||(a=!0,n=[]),o.stream?null==m.columns.___return___?o.emit("recordset",m.columns):void 0:v.push(m)}),w.on("row",function(e){if(E){if(a)return;o.verbose&&(o._log(y.inspect(E)),o._log("---------- --------------------")),null==E.___return___&&o.stream&&o.emit("row",E)}if(E={},!o.stream)return m.push(E)}),w.on("column",function(e,t,i){var o;return a?n.push(t):(t=b(t,r[e]),o=E[r[e].name],null!=o?o instanceof Array?o.push(t):E[r[e].name]=[o,t]:E[r[e].name]=t)}),w.on("rowcount",function(e){if(e>0)return o.rowsAffected+=e}),w.once("error",function(e){var n,r;return"string"==typeof e.sqlstate&&"08s01"===e.sqlstate.toLowerCase()&&(d.hasError=!0),n=c(e),/^\[Microsoft\]\[SQL Server Native Client 11\.0\](?:\[SQL Server\])?([\s\S]*)$/.exec(e.message)&&(n.message=RegExp.$1),n.code="EREQUEST",o.verbose&&!o.nested&&(r=Date.now()-_,o._log("    error: "+e),o._log(" duration: "+r+"ms"),o._log("---------- completed ----------")),o._release(d),"function"==typeof t?t(n):void 0}),w.once("done",function(){var e,l,h,f,p;if(!o.nested){if(E){if(a){if(r[0].name===s&&o.connection.config.parseJSON===!0)try{E=JSON.parse(n.join("")),o.stream||(v[v.length-1][0]=E)}catch(e){l=e,E=null,l=c(new Error("Failed to parse incoming JSON. "+l.message),"EJSON"),o.stream?o.emit("error",l):console.error(l)}else E[r[0].name]=n.join("");n=null}o.verbose&&(o._log(y.inspect(E)),o._log("---------- --------------------")),null==E.___return___&&o.stream&&o.emit("row",E)}if(i){h=null!=(f=v.pop())?f[0]:void 0,p=o.parameters;for(u in p)g=p[u],2===g.io&&(g.value=h[g.name],o.verbose&&o._log("   output: @"+g.name+", "+g.type.declaration+", "+g.value))}o.verbose&&(e=Date.now()-_,o._log(" duration: "+e+"ms"),o._log("---------- completed ----------"))}return o._release(d),o.stream?t(null,o.nested?E:null):"function"==typeof t?t(null,o.multiple||o.nested?v:v[0]):void 0}))}}(this)))},t.prototype.execute=function(e,n){var r,i,o,a,s,u;this.verbose&&this._log("---------- sql execute --------\n     proc: "+e),u=Date.now(),r="declare "+["@___return___ int"].concat(function(){var e,t;e=this.parameters,t=[];for(i in e)o=e[i],2===o.io&&t.push("@"+o.name+" "+d(o.type,o));return t}.call(this)).join(", ")+";",r+="exec @___return___ = "+e+" ",s=[],a=this.parameters;for(i in a)o=a[i],this.verbose&&this._log("   "+(1===o.io?" input":"output")+": @"+o.name+", "+o.type.declaration+", "+o.value),2===o.io?s.push("@"+o.name+"=@"+o.name+" output"):s.push("@"+o.name+"=?");return r+=s.join(", ")+";",r+="select "+["@___return___ as '___return___'"].concat(function(){var e,t;e=this.parameters,t=[];for(i in e)o=e[i],2===o.io&&t.push("@"+o.name+" as '"+o.name+"'");return t}.call(this)).join(", ")+";",this.verbose&&this._log("---------- response -----------"),this.nested=!0,t.prototype.query.call(this,r,function(e){return function(t,r){var a,s,c,l,h;if(e.nested=!1,t)return e.verbose&&(a=Date.now()-u,e._log("    error: "+t),e._log(" duration: "+a+"ms"),e._log("---------- completed ----------")),"function"==typeof n?n(t):void 0;if(s=e.stream?r:null!=(c=r.pop())?c[0]:void 0,s&&null!=s.___return___){h=s.___return___,l=e.parameters;for(i in l)o=l[i],2===o.io&&(o.value=s[o.name],e.verbose&&e._log("   output: @"+o.name+", "+o.type.declaration+", "+o.value))}return e.verbose&&(a=Date.now()-u,e._log("   return: "+h),e._log(" duration: "+a+"ms"),e._log("---------- completed ----------")),e.stream?n(null,null,h):(r.returnValue=h,"function"==typeof n?n(null,r,h):void 0)}}(this))},t.prototype.cancel=function(){return!1},t}(i),{Connection:l,Transaction:w,Request:v,fix:function(){}}}}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l,h,f,p,d,g,m=function(e,t){function n(){this.constructor=e}for(var r in t)v.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},v={}.hasOwnProperty;i=n(22).Pool,d=n(64),g=n(5),t=!1,p=n(3),o=p.TYPES,c=p.declare,r=n(11),a=function(e,t){if(null==e)return null;switch(t){case o.VarChar:case o.NVarChar:case o.Char:case o.NChar:case o.Xml:case o.Text:case o.NText:"string"==typeof e||e instanceof String||(e=e.toString());break;case o.Int:case o.TinyInt:case o.BigInt:case o.SmallInt:"number"==typeof e||e instanceof Number||(e=parseInt(e),isNaN(e)&&(e=null));break;case o.Float:case o.Real:case o.Decimal:case o.Numeric:case o.SmallMoney:case o.Money:"number"==typeof e||e instanceof Number||(e=parseFloat(e),isNaN(e)&&(e=null));break;case o.Bit:"boolean"==typeof e||e instanceof Boolean||(e=Boolean(e));break;case o.DateTime:case o.SmallDateTime:case o.DateTimeOffset:case o.Date:e instanceof Date||(e=new Date(e));break;case o.Binary:case o.VarBinary:case o.Image:e instanceof Buffer||(e=new Buffer(e.toString()))}return e},u=function(e){var t,n,r,i;switch(t={type:e.type.declaration},e.type){case o.VarChar:case o.NVarChar:case o.VarBinary:t.size="MAX";break;case o.Char:case o.NChar:case o.Binary:t.size=null!=(n=null!=(r=e.length)?r:null!=(i=e.value)?i.length:void 0)?n:1}return t},s=function(e){var t,n,r,i,a;for(a={},r=n=0,i=e.length;n<i;r=++n)t=e[r],a[t.name]={index:r,name:t.name,length:t.length,type:o[t.type.sqlType]};return a},h=function(e){switch(e){case r.READ_UNCOMMITTED:return"READ UNCOMMITTED";case r.READ_COMMITTED:return"READ COMMITTED";case r.REPEATABLE_READ:return"REPEATABLE READ";case r.SERIALIZABLE:return"SERIALIZABLE";case r.SNAPSHOT:return"SNAPSHOT";default:throw new TransactionError("Invalid isolation level.")}},l=function(e){var t;return t=e.toString(16),1===t.length&&(t="0"+t),t},f=function(e){var t;return t=l(e[3])+l(e[2])+l(e[1])+l(e[0])+"-"+l(e[5])+l(e[4])+"-"+l(e[7])+l(e[6])+"-"+l(e[8])+l(e[9])+"-"+l(e[10])+l(e[11])+l(e[12])+l(e[13])+l(e[14])+l(e[15]),t.toUpperCase()},e.exports=function(e,r,o,l,p,v){var y,b,E;return y=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return m(t,e),t.prototype.pool=null,t.prototype.connect=function(e,t){var n,r,o,a,s;if(n={userName:e.user,password:e.password,host:e.server,port:e.port,database:e.database},r={name:"mssql",max:10,min:0,idleTimeoutMillis:3e4,create:function(t){return function(r){var i,o,a,s;return i=new d.Connection(n),i.on("error",function(e){return"ECONNRESET"===e.code?void(i.hasError=!0):t.emit("error",e)}),a=!1,s=setTimeout(function(){return a=!0,i._client._socket.destroy(),r(new l("Connection timeout.","ETIMEOUT"),null)},null!=(o=e.timeout)?o:15e3),i.connect(function(e){if(clearTimeout(s),!a)return e&&(e=l(e)),e?r(e,null):r(null,i)})}}(this),validate:function(e){return null!=e&&!e.hasError},destroy:function(e){return null!=e?e.end():void 0}},e.pool){a=e.pool;for(o in a)s=a[o],r[o]=s}return this.pool=i(r,n),this.pool.acquire(function(e){return function(n,r){return!n||n instanceof Error||(n=new Error(n)),n?e.pool.drain(function(){var t;return null!=(t=e.pool)&&t.destroyAllNow(),e.pool=null}):e.pool.release(r),t(n)}}(this))},t.prototype.close=function(e){return this.pool?this.pool.drain(function(t){return function(){var n;return null!=(n=t.pool)&&n.destroyAllNow(),t.pool=null,e(null)}}(this)):e(null)},t}(e),E=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return m(t,e),t.prototype.begin=function(e){return this.connection.pool.acquire(function(t){return function(n,r){return n?e(n):(t._pooledConnection=r,t.request().query("set transaction isolation level "+h(t.isolationLevel),function(t){return t?p(t):r.setAutoCommit(!1,e)}))}}(this))},t.prototype.commit=function(e){return this._pooledConnection.commit(function(t){return function(n){return n&&(n=p(n)),t.connection.pool.release(t._pooledConnection),t._pooledConnection=null,e(n)}}(this))},t.prototype.rollback=function(e){return this._pooledConnection.rollback(function(t){return function(n){return n&&(n=p(n)),t.connection.pool.release(t._pooledConnection),t._pooledConnection=null,e(n)}}(this))},t}(r),b=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return m(t,e),t.prototype.batch=function(e,n){return t.prototype.query.call(this,e,n)},t.prototype.bulk=function(e,t){return process.nextTick(function(){return t(v("Bulk insert is not supported in 'msnodesql' driver.","ENOTSUPP"))})},t.prototype.query=function(e,t){var n,r,i,o,l,h,p,d,m,y,b,E,w;if(this.verbose&&!this.nested&&this._log("---------- sql query ----------\n    query: "+e),0===e.length)return process.nextTick(function(){var e;return this.verbose&&!this.nested&&(this._log("---------- response -----------"),e=Date.now()-w,this._log(" duration: "+e+"ms"),this._log("---------- completed ----------")),"function"==typeof t?t(null,this.multiple||this.nested?[]:null):void 0});y=null,b=[],w=Date.now(),r=!1,n=[],o=null,d={},m={},E=this.parameters;for(l in E)p=E[l],1===p.io&&(d[l]=u(p),m[l]=a(p.value,p.type));return this.nested||(i=function(){var e,t;e=this.parameters,t=[];for(l in e)p=e[l],2===p.io&&t.push("@"+p.name+" "+c(p.type,p));return t}.call(this),h=function(){var e,t;e=this.parameters,t=[];for(l in e)p=e[l],2===p.io&&t.push("@"+p.name+" as '"+p.name+"'");return t}.call(this),i.length&&(e="declare "+i.join(",")+";"+e+";"),h.length&&(e+="select "+h.join(",")+";",r=!0)),this._acquire(function(i){return function(a,u){var c;return a?(u&&i._release(u),"function"==typeof t?t(a):void 0):i.canceled?(i.verbose&&i._log("---------- canceling ----------"),i._release(u),"function"==typeof t?t(new v("Canceled.","ECANCEL")):void 0):(i._cancel=function(){return i.verbose&&i._log("---------- canceling ----------"),c.cancel()},c=u.createStatement(e,d),c.on("row",function(e){var t,n,r,a,s,u,c;for(u={},s=e.metadata.columns,r=0,a=s.length;r<a;r++)t=s[r],c=e.getValue(t.name),null!=c&&"GUIDTYPE"===t.type.name&&(c=f(c)),n=u[t.name],null!=n?n instanceof Array?n.push(t.value):u[t.name]=[n,c]:u[t.name]=c;if(i.verbose&&(i._log(g.inspect(u)),i._log("---------- --------------------")),null==u.___return___?i.stream&&i.emit("row",u):o=u,!i.stream)return y.push(u)}),c.on("metadata",function(e){return y=[],Object.defineProperty(y,"columns",{enumerable:!1,value:s(e.columns)},i.nested),i.stream?null==y.columns.___return___?i.emit("recordset",y.columns):void 0:b.push(y)}),c.on("done",function(e){var a,s,c,h,f,d,g,m;if(i.canceled&&(a=new v("Canceled.","ECANCEL"),i.stream?i.emit("error",a):n.push(a)),!i.nested){if(r){f=null!=(g=b.pop())?g[0]:void 0,m=i.parameters;for(l in m)p=m[l],2===p.io&&(p.value=f[p.name],i.verbose&&i._log("   output: @"+p.name+", "+p.type.declaration+", "+p.value))}if(i.verbose){if(n.length)for(h=0,d=n.length;h<d;h++)c=n[h],i._log("    error: "+c);s=Date.now()-w,i._log(" duration: "+s+"ms"),i._log("---------- completed ----------")}}return n.length&&!i.stream&&(c=n.pop(),c.precedingErrors=n),i._release(u),i.stream?t(null,i.nested?o:null):"function"==typeof t?t(c,i.multiple||i.nested?b:b[0]):void 0}),c.on("message",function(e){return i.emit("info",{message:e.text,number:e.number,state:e.state,class:e.severity,lineNumber:e.lineNumber,serverName:e.serverName,procName:e.procName})}),c.on("error",function(e){var t;return t=v(e,"EREQUEST"),i.stream?i.emit("error",t):n.push(t)}),c.execute(m))}}(this))},t.prototype.execute=function(e,n){var r,i,o,a,s,u;this.verbose&&this._log("---------- sql execute --------\n     proc: "+e),u=Date.now(),r="declare "+["@___return___ int"].concat(function(){var e,t;e=this.parameters,t=[];for(i in e)o=e[i],2===o.io&&t.push("@"+o.name+" "+c(o.type,o));
return t}.call(this)).join(", ")+";",r+="exec @___return___ = "+e+" ",s=[],a=this.parameters;for(i in a)o=a[i],this.verbose&&this._log("   "+(1===o.io?" input":"output")+": @"+o.name+", "+o.type.declaration+", "+o.value),2===o.io?s.push("@"+o.name+"=@"+o.name+" output"):s.push("@"+o.name+"=@"+o.name);return r+=s.join(", ")+";",r+="select "+["@___return___ as '___return___'"].concat(function(){var e,t;e=this.parameters,t=[];for(i in e)o=e[i],2===o.io&&t.push("@"+o.name+" as '"+o.name+"'");return t}.call(this)).join(", ")+";",this.verbose&&this._log("---------- response -----------"),this.nested=!0,t.prototype.query.call(this,r,function(e){return function(t,r){var a,s,c,l,h;if(e.nested=!1,t)return e.verbose&&(a=Date.now()-u,e._log("    error: "+t),e._log(" duration: "+a+"ms"),e._log("---------- completed ----------")),"function"==typeof n?n(t):void 0;if(s=e.stream?r:null!=(c=r.pop())?c[0]:void 0,s&&null!=s.___return___){h=s.___return___,l=e.parameters;for(i in l)o=l[i],2===o.io&&(o.value=s[o.name],e.verbose&&e._log("   output: @"+o.name+", "+o.type.declaration+", "+o.value))}return e.verbose&&(a=Date.now()-u,e._log("   return: "+h),e._log(" duration: "+a+"ms"),e._log("---------- completed ----------")),e.stream?n(null,null,h):(r.returnValue=h,"function"==typeof n?n(null,r,h):void 0)}}(this))},t.prototype.cancel=function(){return!this._cancel||this._cancel()},t}(o),{Connection:y,Transaction:E,Request:b,fix:function(){if(!t)return n(33),t=!0}}}}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l,h,f,p,d,g,m,v,y,b,E=function(e,t){function n(){this.constructor=e}for(var r in t)w.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},w={}.hasOwnProperty;i=n(22).Pool,v=n(144),y=n(5),m=n(3),o=m.TYPES,f=m.declare,l=m.cast,t=n(3).DECLARATIONS,s=n(17).PARSERS,a=n(24),r="JSON_F52E2B61-18A1-11d1-B105-00805F49916B",u="XML_F52E2B61-18A1-11d1-B105-00805F49916B",c=function(e){var t;return process.domain?null!=(t=process.domain)?t.bind(e):void 0:e},d=function(e){switch(e){case o.VarChar:return v.TYPES.VarChar;case o.NVarChar:return v.TYPES.NVarChar;case o.Text:return v.TYPES.Text;case o.Int:return v.TYPES.Int;case o.BigInt:return v.TYPES.BigInt;case o.TinyInt:return v.TYPES.TinyInt;case o.SmallInt:return v.TYPES.SmallInt;case o.Bit:return v.TYPES.Bit;case o.Float:return v.TYPES.Float;case o.Decimal:return v.TYPES.Decimal;case o.Numeric:return v.TYPES.Numeric;case o.Real:return v.TYPES.Real;case o.Money:return v.TYPES.Money;case o.SmallMoney:return v.TYPES.SmallMoney;case o.Time:return v.TYPES.TimeN;case o.Date:return v.TYPES.DateN;case o.DateTime:return v.TYPES.DateTime;case o.DateTime2:return v.TYPES.DateTime2N;case o.DateTimeOffset:return v.TYPES.DateTimeOffsetN;case o.SmallDateTime:return v.TYPES.SmallDateTime;case o.UniqueIdentifier:return v.TYPES.UniqueIdentifierN;case o.Xml:return v.TYPES.VarChar;case o.Char:return v.TYPES.Char;case o.NChar:return v.TYPES.NChar;case o.NText:return v.TYPES.NVarChar;case o.Image:return v.TYPES.Image;case o.Binary:return v.TYPES.Binary;case o.VarBinary:return v.TYPES.VarBinary;case o.UDT:case o.Geography:case o.Geometry:return v.TYPES.UDT;case o.TVP:return v.TYPES.TVP;case o.Variant:return v.TYPES.Variant;default:return e}},p=function(e,t){switch(e){case v.TYPES.Char:return o.Char;case v.TYPES.NChar:return o.NChar;case v.TYPES.VarChar:return o.VarChar;case v.TYPES.NVarChar:return o.NVarChar;case v.TYPES.Text:return o.Text;case v.TYPES.NText:return o.NText;case v.TYPES.Int:return o.Int;case v.TYPES.IntN:return 8===t?o.BigInt:4===t?o.Int:2===t?o.SmallInt:o.TinyInt;case v.TYPES.BigInt:return o.BigInt;case v.TYPES.TinyInt:return o.TinyInt;case v.TYPES.SmallInt:return o.SmallInt;case v.TYPES.Bit:case v.TYPES.BitN:return o.Bit;case v.TYPES.Float:return o.Float;case v.TYPES.FloatN:return 8===t?o.FloatN:o.Real;case v.TYPES.Real:return o.Real;case v.TYPES.Money:return o.Money;case v.TYPES.MoneyN:return 8===t?o.Money:o.SmallMoney;case v.TYPES.SmallMoney:return o.SmallMoney;case v.TYPES.Numeric:case v.TYPES.NumericN:return o.Numeric;case v.TYPES.Decimal:case v.TYPES.DecimalN:return o.Decimal;case v.TYPES.DateTime:return o.DateTime;case v.TYPES.DateTimeN:return 8===t?o.DateTime:o.SmallDateTime;case v.TYPES.TimeN:return o.Time;case v.TYPES.DateN:return o.Date;case v.TYPES.DateTime2N:return o.DateTime2;case v.TYPES.DateTimeOffsetN:return o.DateTimeOffset;case v.TYPES.SmallDateTime:return o.SmallDateTime;case v.TYPES.UniqueIdentifierN:return o.UniqueIdentifier;case v.TYPES.Image:return o.Image;case v.TYPES.Binary:return o.Binary;case v.TYPES.VarBinary:return o.VarBinary;case v.TYPES.Xml:return o.Xml;case v.TYPES.UDT:return o.UDT;case v.TYPES.TVP:return o.TVP;case v.TYPES.Variant:return o.Variant}},h=function(e){var n,r,i,o,a;for(a={},i=r=0,o=e.length;r<o;i=++r)n=e[i],a[n.colName]={index:i,name:n.colName,length:n.dataLength,type:p(n.type,n.dataLength),scale:n.scale,precision:n.precision,nullable:!!(1&n.flags),caseSensitive:!!(2&n.flags),identity:!!(16&n.flags),readOnly:!(12&n.flags)},null!=n.udtInfo&&(a[n.colName].udt={name:n.udtInfo.typeName,database:n.udtInfo.dbname,schema:n.udtInfo.owningSchema,assembly:n.udtInfo.assemblyName},t[n.udtInfo.typeName]&&(a[n.colName].type=t[n.udtInfo.typeName]));return a},b=function(e,t){return t.type===v.TYPES.UDT&&null!=e&&s[t.udtInfo.typeName]?s[t.udtInfo.typeName](e):e},g=function(e){var t,n,r,i,o;if(e instanceof a){for(o={name:e.name,schema:e.schema,columns:[],rows:e.rows},i=e.columns,n=0,r=i.length;n<r;n++)t=i[n],o.columns.push({name:t.name,type:d(t.type),length:t.length,scale:t.scale,precision:t.precision});return o}return e},e.exports=function(e,t,n,o,s,p){var m,w,_;return m=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.pool=null,t.prototype.connect=function(e,t){var n,r,a,s,u,c,l,h,f,p,d,g,m,y;if(l={userName:e.user,password:e.password,server:e.server,options:e.options,domain:e.domain},null==(n=l.options).database&&(n.database=e.database),null==(r=l.options).port&&(r.port=e.port),null==(a=l.options).connectTimeout&&(a.connectTimeout=null!=(p=null!=(d=e.connectionTimeout)?d:e.timeout)?p:15e3),null==(s=l.options).requestTimeout&&(s.requestTimeout=null!=(g=e.requestTimeout)?g:15e3),null==(u=l.options).tdsVersion&&(u.tdsVersion="7_4"),l.options.rowCollectionOnDone=!1,l.options.rowCollectionOnRequestCompletion=!1,l.options.useColumnNames=!1,null==(c=l.options).appName&&(c.appName="node-mssql"),l.options.instanceName&&delete l.options.port,isNaN(l.options.requestTimeout)&&(l.options.requestTimeout=15e3),l.options.requestTimeout===1/0&&(l.options.requestTimeout=0),l.options.requestTimeout<0&&(l.options.requestTimeout=0),e.debug&&(l.options.debug={packet:!0,token:!0,data:!0,payload:!0}),h={name:"mssql",max:10,min:0,idleTimeoutMillis:3e4,create:function(t){return function(n){var r;if(r=new v.Connection(l),r.once("connect",function(e){return e&&(e=o(e)),e?n(e,null):n(null,r)}),r.on("error",function(e){return"ESOCKET"===e.code?void(r.hasError=!0):t.emit("error",e)}),e.debug)return r.on("debug",function(e){return t._debug(e)})}}(this),validate:function(e){return null!=e&&!e.closed&&!e.hasError},destroy:function(e){return null!=e&&e.close(),setTimeout(function(){return null!=e?e.removeAllListeners():void 0},500)}},e.pool){m=e.pool;for(f in m)y=m[f],h[f]=y}return this.pool=i(h,l),this.pool.acquire(function(e){return function(n,r){return n?e.pool.drain(function(){var t;return null!=(t=e.pool)&&t.destroyAllNow(),e.pool=null}):e.pool.release(r),t(n)}}(this))},t.prototype.close=function(e){return this.pool?this.pool.drain(function(t){return function(){var n;return null!=(n=t.pool)&&n.destroyAllNow(),t.pool=null,e(null)}}(this)):e(null)},t}(e),_=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype._abort=function(){var e;if(!this._rollbackRequested)return e=this._pooledConnection,setImmediate(function(t){return function(){return t.connection.pool.release(e)}}(this)),this._pooledConnection.removeListener("rollbackTransaction",this._abort),this._pooledConnection=null,this._aborted=!0,this.emit("rollback",!0)},t.prototype.begin=function(e){return this._aborted=!1,this._rollbackRequested=!1,this.connection.pool.acquire(function(t){return function(n,r){return n?e(n):(t._pooledConnection=r,t._pooledConnection.on("rollbackTransaction",t._abort),r.beginTransaction(c(function(t){return t&&(t=s(t)),e(t)},t.name,t.isolationLevel)))}}(this))},t.prototype.commit=function(e){return this._pooledConnection.commitTransaction(c(function(t){return function(n){return n&&(n=s(n)),t._pooledConnection.removeListener("rollbackTransaction",t._abort),t.connection.pool.release(t._pooledConnection),t._pooledConnection=null,e(n)}}(this)))},t.prototype.rollback=function(e){return this._rollbackRequested=!0,this._pooledConnection.rollbackTransaction(c(function(t){return function(n){return n&&(n=s(n)),t._pooledConnection.removeListener("rollbackTransaction",t._abort),t.connection.pool.release(t._pooledConnection),t._pooledConnection=null,e(n)}}(this)))},t}(t),w=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t.prototype.batch=function(e,n){return this._isBatch=!0,t.prototype.query.call(this,e,n)},t.prototype.bulk=function(e,t){var n,r,i,o,a,s;return e._makeBulk(),e.name||process.nextTick(function(){return t(p("Table name must be specified for bulk insert.","ENAME"))}),"@"===e.name.charAt(0)&&process.nextTick(function(){return t(p("You can't use table variables for bulk insert.","ENAME"))}),s=Date.now(),r=[],n={},a=!1,i=function(e){return function(i,o,s){var u,c,l,h;if(c=new Error(s.message),c.info=s,u=p(c,"EREQUEST"),e.stream)e.emit("error",u);else if(i&&!a){if(null!=o){for(l in n)h=n[l],o.removeListener(l,h);e._release(o)}a=!0,"function"==typeof t&&t(u)}return r.push(u)}}(this),o=function(e){return function(t){return e.emit("info",{message:t.message,number:t.number,state:t.state,class:t.class,lineNumber:t.lineNumber,serverName:t.serverName,procName:t.procName})}}(this),this._acquire(function(u){return function(l,h){var f,g,m,y,b,E,w,_,T,I,S,L;if(!l){if(u.verbose&&u._log("-------- sql bulk load --------\n    table: "+e.name),u.canceled)return u.verbose&&u._log("---------- canceling ----------"),u._release(h),"function"==typeof t?t(new p("Canceled.","ECANCEL")):void 0;for(u._cancel=function(){return u.verbose&&u._log("---------- canceling ----------"),h.cancel()},n.infoMessage=o,n.errorMessage=i.bind(void 0,!1,h),n.error=i.bind(void 0,!0,h),h.on("infoMessage",n.infoMessage),h.on("errorMessage",n.errorMessage),h.on("error",n.error),m=c(function(e,i){var o,c,l,f,d,g,m;if(e&&e.message!==(null!=(m=r[r.length-1])?m.message:void 0)&&(e=p(e,"EREQUEST"),u.stream&&u.emit("error",e),r.push(e)),u.verbose){if(r.length)for(d=0,g=r.length;d<g;d++)c=r[d],u._log("    error: "+c);o=Date.now()-s,u._log(" duration: "+o+"ms"),u._log("---------- completed ----------")}if(u._cancel=null,r.length&&!u.stream&&(c=r.pop(),c.precedingErrors=r),!a){for(l in n)f=n[l],h.removeListener(l,f);return u._release(h),a=!0,u.stream?t(null,null):"function"==typeof t?t(c,i):void 0}}),f=h.newBulkLoad(e.path,m),T=e.columns,y=0,E=T.length;y<E;y++)g=T[y],f.addColumn(g.name,d(g.type),{nullable:g.nullable,length:g.length,scale:g.scale,precision:g.precision});for(I=e.rows,b=0,w=I.length;b<w;b++)L=I[b],f.addRow(L);return u.verbose&&u._log("---------- response -----------"),e.create?(_=e.temporary?"tempdb..["+e.name+"]":e.path,S=new v.Request("if object_id('"+_.replace(/'/g,"''")+"') is null "+e.declare(),function(e){return e?m(e):h.execBulkLoad(f)}),h.execSqlBatch(S)):h.execBulkLoad(f)}}}(this))},t.prototype.query=function(e,t){var n,i,o,s,m,E,w,_,T,I,S,L,N,C,k;return s={},L=[],N=[],C=Date.now(),E=[],i=null,n=!1,S=!1,I=!1,o=null,k=null,T=!1,m={},w=function(e){return function(n,r,i){var o,a,s,u;if(a=new Error(i.message),a.info=i,o=p(a,"EREQUEST"),e.stream)e.emit("error",o);else if(n&&!T){if(null!=r){for(s in m)u=m[s],r.removeListener(s,u);e._release(r)}T=!0,"function"==typeof t&&t(o)}return E.push(o)}}(this),_=function(e){return function(t){return e.emit("info",{message:t.message,number:t.number,state:t.state,class:t.class,lineNumber:t.lineNumber,serverName:t.serverName,procName:t.procName})}}(this),this._acquire(function(S){return function(k,U){var P,B,D,A,O,R,x,M,q,V;if(k)return U&&S._release(U),"function"==typeof t?t(k):void 0;if(S.verbose&&S._log("---------- sql "+(S._isBatch?"batch":"query")+" ----------\n    "+(S._isBatch?"batch":"query")+": "+e),S.canceled)return S.verbose&&S._log("---------- canceling ----------"),S._release(U),"function"==typeof t?t(new p("Canceled.","ECANCEL")):void 0;if(S._cancel=function(){return S.verbose&&S._log("---------- canceling ----------"),U.cancel()},m.infoMessage=_,m.errorMessage=w.bind(void 0,!1,U),m.error=w.bind(void 0,!0,U),U.on("infoMessage",m.infoMessage),U.on("errorMessage",m.errorMessage),U.on("error",m.error),M=new v.Request(e,c(function(e){var r,o,a,s,u,c,l,h,f;if(e&&e.message!==(null!=(h=E[E.length-1])?h.message:void 0)&&(e=p(e,"EREQUEST"),S.stream&&S.emit("error",e),E.push(e)),n){S.stream||(i=N.pop()[0]);for(l in i)f=i[l],"___return___"!==l&&(S.verbose&&(f===v.TYPES.Null?S._log("   output: @"+l+", null"):S._log("   output: @"+l+", "+S.parameters[l].type.declaration.toLowerCase()+", "+f)),S.parameters[l].value=f===v.TYPES.Null?null:f)}if(S.verbose){if(E.length)for(u=0,c=E.length;u<c;u++)o=E[u],S._log("    error: "+o);r=Date.now()-C,S._log(" duration: "+r+"ms"),S._log("---------- completed ----------")}if(S._cancel=null,E.length&&!S.stream&&(o=E.pop(),o.precedingErrors=E),!T){for(a in m)s=m[a],U.removeListener(a,s);return S._release(U),T=!0,S.stream?t(null,null):"function"==typeof t?t(o,S.multiple?N:N[0]):void 0}})),M.on("columnMetadata",function(e){var t;if(s=h(e),I=!1,1!==e.length||(t=e[0].colName)!==r&&t!==u||(I=!0,o=[]),S.stream){if(!S._isBatch)return S.emit("recordset",s);if(null==s.___return___)return S.emit("recordset",s)}}),D=function(e,t){var n,i;if(0===Object.keys(s).length)return void(e>0&&(S.rowsAffected+=e));if(I){if(s[r]&&S.connection.config.parseJSON===!0)try{i=JSON.parse(o.join(""))}catch(e){n=e,i=null,n=p(new Error("Failed to parse incoming JSON. "+n.message),"EJSON"),S.stream&&S.emit("error",n),E.push(n)}else i={},i[Object.keys(s)[0]]=o.join("");o=null,S.verbose&&(S._log(y.inspect(i)),S._log("---------- --------------------")),S.stream?S.emit("row",i):L.push(i)}return S.stream||(Object.defineProperty(L,"columns",{enumerable:!1,value:s}),Object.defineProperty(L,"toTable",{enumerable:!1,value:function(){return a.fromRecordset(this)}}),N.push(L)),L=[],s={}},M.on("doneInProc",D),M.on("done",D),M.on("returnValue",function(e,t,n){return S.verbose&&(t===v.TYPES.Null?S._log("   output: @"+e+", null"):S._log("   output: @"+e+", "+S.parameters[e].type.declaration.toLowerCase()+", "+t)),S.parameters[e].value=t===v.TYPES.Null?null:t}),M.on("row",function(e){var t,n,r,a,s;if(L||(L=[]),I)return o.push(e[0].value);for(s={},r=0,a=e.length;r<a;r++)t=e[r],t.value=b(t.value,t.metadata),n=s[t.metadata.colName],null!=n?n instanceof Array?n.push(t.value):s[t.metadata.colName]=[n,t.value]:s[t.metadata.colName]=t.value;return S.verbose&&(S._log(y.inspect(s)),S._log("---------- --------------------")),S.stream?S._isBatch&&null!=s.___return___?i=s:S.emit("row",s):L.push(s)}),S._isBatch){if(Object.keys(S.parameters).length){R=S.parameters;for(A in R){if(O=R[A],V=d(O.type).validate(O.value),V instanceof TypeError)return V=new p("Validation failed for parameter '"+A+"'. "+V.message,"EPARAM"),S.verbose&&(S._log("    error: "+V),S._log("---------- completed ----------")),S._release(U),"function"==typeof t?t(V):void 0;O.value=V}B=function(){var e,t;e=this.parameters,t=[];for(A in e)O=e[A],t.push("@"+A+" "+f(O.type,O));return t}.call(S),P=function(){var e,t;e=this.parameters,t=[];for(A in e)O=e[A],t.push("@"+A+" = "+l(O.value,O.type,O));return t}.call(S),q=function(){var e,t;e=this.parameters,t=[];for(A in e)O=e[A],2===O.io&&t.push("@"+A+" as ["+A+"]");return t}.call(S),n=q.length>0,M.sqlTextOrProcedure="declare "+B.join(", ")+";select "+P.join(", ")+";"+M.sqlTextOrProcedure+";"+(n?"select 1 as [___return___], "+q.join(", "):"")}}else{x=S.parameters;for(A in x)O=x[A],S.verbose&&(O.value===v.TYPES.Null?S._log("   "+(1===O.io?" input":"output")+": @"+O.name+", null"):S._log("   "+(1===O.io?" input":"output")+": @"+O.name+", "+O.type.declaration.toLowerCase()+", "+O.value)),1===O.io?M.addParameter(O.name,d(O.type),g(O.value),{length:O.length,scale:O.scale,precision:O.precision}):M.addOutputParameter(O.name,d(O.type),g(O.value),{length:O.length,scale:O.scale,precision:O.precision})}return S.verbose&&S._log("---------- response -----------"),U[S._isBatch?"execSqlBatch":"execSql"](M)}}(this))},t.prototype.execute=function(e,t){var n,i,o,s,l,f,m,E,w,_,T;return i={},E=[],w=[],_=0,T=Date.now(),s=[],m=!1,n=null,f=!1,o={},l=function(e){return function(n,r,i){var a,u,c,l;if(u=new Error(i.message),u.info=i,a=p(u,"EREQUEST"),e.stream)e.emit("error",a);else if(n&&!f){if(null!=r){for(c in o)l=o[c],r.removeListener(c,l);e._release(r)}f=!0,"function"==typeof t&&t(a)}return s.push(a)}}(this),this._acquire(function(I){return function(S,L){var N,C,k,U;if(S)return L&&I._release(L),"function"==typeof t?t(S):void 0;if(I.verbose&&I._log("---------- sql execute --------\n     proc: "+e),I.canceled)return I.verbose&&I._log("---------- canceling ----------"),I._release(L),"function"==typeof t?t(new p("Canceled.","ECANCEL")):void 0;I._cancel=function(){return I.verbose&&I._log("---------- canceling ----------"),L.cancel()},o.errorMessage=l.bind(void 0,!1,L),o.error=l.bind(void 0,!0,L),L.on("errorMessage",o.errorMessage),L.on("error",o.error),U=new v.Request(e,c(function(e){var n,r,i,a,u,c,l;if(e&&e.message!==(null!=(l=s[s.length-1])?l.message:void 0)&&(e=p(e,"EREQUEST"),I.stream&&I.emit("error",e),s.push(e)),I.verbose){if(s.length)for(u=0,c=s.length;u<c;u++)r=s[u],I._log("    error: "+r);n=Date.now()-T,I._log("   return: "+_),I._log(" duration: "+n+"ms"),I._log("---------- completed ----------")}if(I._cancel=null,s.length&&!I.stream&&(r=s.pop(),r.precedingErrors=s),!f){for(i in o)a=o[i],L.removeListener(i,a);return I._release(L),f=!0,I.stream?t(null,null,_):(w.returnValue=_,"function"==typeof t?t(r,w,_):void 0)}})),U.on("columnMetadata",function(e){var t;if(i=h(e),m=!1,1!==e.length||(t=e[0].colName)!==r&&t!==u||(m=!0,n=[]),I.stream)return I.emit("recordset",i)}),U.on("row",function(e){var t,r,i,o,a;if(E||(E=[]),m)return n.push(e[0].value);for(a={},i=0,o=e.length;i<o;i++)t=e[i],t.value=b(t.value,t.metadata),r=a[t.metadata.colName],null!=r?r instanceof Array?r.push(t.value):a[t.metadata.colName]=[r,t.value]:a[t.metadata.colName]=t.value;return I.verbose&&(I._log(y.inspect(a)),I._log("---------- --------------------")),I.stream?I.emit("row",a):E.push(a)}),U.on("doneInProc",function(e,t){var o,u;if(0===Object.keys(i).length)return void(e>0&&(I.rowsAffected+=e));if(m){if(i[r]&&I.connection.config.parseJSON===!0)try{u=JSON.parse(n.join(""))}catch(e){o=e,u=null,o=p(new Error("Failed to parse incoming JSON. "+o.message),"EJSON"),I.stream&&I.emit("error",o),s.push(o)}else u={},u[Object.keys(i)[0]]=n.join("");n=null,I.verbose&&(I._log(y.inspect(u)),I._log("---------- --------------------")),I.stream?I.emit("row",u):E.push(u)}return I.stream||(Object.defineProperty(E,"columns",{enumerable:!1,value:i}),Object.defineProperty(E,"toTable",{enumerable:!1,value:function(){return a.fromRecordset(this)}}),w.push(E)),E=[],i={}}),U.on("doneProc",function(e,t,n){return _=n}),U.on("returnValue",function(e,t,n){return I.verbose&&(t===v.TYPES.Null?I._log("   output: @"+e+", null"):I._log("   output: @"+e+", "+I.parameters[e].type.declaration.toLowerCase()+", "+t)),I.parameters[e].value=t===v.TYPES.Null?null:t}),k=I.parameters;for(N in k)C=k[N],I.verbose&&(C.value===v.TYPES.Null?I._log("   "+(1===C.io?" input":"output")+": @"+C.name+", null"):I._log("   "+(1===C.io?" input":"output")+": @"+C.name+", "+C.type.declaration.toLowerCase()+", "+C.value)),1===C.io?U.addParameter(C.name,d(C.type),g(C.value),{length:C.length,scale:C.scale,precision:C.precision}):U.addOutputParameter(C.name,d(C.type),g(C.value),{length:C.length,scale:C.scale,precision:C.precision});return I.verbose&&I._log("---------- response -----------"),L.callProcedure(U)}}(this))},t.prototype.cancel=function(){return!this._cancel||this._cancel()},t}(n),{Connection:m,Transaction:_,Request:w,fix:function(){}}}}).call(this)},function(e,t,n){"use strict";function r(e,t,n){return"function"==typeof e.prependListener?e.prependListener(t,n):void(e._events&&e._events[t]?U(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n))}function i(e,t){V=V||n(12),e=e||{},this.objectMode=!!e.objectMode,t instanceof V&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new q,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(M||(M=n(58).StringDecoder),this.decoder=new M(e.encoding),this.encoding=e.encoding)}function o(e){return V=V||n(12),this instanceof o?(this._readableState=new i(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),void P.call(this)):new o(e)}function a(e,t,n,r,i){var o=l(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,h(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&i){var u=new Error("stream.unshift() after end event");e.emit("error",u)}else{var c;!t.decoder||i||r||(n=t.decoder.write(n),c=!t.objectMode&&0===n.length),i||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&f(e))),d(e,t)}else i||(t.reading=!1);return s(t)}function s(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function u(e){return e>=F?e=F:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function c(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=u(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function l(e,t){var n=null;return D.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function h(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,f(e)}}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(x("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?k(p,e):p(e))}function p(e){x("emit readable"),e.emit("readable"),E(e)}function d(e,t){t.readingMore||(t.readingMore=!0,k(g,e,t))}function g(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(x("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function m(e){return function(){var t=e._readableState;x("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&B(e,"data")&&(t.flowing=!0,E(e))}}function v(e){x("readable nexttick read 0"),e.read(0)}function y(e,t){t.resumeScheduled||(t.resumeScheduled=!0,k(b,e,t))}function b(e,t){t.reading||(x("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),E(e),t.flowing&&!t.reading&&e.read(0)}function E(e){var t=e._readableState;for(x("flow",t.flowing);t.flowing&&null!==e.read(););}function w(e,t){if(0===t.length)return null;var n;return t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=_(e,t.buffer,t.decoder),n}function _(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?T(e,t):I(e,t),r}function T(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(i+=a===o.length?o:o.slice(0,e),e-=a,0===e){a===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++r}return t.length-=r,i}function I(e,t){var n=A.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),e-=a,0===e){a===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(a));break}++i}return t.length-=i,n}function S(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,k(L,t,e))}function L(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function N(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function C(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}e.exports=o;var k=n(34),U=n(111);o.ReadableState=i;var P,B=(n(4).EventEmitter,function(e,t){return e.listeners(t).length});!function(){try{P=n(14)}catch(e){}finally{P||(P=n(4).EventEmitter)}}();var D=n(10).Buffer,A=n(29),O=n(15);O.inherits=n(16);var R=n(5),x=void 0;x=R&&R.debuglog?R.debuglog("stream"):function(){};var M,q=n(121);O.inherits(o,P);var V,V;o.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding,t!==n.encoding&&(e=A.from(e,t),t="")),a(this,n,e,t,!1)},o.prototype.unshift=function(e){var t=this._readableState;return a(this,t,e,"",!0)},o.prototype.isPaused=function(){return this._readableState.flowing===!1},o.prototype.setEncoding=function(e){return M||(M=n(58).StringDecoder),this._readableState.decoder=new M(e),this._readableState.encoding=e,this};var F=8388608;o.prototype.read=function(e){x("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return x("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?S(this):f(this),null;if(e=c(e,t),0===e&&t.ended)return 0===t.length&&S(this),null;var r=t.needReadable;x("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,x("length less than watermark",r)),t.ended||t.reading?(r=!1,x("reading or ended",r)):r&&(x("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=c(n,t)));var i;return i=e>0?w(e,t):null,null===i?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&S(this)),null!==i&&this.emit("data",i),i},o.prototype._read=function(e){this.emit("error",new Error("not implemented"))},o.prototype.pipe=function(e,t){function n(e){x("onunpipe"),e===h&&o()}function i(){x("onend"),e.end()}function o(){x("cleanup"),e.removeListener("close",u),e.removeListener("finish",c),e.removeListener("drain",g),e.removeListener("error",s),e.removeListener("unpipe",n),h.removeListener("end",i),h.removeListener("end",o),h.removeListener("data",a),v=!0,!f.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function a(t){x("ondata"),y=!1;var n=e.write(t);!1!==n||y||((1===f.pipesCount&&f.pipes===e||f.pipesCount>1&&C(f.pipes,e)!==-1)&&!v&&(x("false write response, pause",h._readableState.awaitDrain),h._readableState.awaitDrain++,y=!0),h.pause())}function s(t){x("onerror",t),l(),e.removeListener("error",s),0===B(e,"error")&&e.emit("error",t)}function u(){e.removeListener("finish",c),l()}function c(){x("onfinish"),e.removeListener("close",u),l()}function l(){x("unpipe"),h.unpipe(e)}var h=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=e;break;case 1:f.pipes=[f.pipes,e];break;default:f.pipes.push(e)}f.pipesCount+=1,x("pipe count=%d opts=%j",f.pipesCount,t);var p=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,d=p?i:o;f.endEmitted?k(d):h.once("end",d),e.on("unpipe",n);var g=m(h);e.on("drain",g);var v=!1,y=!1;return h.on("data",a),r(e,"error",s),e.once("close",u),e.once("finish",c),e.emit("pipe",h),f.flowing||(x("pipe resume"),h.resume()),e},o.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=C(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},o.prototype.on=function(e,t){var n=P.prototype.on.call(this,e,t);if("data"===e)this._readableState.flowing!==!1&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&f(this,r):k(v,this))}return n},o.prototype.addListener=o.prototype.on,o.prototype.resume=function(){var e=this._readableState;return e.flowing||(x("resume"),e.flowing=!0,y(this,e)),this},o.prototype.pause=function(){return x("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(x("pause"),this._readableState.flowing=!1,this.emit("pause")),this},o.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(x("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(x("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){var o=r.push(i);o||(n=!0,e.pause())}});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var o=["error","close","destroy","pause","resume"];return N(o,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){x("wrapped _read",t),n&&(n=!1,e.resume())},r},o._fromList=w},function(e,t,n){"use strict";function r(e){this.afterTransform=function(t,n){return i(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&e.push(n),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=o;var s=n(12),u=n(15);u.inherits=n(16),u.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("Not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;
null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},function(e,t,n){"use strict";function r(){}function i(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function o(e,t){U=U||n(12),e=e||{},this.objectMode=!!e.objectMode,t instanceof U&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=e.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){d(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new _(this)}function a(e){return U=U||n(12),this instanceof a||this instanceof U?(this._writableState=new o(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),void L.call(this)):new a(e)}function s(e,t){var n=new Error("write after end");e.emit("error",n),T(t,n)}function u(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):C.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),T(r,o),i=!1),i}function c(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=k.from(t,n)),t}function l(e,t,n,r,o){n=c(t,n,r),C.isBuffer(n)&&(r="buffer");var a=t.objectMode?1:n.length;t.length+=a;var s=t.length<t.highWaterMark;if(s||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new i(n,r,o),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else h(e,t,!1,a,n,r,o);return s}function h(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function f(e,t,n,r,i){--t.pendingcb,n?T(i,r):i(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function p(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function d(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(p(n),t)f(e,n,r,t,i);else{var o=y(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||v(e,n),r?I(g,e,n,o,i):g(e,n,o,i)}}function g(e,t,n,r){n||m(e,t),t.pendingcb--,r(),E(e,t)}function m(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function v(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0;n;)i[a]=n,n=n.next,a+=1;h(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new _(t)}else{for(;n;){var s=n.chunk,u=n.encoding,c=n.callback,l=t.objectMode?1:s.length;if(h(e,t,!1,l,s,u,c),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function E(e,t){var n=y(t);return n&&(0===t.pendingcb?(b(e,t),t.finished=!0,e.emit("finish")):b(e,t)),n}function w(e,t,n){t.ending=!0,E(e,t),n&&(t.finished?T(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function _(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}e.exports=a;var T=n(34),I=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:T;a.WritableState=o;var S=n(15);S.inherits=n(16);var L,N={deprecate:n(160)};!function(){try{L=n(14)}catch(e){}finally{L||(L=n(4).EventEmitter)}}();var C=n(10).Buffer,k=n(29);S.inherits(a,L);var U;o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:N.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var U;a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},a.prototype.write=function(e,t,n){var i=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),C.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=r),i.ended?s(this,n):u(this,i,e,n)&&(i.pendingcb++,o=l(this,i,e,t,n)),o},a.prototype.cork=function(){var e=this._writableState;e.corked++},a.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||v(this,e))},a.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},a.prototype._write=function(e,t,n){n(new Error("not implemented"))},a.prototype._writev=null,a.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||w(this,r,n)}},function(e,t,n){var r=function(){try{return n(14)}catch(e){}}();t=e.exports=n(54),t.Stream=r||t,t.Readable=t,t.Writable=n(56),t.Duplex=n(12),t.Transform=n(55),t.PassThrough=n(120),!process.browser&&"disable"===process.env.READABLE_STREAM&&r&&(e.exports=r)},function(e,t,n){function r(e){if(e&&!u(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function a(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var s=n(10).Buffer,u=s.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},c=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),r(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=i)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};c.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,r=t.charCodeAt(i);if(r>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},c.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},c.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},function(e,t,n){var r,i,o=Object.prototype.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)o.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=n(9).Token,r=n(8).TdsConstants,t.ColMetaDataToken=function(e){function t(){this.type=129,this.name="COLMETADATA",this.handlerFunction="colmetadata"}return a(t,e),t.type=129,t.name="COLMETADATA",t.prototype.fromBuffer=function(e,t){var n,i,o,a,s;if(o=e.readUInt16LE(),this.columns=new Array(o),this.columnsByName={},65535!==o){for(s=[],i=0,a=o-1;0<=a?i<=a:i>=a;0<=a?i++:i--){if(this.columns[i]=n={index:i,userType:e.readUInt16LE(),flags:e.readUInt16LE(),type:e.readByte()},n.type=r.dataTypesByType[n.type],null==n.type)throw new Error("Unrecognized type 0x"+n.type.toString(16));if(n.isNullable=n.flags&!0,n.isCaseSensitive=n.flags&!0,n.isIdentity=n.flags&!0,n.isWriteable=n.flags&!0,null==n.type.length){if(n.type.hasScaleWithoutLength)n.length=n.scale=e.readByte();else switch(n.type.lengthType){case"int32LE":n.length=e.readInt32LE(),n.lengthType="int32LE";break;case"uint16LE":n.length=e.readUInt16LE(),n.lengthType="uint16LE";break;default:n.length=e.readByte(),n.lengthType="uint8"}if(null!=n.type.lengthSubstitutes&&(n.type=r.dataTypesByType[n.type.lengthSubstitutes[n.length]],null==n.type))throw new Error("Unable to find length substitute "+n.length);n.type.hasCollation?n.collation=e.readBytes(5):n.type.hasScaleAndPrecision&&(n.scale=e.readByte(),n.precision=e.readByte())}else n.length=n.type.length;65535===n.length&&(n.length=-1),n.type.hasTableName&&(n.tableName=e.readUcs2String(e.readUInt16LE())),n.name=e.readUcs2String(e.readByte()),s.push(this.columnsByName[n.name]=n)}return s}},t.prototype.getColumn=function(e){return"string"==typeof e?this.columnsByName[e]:this.columns[e]},t}(i)},function(e,t,n){var r,i,o=Object.prototype.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)o.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(8).TdsConstants,i=n(9).Token,t.DoneToken=function(e){function t(){var e=this;this.type=253,this.name="DONE",this.handlerFunction="done",this.__defineGetter__("hasMore",function(){return e.status&!0}),this.__defineGetter__("isError",function(){return e.status&!0}),this.__defineGetter__("hasRowCount",function(){return e.status&!0}),this.__defineGetter__("isCanceled",function(){return e.status&!0}),this.__defineGetter__("isCancelled",function(){return e.status&!0}),this.__defineGetter__("isFatal",function(){return e.status&!0})}return a(t,e),t.type=253,t.type2=255,t.type3=254,t.name="DONE",t.prototype.fromBuffer=function(e,t){return this.status=e.readUInt16LE(),this.currentCommand=e.readUInt16LE(),t.tdsVersion>=r.versionsByVersion[7.2]?this.rowCount=[e.readUInt32LE(),e.readUInt32LE()]:this.rowCount=e.readInt32LE()},t}(i)},function(e,t,n){var r,i=Object.prototype.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(9).Token,t.LoginAckToken=function(e){function t(){this.type=173,this.name="LOGINACK",this.handlerFunction="loginack"}return o(t,e),t.type=173,t.name="LOGINACK",t.prototype.fromBuffer=function(e,t){var n;return this.length=e.readUInt16LE(),e.assertBytesAvailable(this.length),this.interface=e.readByte(),this.tdsVersion=e.readUInt32LE(),n=e.readByte(),t.logDebug&&console.log("Reading progName of length",n),this.progName=e.readUcs2String(n),this.majorVer=e.readByte(),this.minorVer=e.readByte(),this.buildNum=e.readByte()<<8,this.buildNum+=e.readByte()},t}(r)},function(e,t,n){var r,i,o=Object.prototype.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)o.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(8).TdsConstants,i=n(9).Token,t.MessageToken=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.fromBuffer=function(e,t){return this.length=e.readUInt16LE(),e.assertBytesAvailable(this.length),this.number=e.readInt32LE(),this.state=e.readByte(),this.severity=e.readByte(),this.text=e.readUcs2String(e.readUInt16LE()),t.logDebug&&console.log("Read: %s",this.text),this.serverName=e.readUcs2String(e.readByte()),this.procName=e.readUcs2String(e.readByte()),t.tdsVersion>=r.versionsByVersion[7.2]?this.lineNumber=e.readInt32LE():this.lineNumber=e.readUInt16LE()},t}(i)},function(e,t){t.TdsUtils=function(){function e(){}return e.buildParameterDefinition=function(e,t){var n,r,i;r="";for(n in e){if(i=e[n],t){if("string"!=typeof n||"string"!=typeof i.type)throw new Error("Unexpected param name or type name");if(null!=i.size&&"number"!=typeof i.size)throw new Error("Unexpected type for value size");if(null!=i.scale&&"number"!=typeof i.scale)throw new Error("Unexpected type for value scale");if(null!=i.precision&&"number"!=typeof i.precision)throw new Error("Unexpected type for value precision");if(n.indexOf(!0))throw new Error("Cannot have comma in parameter list");if(n.indexOf(!0))throw new Error("Cannot have at sign (@) in parameter list");if(n.indexOf(!0))throw new Error("Cannot have space in parameter list");if(n.indexOf(!0))throw new Error("Cannot have apostrophe in parameter list")}""!==r&&(r+=","),r+="@"+n+" "+i.type,null!=i.size?r+="("+i.size+")":null!=i.scale&&null!=i.precision&&(r+="("+i.precision+","+i.scale+")"),i.output&&(r+=" OUTPUT")}return r},e.buildParameterizedSql=function(t,n){var r,i,o,a;o="";for(r in n){if(a=n[r],i=t[r],null==i)throw new Error("Undefined parameter "+r);switch(""!==o&&(o+=", "),o+="@"+r+" = ",typeof a){case"string":o+="BIGINT"===i.type.toUpperCase()?a:"N'"+a.replace(/'/g,"''")+"'";break;case"number":o+=a;break;case"boolean":o+=a?1:0;break;case"object":if(null==a)o+="NULL";else if(a instanceof Date)o+="'"+e.formatDate(a,!i.timeOnly,!i.dateOnly)+"'";else{if(!Buffer.isBuffer(a))throw new Error("Unsupported parameter type: "+typeof a);o+="0x"+a.toString("hex")}break;default:throw new Error("Unsupported parameter type: "+typeof a)}}return o},e.formatDate=function(e,t,n){var r;if(r="",t&&(e.getFullYear()<1e3&&(r+="0"),e.getFullYear()<100&&(r+="0"),e.getFullYear()<10&&(r+="0"),r+=e.getFullYear()+"-",e.getMonth()<9&&(r+="0"),r+=e.getMonth()+1+"-",e.getDate()<10&&(r+="0"),r+=e.getDate()),n)return""!==r&&(r+=" "),e.getHours()<10&&(r+="0"),r+=e.getHours()+":",e.getMinutes()<10&&(r+="0"),r+=e.getMinutes()+":",e.getSeconds()<10&&(r+="0"),r+=e.getSeconds()+".",e.getMilliseconds()<100&&(r+="0"),e.getMilliseconds()<10&&(r+="0"),r+=e.getMilliseconds()},e.bigIntBufferToString=function(e){var t,n,r,i,o,a,s;if(t=Array.prototype.slice.call(e,0,e.length),(r=function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)if(t=e[n],0!==t)return!1;return!0})(t))return"0";for(i=function(e){var t,n,r,i;for(n=0,t=i=e.length-1;t>=0;t+=-1)r=256*n+e[t],e[t]=Math.floor(r/10),n=r%10;return n},n=function(e){var t,n,r,i,o;for(n=0,r=e.length;n<r;n++)t=e[n],e[n]=255^e[n];for(o=[],n=0,i=e.length;n<i&&(t=e[n],e[n]=e[n]+1,e[n]>255);n++)o.push(e[n]=0);return o},128&t[t.length-1]?(a="-",n(t)):a="",o="";!r(t);)s=i(t),o=s+o;return a+o},e}()},function(e,t,n){var r,i,o,a,s,u=function(e,t){return function(){return e.apply(t,arguments)}},c=Object.prototype.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var r in t)c.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(4).EventEmitter,o=n(133).TdsClient,s=n(63).TdsUtils,t.Connection=function(e){function t(e){var t,n,r=this;this._options=e,this.end=u(this.end,this),this.rollback=u(this.rollback,this),this.commit=u(this.commit,this),this.setAutoCommit=u(this.setAutoCommit,this),this.prepareBulkLoad=u(this.prepareBulkLoad,this),this.createCall=u(this.createCall,this),this.createStatement=u(this.createStatement,this),this.connect=u(this.connect,this),this._autoCommit=!0,this._client=new o({error:function(e){var t,n;return null!=r._pendingCallback?(r._currentStatement=null,t=r._pendingCallback,r._pendingCallback=null,t(e)):null!=r._pendingLoginCallback?(t=r._pendingLoginCallback,r._pendingLoginCallback=null,t(e)):null!=r._currentStatement?r._currentStatement._error(e):null!=r.handler?"function"==typeof(n=r.handler).error?n.error(e):void 0:r.emit("error",e)},message:function(e){var t,n,i,o;return e.error?(n=new a(e.text,e),null!=r._pendingCallback?(r._currentStatement=null,t=r._pendingCallback,r._pendingCallback=null,t(n)):null!=r._pendingLoginCallback?(t=r._pendingLoginCallback,r._pendingLoginCallback=null,t(n)):null!=r._currentStatement?r._currentStatement._error(n):null!=r.handler?"function"==typeof(i=r.handler).error?i.error(n):void 0:r.emit("error",n)):null!=r._currentStatement?r._currentStatement._message(e):null!=r.handler?"function"==typeof(o=r.handler).message?o.message(e):void 0:r.emit("message",e)},connect:function(e){return r._client.login(r._options)},login:function(e){var t;return t=r._pendingLoginCallback,r._pendingLoginCallback=null,"function"==typeof t?t():void 0},row:function(e){var t;return null!=(t=r._currentStatement)?t._row(e):void 0},colmetadata:function(e){var t;return null!=(t=r._currentStatement)?t._colmetadata(e):void 0},done:function(e){var t;if(!e.hasMore)return null!=r._pendingCallback?("#setAutoCommit"===r._currentStatement&&(r._autoCommit=!r._autoCommit),r._currentStatement=null,t=r._pendingCallback,r._pendingCallback=null,t()):null!=r._currentStatement?r._currentStatement._done(e):void 0}}),this._client.logError=null!=(t=this._options)?t.logError:void 0,this._client.logDebug=null!=(n=this._options)?n.logDebug:void 0}return l(t,e),t.prototype.connect=function(e){return this._pendingLoginCallback=e,this._client.connect(this._options)},t.prototype.createStatement=function(e,t,n){if(this._currentStatement)throw new Error("Statement currently running");return this._options.logDebug&&console.log("Creating statement: %s with params: ",e,t),new i(this,e,t,n)},t.prototype.createCall=function(e,t,n){throw new Error("Not yet implemented")},t.prototype.prepareBulkLoad=function(e,t,n,r){throw new Error("Not yet implemented")},t.prototype.setAutoCommit=function(e,t){if(this._autoCommit===e)return cb();if(null!=this._currentStatement)throw new Error("Cannot change auto commit while statement is executing");return this._pendingCallback=t,this._currentStatement="#setAutoCommit",e?this._client.sqlBatch("SET IMPLICIT_TRANSACTIONS OFF"):this._client.sqlBatch("SET IMPLICIT_TRANSACTIONS ON")},t.prototype.commit=function(e){if(this._autoCommit)throw new Error("Auto commit is on");if(null!=this._currentStatement)throw new Error("Cannot commit while statement is executing");return this._pendingCallback=e,this._currentStatement="#commit",this._client.sqlBatch("IF @@TRANCOUNT > 0 COMMIT TRANSACTION")},t.prototype.rollback=function(e){if(this._autoCommit)throw new Error("Auto commit is on");if(null!=this._currentStatement)throw new Error("Cannot rollback while statement is executing");return this._pendingCallback=e,this._currentStatement="#rollback",this._client.sqlBatch("IF @@TRANCOUNT > 0 ROLLBACK TRANSACTION")},t.prototype.end=function(){return this._autoCommit=!0,this._pendingCallback=null,this._currentStatement=null,this._client.end()},t}(r),i=t.Statement=function(e){function t(e,t,n,r){this._connection=e,this._sql=t,this._params=n,this.handler=r,this._done=u(this._done,this),this._row=u(this._row,this),this._colmetadata=u(this._colmetadata,this),this._message=u(this._message,this),this._error=u(this._error,this),this.cancel=u(this.cancel,this),this.execute=u(this.execute,this),null!=this._params&&(this._parameterString=s.buildParameterDefinition(this._params))}return l(t,e),t.prototype.prepare=function(e){var t;if(null!=this._preparedHandle)throw new Error("Statement already prepared");if(null==this._parameterString||""===this._parameterString)throw new Error("Cannot prepare statement without parameters");if(null!=this._connection._currentStatement)throw new Error("Another statement already executing");return this._connection._currentStatement=this,t="DECLARE @hndl Int;\nEXECUTE sp_prepare @hndl OUTPUT, N'"+this._parameterString+"',\nN'"+this._sql.replace(/'/g,"''")+"\n', 1;\nSELECT @hndl;",this._pendingPrepareCallback=e,this._connection._client.sqlBatch(t)},t.prototype.unprepare=function(e){if(null==this._preparedHandle)throw new Error("Statement not prepared");if(null!=this._connection._currentStatement)throw new Error("Another statement already executing");return this._connection._currentStatement=this,this._pendingUnprepareCallback=e,this._connection._client.sqlBatch("sp_unprepare "+this._preparedHandle)},t.prototype.execute=function(e){var t;if(null!=this._connection._currentStatement)throw new Error("Another statement already executing");return this._connection._currentStatement=this,t=null,null==this._params||""===this._parameterString?t=this._sql:null!=this._preparedHandle?t="EXECUTE sp_execute "+this._preparedHandle+", "+s.buildParameterizedSql(this._params,e):(null==this._parameterizedSql&&(this._parameterizedSql="EXECUTE sp_executesql \nN'"+this._sql.replace(/'/g,"''")+"\n', N'"+this._parameterString+"'"),t=this._parameterizedSql+", "+s.buildParameterizedSql(this._params,e)),this._connection._client.sqlBatch(t)},t.prototype.cancel=function(){if(null!=this._pendingPrepareCallback||null!=this._pendingUnprepareCallback)throw new Error("Unable to cancel (un)prepare");return this._cancelling=!0,this._connection._client.cancel()},t.prototype._error=function(e){var t,n;return null!=this._pendingPrepareCallback?(t=this._pendingPrepareCallback,this._pendingPrepareCallback=null,this._connection.currentStatement=null,t(e),this._ignoreNextDone=!0):null!=this._pendingUnprepareCallback?(t=this._pendingUnprepareCallback,this._pendingUnprepareCallback=null,this._connection.currentStatement=null,t(e),this._ignoreNextDone=!0):null!=this.handler?"function"==typeof(n=this.handler).error?n.error(e):void 0:this.emit("error",e)},t.prototype._message=function(e){var t;return null!=this.handler?"function"==typeof(t=this.handler).message?t.message(e):void 0:this.emit("message",e)},t.prototype._colmetadata=function(e){var t;if(!this._cancelling&&null==this._pendingPrepareCallback&&null==this._pendingUnprepareCallback)return this.metadata=e,null!=this.handler?"function"==typeof(t=this.handler).metadata?t.metadata(this.metadata):void 0:this.emit("metadata",this.metadata)},t.prototype._row=function(e){var t;return null!=this._pendingPrepareCallback?this._preparedHandle=e.getValue(0):this._cancelling?void 0:null!=this.handler?"function"==typeof(t=this.handler).row?t.row(e):void 0:this.emit("row",e)},t.prototype._done=function(e){var t,n;return this._ignoreNextDone?this._ignoreNextDone=void 0:null!=this._pendingPrepareCallback?(t=this._pendingPrepareCallback,this._pendingPrepareCallback=null,this._connection._currentStatement=null,t()):null!=this._pendingUnprepareCallback?(t=this._pendingUnprepareCallback,this._pendingUnprepareCallback=null,this._preparedHandle=void 0,this._connection._currentStatement=null,t()):(this._cancelling&&(this._cancelling=void 0),this._connection._currentStatement=null,null!=this.handler?"function"==typeof(n=this.handler).done?n.done(e):void 0:this.emit("done",e))},t}(r),a=t.TdsError=function(e){function t(e,t){this.message=e,this.info=t,this.name="TdsError",this.stack=(new Error).stack}return l(t,e),t}(Error)},function(e,t,n){"use strict";var r=n(6).default,i=n(7).default,o=n(2).default,a=n(1).default,s=n(4).EventEmitter,u=n(27).WritableTrackingBuffer,c=n(71).TYPE,l={nullable:1,caseSen:2,updateableReadWrite:4,updateableUnknown:8,identity:16,computed:32,fixedLenCLRType:256,sparseColumnSet:1024,hidden:8192,key:16384,nullableUnknown:32768},h={FINAL:0,MORE:1,ERROR:2,INXACT:4,COUNT:16,ATTN:32,SRVERROR:256};e.exports=function(e){function t(e,n,i){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.error=void 0,this.canceled=!1,this.table=e,this.options=n,this.callback=i,this.columns=[],this.columnsByName={},this.rowsData=new u(1024,"ucs2",!0),this.firstRowWritten=!1}return i(t,e),o(t,[{key:"addColumn",value:function(e,t,n){if(null==n&&(n={}),this.firstRowWritten)throw new Error("Columns cannot be added to bulk insert after the first row has been written.");var r={type:t,name:e,value:null,output:n.output||(n.output=!1),length:n.length,precision:n.precision,scale:n.scale,objName:n.objName||e,nullable:n.nullable};return 32===(48&t.id)&&void 0==r.length&&t.resolveLength&&(r.length=t.resolveLength(r)),t.hasPrecision&&void 0==r.precision&&t.resolvePrecision&&(r.precision=t.resolvePrecision(r)),t.hasScale&&void 0==r.scale&&t.resolveScale&&(r.scale=t.resolveScale(r)),this.columns.push(r),this.columnsByName[e]=r}},{key:"addRow",value:function(e){if(this.firstRowWritten=!0,arguments.length>1||!e||"object"!=typeof e){for(var t=new Array(arguments.length),n=0,r=arguments.length;n<r;n++){var i=arguments[n];t[n]=i}e=t}this.rowsData.writeUInt8(c.ROW);for(var o=e instanceof Array,n=0,r=this.columns.length;n<r;n++){var i=this.columns[n];i.type.writeParameterData(this.rowsData,{length:i.length,scale:i.scale,precision:i.precision,value:e[o?n:i.objName]},this.options)}}},{key:"getBulkInsertSql",value:function(){for(var e="insert bulk "+this.table+"(",t=0,n=this.columns.length;t<n;t++){var r=this.columns[t];0!==t&&(e+=", "),e+="["+r.name+"] "+r.type.declaration(r)}return e+=")"}},{key:"getTableCreationSql",value:function(){for(var e="CREATE TABLE "+this.table+"(\n",t=0,n=this.columns.length;t<n;t++){var r=this.columns[t];0!==t&&(e+=",\n"),e+="["+r.name+"] "+r.type.declaration(r),void 0!==r.nullable&&(e+=" "+(r.nullable?"NULL":"NOT NULL"))}return e+="\n)"}},{key:"getPayload",value:function(){var e=this.getColMetaData(),t=e.length,n=this.rowsData.data;t+=n.length;var r=new u(this.options.tdsVersion<"7_2"?9:13);r.writeUInt8(c.DONE);var i=h.FINAL;r.writeUInt16LE(i),r.writeUInt16LE(0),r.writeUInt32LE(0),this.options.tdsVersion>="7_2"&&r.writeUInt32LE(0);var o=r.data;t+=o.length;var a=new u(t);return a.copyFrom(e),a.copyFrom(n),a.copyFrom(o),a}},{key:"getColMetaData",value:function(){var e=new u(100,null,!0);e.writeUInt8(c.COLMETADATA),e.writeUInt16LE(this.columns.length);for(var t=0,n=this.columns.length;t<n;t++){var r=this.columns[t];this.options.tdsVersion<"7_2"?e.writeUInt16LE(0):e.writeUInt32LE(0);var i=l.updateableReadWrite;r.nullable?i|=l.nullable:void 0===r.nullable&&this.options.tdsVersion>="7_2"&&(i|=l.nullableUnknown),e.writeUInt16LE(i),r.type.writeTypeInfo(e,r,this.options),e.writeBVarchar(r.name,"ucs2")}return e.data}}]),t}(s)},function(e,t){"use strict";e.exports.codepageByLcid={1078:"CP1252",1025:"CP1256",2049:"CP1256",3073:"CP1256",4097:"CP1256",5121:"CP1256",6145:"CP1256",7169:"CP1256",8193:"CP1256",9217:"CP1256",10241:"CP1256",11265:"CP1256",12289:"CP1256",13313:"CP1256",14337:"CP1256",15361:"CP1256",16385:"CP1256",1069:"CP1252",1059:"CP1251",1026:"CP1251",1027:"CP1252",197636:"CP950",1028:"CP950",2052:"CP936",133124:"CP936",4100:"CP936",1050:"CP1250",1029:"CP1250",1030:"CP1252",1043:"CP1252",2067:"CP1252",1033:"CP1252",2057:"CP1252",4105:"CP1252",5129:"CP1252",3081:"CP1252",6153:"CP1252",7177:"CP1252",9225:"CP1252",8201:"CP1252",1061:"CP1257",1080:"CP1252",1065:"CP1256",1035:"CP1252",1036:"CP1252",2060:"CP1252",4108:"CP1252",3084:"CP1252",5132:"CP1252",66615:"CP1252",66567:"CP1252",1031:"CP1252",2055:"CP1252",3079:"CP1252",4103:"CP1252",5127:"CP1252",1032:"CP1253",1037:"CP1255",1081:"CPUTF8",1038:"CP1250",4174:"CP1250",1039:"CP1252",1057:"CP1252",1040:"CP1252",2064:"CP1252",1041:"CP932",66577:"CP932",1042:"CP949",1062:"CP1257",1063:"CP1257",2087:"CP1257",1052:"CP1251",1044:"CP1252",2068:"CP1252",1045:"CP1250",2070:"CP1252",1046:"CP1252",1048:"CP1250",1049:"CP1251",2074:"CP1251",3098:"CP1251",1051:"CP1250",1060:"CP1250",2058:"CP1252",1034:"CP1252",3082:"CP1252",4106:"CP1252",5130:"CP1252",6154:"CP1252",7178:"CP1252",8202:"CP1252",9226:"CP1252",10250:"CP1252",11274:"CP1252",12298:"CP1252",13322:"CP1252",14346:"CP1252",15370:"CP1252",16394:"CP1252",1053:"CP1252",1054:"CP874",1055:"CP1254",1058:"CP1251",1056:"CP1256",1066:"CP1258"},e.exports.codepageBySortId={30:"CP437",31:"CP437",32:"CP437",33:"CP437",34:"CP437",40:"CP850",41:"CP850",42:"CP850",43:"CP850",44:"CP850",49:"CP850",51:"CP1252",52:"CP1252",53:"CP1252",54:"CP1252",55:"CP850",56:"CP850",57:"CP850",58:"CP850",59:"CP850",60:"CP850",61:"CP850",80:"CP1250",81:"CP1250",82:"CP1250",83:"CP1250",84:"CP1250",85:"CP1250",86:"CP1250",87:"CP1250",88:"CP1250",89:"CP1250",90:"CP1250",91:"CP1250",92:"CP1250",93:"CP1250",94:"CP1250",95:"CP1250",96:"CP1250",104:"CP1251",105:"CP1251",106:"CP1251",107:"CP1251",108:"CP1251",112:"CP1253",113:"CP1253",114:"CP1253",120:"CP1253",121:"CP1253",122:"CP1253",124:"CP1253",128:"CP1254",129:"CP1254",130:"CP1254",136:"CP1255",137:"CP1255",138:"CP1255",144:"CP1256",145:"CP1256",146:"CP1256",152:"CP1257",153:"CP1257",154:"CP1257",155:"CP1257",156:"CP1257",157:"CP1257",158:"CP1257",159:"CP1257",160:"CP1257",183:"CP1252",184:"CP1252",185:"CP1252",186:"CP1252"}},function(e,t){"use strict";function n(e){var t=e.toString(16);return 1===t.length&&(t="0"+t),t}function r(e){return(n(e[3])+n(e[2])+n(e[1])+n(e[0])+"-"+n(e[5])+n(e[4])+"-"+n(e[7])+n(e[6])+"-"+n(e[8])+n(e[9])+"-"+n(e[10])+n(e[11])+n(e[12])+n(e[13])+n(e[14])+n(e[15])).toUpperCase()}function i(e){return[parseInt(e.substring(6,8),16),parseInt(e.substring(4,6),16),parseInt(e.substring(2,4),16),parseInt(e.substring(0,2),16),parseInt(e.substring(11,13),16),parseInt(e.substring(9,11),16),parseInt(e.substring(16,18),16),parseInt(e.substring(14,16),16),parseInt(e.substring(19,21),16),parseInt(e.substring(21,23),16),parseInt(e.substring(24,26),16),parseInt(e.substring(26,28),16),parseInt(e.substring(28,30),16),parseInt(e.substring(30,32),16),parseInt(e.substring(32,34),16),parseInt(e.substring(34,36),16)]}e.exports.arrayToGuid=r,e.exports.guidToArray=i},function(e,t){"use strict";e.exports.name="Tedious"},function(e,t,n){"use strict";var r=n(6).default,i=n(7).default,o=n(2).default,a=n(1).default,s=n(4).EventEmitter,u=n(25).typeByName,c=n(36).RequestError;e.exports=function(e){function t(e,n){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.sqlTextOrProcedure=e,this.callback=n,this.parameters=[],this.parametersByName={},this.userCallback=this.callback,this.callback=function(){return this.preparing?(this.emit("prepared"),this.preparing=!1):(this.userCallback.apply(this,arguments),this.emit("requestCompleted"))}}return i(t,e),o(t,[{key:"addParameter",value:function(e,t,n,r){null==r&&(r={});var i={type:t,name:e,value:n,output:r.output||(r.output=!1),length:r.length,precision:r.precision,scale:r.scale};return this.parameters.push(i),this.parametersByName[e]=i}},{key:"addOutputParameter",value:function(e,t,n,r){return null==r&&(r={}),r.output=!0,this.addParameter(e,t,n,r)}},{key:"makeParamsParameter",value:function(e){for(var t="",n=0,r=e.length;n<r;n++){var i=e[n];t.length>0&&(t+=", "),t+="@"+i.name+" ",t+=i.type.declaration(i),i.output&&(t+=" OUTPUT")}return t}},{key:"transformIntoExecuteSqlRpc",value:function(){if(!this.validateParameters()){this.originalParameters=this.parameters,this.parameters=[],this.addParameter("statement",u.NVarChar,this.sqlTextOrProcedure),this.originalParameters.length&&this.addParameter("params",u.NVarChar,this.makeParamsParameter(this.originalParameters));for(var e=0,t=this.originalParameters.length;e<t;e++){var n=this.originalParameters[e];this.parameters.push(n)}return this.sqlTextOrProcedure="sp_executesql"}}},{key:"transformIntoPrepareRpc",value:function(){var e=this;return this.originalParameters=this.parameters,
this.parameters=[],this.addOutputParameter("handle",u.Int),this.addParameter("params",u.NVarChar,this.makeParamsParameter(this.originalParameters)),this.addParameter("stmt",u.NVarChar,this.sqlTextOrProcedure),this.sqlTextOrProcedure="sp_prepare",this.preparing=!0,this.on("returnValue",function(t,n){return"handle"===t?e.handle=n:e.error=c("Tedious >Unexpected output parameter "+t+" from sp_prepare")})}},{key:"transformIntoUnprepareRpc",value:function(){return this.parameters=[],this.addParameter("handle",u.Int,this.handle),this.sqlTextOrProcedure="sp_unprepare"}},{key:"transformIntoExecuteRpc",value:function(e){this.parameters=[],this.addParameter("handle",u.Int,this.handle);for(var t=0,n=this.originalParameters.length;t<n;t++){var r=this.originalParameters[t];r.value=e[r.name],this.parameters.push(r)}if(!this.validateParameters())return this.sqlTextOrProcedure="sp_execute"}},{key:"validateParameters",value:function(){for(var e=0,t=this.parameters.length;e<t;e++){var n=this.parameters[e],r=n.type.validate(n.value);if(r instanceof TypeError)return this.error=new c("Validation failed for parameter '"+n.name+"'. "+r.message,"EPARAM");n.value=r}return null}}]),t}(s)},function(e,t){"use strict";function n(e,t,n){e.readUInt16LE(function(){e.readUInt32LE(function(r){e.readUInt8(function(i){e.readUInt8(function(o){e.readUsVarChar(function(a){e.readBVarChar(function(s){e.readBVarChar(function(u){(t.tdsVersion<"7_2"?e.readUInt16LE:e.readUInt32LE).call(e,function(e){n({number:r,state:i,class:o,message:a,serverName:s,procName:u,lineNumber:e})})})})})})})})})}function r(e,t,r,i){n(e,r,function(e){e.name="INFO",e.event="infoMessage",i(e)})}function i(e,t,r,i){n(e,r,function(e){e.name="ERROR",e.event="errorMessage",i(e)})}e.exports.infoParser=r,e.exports.errorParser=i},function(e,t){"use strict";e.exports.TYPE={ALTMETADATA:136,ALTROW:211,COLMETADATA:129,COLINFO:165,DONE:253,DONEPROC:254,DONEINPROC:255,ENVCHANGE:227,ERROR:170,INFO:171,LOGINACK:173,NBCROW:210,OFFSET:120,ORDER:169,RETURNSTATUS:121,RETURNVALUE:172,ROW:209,SSPI:237,TABNAME:164}},function(e,t){e.exports=Promise},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("os")},function(e,t,n){e.exports={default:n(81),__esModule:!0}},function(e,t,n){e.exports={default:n(82),__esModule:!0}},function(e,t,n){e.exports={default:n(83),__esModule:!0}},function(e,t,n){e.exports={default:n(84),__esModule:!0}},function(e,t,n){e.exports=n(80)},function(e,t){!function(e,t){var n=function(e){return/^\d$/.test(e)},r=function(e){if("undefined"!=typeof e){var t=new o(e,!0);return t.sign=1,t}};e.n=function(e){return new o(e)};var i={invalid:"Invalid Number","division by zero":"Invalid Number - Division By Zero"},o=function(e,t){var n;if(this.number=[],this.sign=1,this.rest=0,!e)return void(this.number=[0]);if(e.constructor===o)return t?new o(e.toString()):e;if("object"==typeof e){for((e.length&&"-"===e[0]||"+"===e[0])&&(this.sign="+"===e[0]?1:-1,e.shift(0)),n=e.length-1;n>=0;--n)if(!this.add_digit(e[n],e))return}else for(e=e.toString(),"-"!==e.charAt(0)&&"+"!==e.charAt(0)||(this.sign="+"===e.charAt(0)?1:-1,e=e.substring(1)),n=e.length-1;n>=0;--n)if(!this.add_digit(parseInt(e.charAt(n),10),e))return};o.prototype.add_digit=function(e,t){return n(e)?(this.number.push(e),this):(this.number=i.invalid,!1)},o.prototype._compare=function(e){if("undefined"==typeof e)return 0;var t,n=new o(e);if(this.sign!==n.sign)return this.sign;if(this.number.length>n.number.length)return this.sign;if(this.number.length<n.number.length)return this.sign*-1;for(t=this.number.length-1;t>=0;--t){if(this.number[t]>n.number[t])return this.sign;if(this.number[t]<n.number[t])return this.sign*-1}return 0},o.prototype.gt=function(e){return this._compare(e)>0},o.prototype.gte=function(e){return this._compare(e)>=0},o.prototype.equals=function(e){return 0===this._compare(e)},o.prototype.lte=function(e){return this._compare(e)<=0},o.prototype.lt=function(e){return this._compare(e)<0},o.prototype.add=function(e){if("undefined"==typeof e)return this;var t=new o(e);return this.sign!==t.sign?this.sign>0?(t.sign=1,this.minus(t)):(this.sign=1,t.minus(this)):(this.number=o._add(this,t),this)},o.prototype.subtract=function(e){if("undefined"==typeof e)return this;var t=new o(e);return this.sign!==t.sign?(this.number=o._add(this,t),this):(this.sign=this.lt(t)?-1:1,this.number=r(this).lt(r(t))?o._subtract(t,this):o._subtract(this,t),this)},o._add=function(e,t){var n,r=0,i=Math.max(e.number.length,t.number.length);for(n=0;n<i||r>0;++n)e.number[n]=(r+=(e.number[n]||0)+(t.number[n]||0))%10,r=Math.floor(r/10);return e.number},o._subtract=function(e,t){var n,r=0,i=e.number.length;for(n=0;n<i;++n)e.number[n]-=(t.number[n]||0)+r,e.number[n]+=10*(r=e.number[n]<0?1:0);for(n=0,i=e.number.length-1;0===e.number[i-n]&&i-n>0;)n++;return n>0&&e.number.splice(-n),e.number},o.prototype.multiply=function(e){if("undefined"==typeof e)return this;var t,n,r=new o(e),i=0,a=[];if(this.isZero()||r.isZero())return new o(0);for(this.sign*=r.sign,t=0;t<this.number.length;++t)for(i=0,n=0;n<r.number.length||i>0;++n)a[t+n]=(i+=(a[t+n]||0)+this.number[t]*(r.number[n]||0))%10,i=Math.floor(i/10);return this.number=a,this},o.prototype.divide=function(e){if("undefined"==typeof e)return this;var t,n,r=new o(e),a=[],s=new o;if(r.isZero())return this.number=i["division by zero"],this;if(this.isZero())return new o(0);if(this.sign*=r.sign,r.sign=1,1===r.number.length&&1===r.number[0])return this;for(t=this.number.length-1;t>=0;t--)for(s.multiply(10),s.number[0]=this.number[t],a[t]=0;r.lte(s);)a[t]++,s.subtract(r);for(t=0,n=a.length-1;0===a[n-t]&&n-t>0;)t++;return t>0&&a.splice(-t),this.rest=s,this.number=a,this},o.prototype.mod=function(e){return this.divide(e).rest},o.prototype.power=function(e){if("undefined"!=typeof e){var t;if(e=+e,0===e)return new o(1);if(1===e)return this;for(t=new o(this,!0),this.number=[1];e>0;)e%2!==1?(t.multiply(t),e=Math.floor(e/2)):(this.multiply(t),e--);return this}},o.prototype.abs=function(){return this.sign=1,this},o.prototype.isZero=function(){return 1===this.number.length&&0===this.number[0]},o.prototype.toString=function(){var e,t="";if("string"==typeof this.number)return this.number;for(e=this.number.length-1;e>=0;--e)t+=this.number[e];return this.sign>0?t:"-"+t},o.prototype.plus=o.prototype.add,o.prototype.minus=o.prototype.subtract,o.prototype.div=o.prototype.divide,o.prototype.mult=o.prototype.multiply,o.prototype.pow=o.prototype.power,o.prototype.val=o.prototype.toString}(this)},function(e,t,n){var r=n(21);e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){var r=n(21);e.exports=function(e,t,n){return r.setDesc(e,t,n)}},function(e,t,n){var r=n(21);n(95),e.exports=function(e,t){return r.getDesc(e,t)}},function(e,t,n){n(96),e.exports=n(30).Object.setPrototypeOf},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(46);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){var r=n(87);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(45),i=n(30),o=n(89);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*o(function(){n(1)}),"Object",a)}},function(e,t,n){var r=n(21).getDesc,i=n(46),o=n(86),a=function(e,t){if(o(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{i=n(44)(Function.call,r(Object.prototype,"__proto__").set,2),i(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:i(e,n),e}}({},!1):void 0),check:a}},function(e,t,n){var r=n(91),i=n(88);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(94);n(92)("getOwnPropertyDescriptor",function(e){return function(t,n){return e(r(t),n)}})},function(e,t,n){var r=n(45);r(r.S,"Object",{setPrototypeOf:n(93).set})},function(e,t){"use strict";function n(e,t){if(this.encodingName=e.encodingName,!e)throw new Error("DBCS codec is called without the data.");if(!e.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var n=e.table();this.decodeTables=[],this.decodeTables[0]=l.slice(0),this.decodeTableSeq=[];for(var r=0;r<n.length;r++)this._addDecodeChunk(n[r]);this.defaultCharUnicode=t.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var i={};if(e.encodeSkipVals)for(var r=0;r<e.encodeSkipVals.length;r++){var o=e.encodeSkipVals[r];if("number"==typeof o)i[o]=!0;else for(var u=o.from;u<=o.to;u++)i[u]=!0}if(this._fillEncodeTable(0,0,i),e.encodeAdd)for(var h in e.encodeAdd)Object.prototype.hasOwnProperty.call(e.encodeAdd,h)&&this._setEncodeChar(h.charCodeAt(0),e.encodeAdd[h]);if(this.defCharSB=this.encodeTable[0][t.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===a&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===a&&(this.defCharSB="?".charCodeAt(0)),"function"==typeof e.gb18030){this.gb18030=e.gb18030();for(var f=this.decodeTables.length,p=this.decodeTables[f]=l.slice(0),d=this.decodeTables.length,g=this.decodeTables[d]=l.slice(0),r=129;r<=254;r++)for(var m=c-this.decodeTables[0][r],v=this.decodeTables[m],u=48;u<=57;u++)v[u]=c-f;for(var r=129;r<=254;r++)p[r]=c-d;for(var r=48;r<=57;r++)g[r]=s}}function r(e,t){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=t.encodeTable,this.encodeTableSeq=t.encodeTableSeq,this.defaultCharSingleByte=t.defCharSB,this.gb18030=t.gb18030}function i(e,t){this.nodeIdx=0,this.prevBuf=new Buffer(0),this.decodeTables=t.decodeTables,this.decodeTableSeq=t.decodeTableSeq,this.defaultCharUnicode=t.defaultCharUnicode,this.gb18030=t.gb18030}function o(e,t){if(e[0]>t)return-1;for(var n=0,r=e.length;n<r-1;){var i=n+Math.floor((r-n+1)/2);e[i]<=t?n=i:r=i}return n}t._dbcs=n;for(var a=-1,s=-2,u=-10,c=-1e3,l=new Array(256),h=-1,f=0;f<256;f++)l[f]=a;n.prototype.encoder=r,n.prototype.decoder=i,n.prototype._getDecodeTrieNode=function(e){for(var t=[];e>0;e>>=8)t.push(255&e);0==t.length&&t.push(0);for(var n=this.decodeTables[0],r=t.length-1;r>0;r--){var i=n[t[r]];if(i==a)n[t[r]]=c-this.decodeTables.length,this.decodeTables.push(n=l.slice(0));else{if(!(i<=c))throw new Error("Overwrite byte in "+this.encodingName+", addr: "+e.toString(16));n=this.decodeTables[c-i]}}return n},n.prototype._addDecodeChunk=function(e){var t=parseInt(e[0],16),n=this._getDecodeTrieNode(t);t&=255;for(var r=1;r<e.length;r++){var i=e[r];if("string"==typeof i)for(var o=0;o<i.length;){var a=i.charCodeAt(o++);if(55296<=a&&a<56320){var s=i.charCodeAt(o++);if(!(56320<=s&&s<57344))throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+e[0]);n[t++]=65536+1024*(a-55296)+(s-56320)}else if(4080<a&&a<=4095){for(var c=4095-a+2,l=[],h=0;h<c;h++)l.push(i.charCodeAt(o++));n[t++]=u-this.decodeTableSeq.length,this.decodeTableSeq.push(l)}else n[t++]=a}else{if("number"!=typeof i)throw new Error("Incorrect type '"+typeof i+"' given in "+this.encodingName+" at chunk "+e[0]);for(var f=n[t-1]+1,o=0;o<i;o++)n[t++]=f++}}if(t>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+e[0]+": too long"+t)},n.prototype._getEncodeBucket=function(e){var t=e>>8;return void 0===this.encodeTable[t]&&(this.encodeTable[t]=l.slice(0)),this.encodeTable[t]},n.prototype._setEncodeChar=function(e,t){var n=this._getEncodeBucket(e),r=255&e;n[r]<=u?this.encodeTableSeq[u-n[r]][h]=t:n[r]==a&&(n[r]=t)},n.prototype._setEncodeSequence=function(e,t){var n,r=e[0],i=this._getEncodeBucket(r),o=255&r;i[o]<=u?n=this.encodeTableSeq[u-i[o]]:(n={},i[o]!==a&&(n[h]=i[o]),i[o]=u-this.encodeTableSeq.length,this.encodeTableSeq.push(n));for(var s=1;s<e.length-1;s++){var c=n[r];"object"==typeof c?n=c:(n=n[r]={},void 0!==c&&(n[h]=c))}r=e[e.length-1],n[r]=t},n.prototype._fillEncodeTable=function(e,t,n){for(var r=this.decodeTables[e],i=0;i<256;i++){var o=r[i],a=t+i;n[a]||(o>=0?this._setEncodeChar(o,a):o<=c?this._fillEncodeTable(c-o,a<<8,n):o<=u&&this._setEncodeSequence(this.decodeTableSeq[u-o],a))}},r.prototype.write=function(e){for(var t=new Buffer(e.length*(this.gb18030?4:3)),n=this.leadSurrogate,r=this.seqObj,i=-1,s=0,c=0;;){if(i===-1){if(s==e.length)break;var l=e.charCodeAt(s++)}else{var l=i;i=-1}if(55296<=l&&l<57344)if(l<56320){if(n===-1){n=l;continue}n=l,l=a}else n!==-1?(l=65536+1024*(n-55296)+(l-56320),n=-1):l=a;else n!==-1&&(i=l,l=a,n=-1);var f=a;if(void 0!==r&&l!=a){var p=r[l];if("object"==typeof p){r=p;continue}"number"==typeof p?f=p:void 0==p&&(p=r[h],void 0!==p&&(f=p,i=l)),r=void 0}else if(l>=0){var d=this.encodeTable[l>>8];if(void 0!==d&&(f=d[255&l]),f<=u){r=this.encodeTableSeq[u-f];continue}if(f==a&&this.gb18030){var g=o(this.gb18030.uChars,l);if(g!=-1){var f=this.gb18030.gbChars[g]+(l-this.gb18030.uChars[g]);t[c++]=129+Math.floor(f/12600),f%=12600,t[c++]=48+Math.floor(f/1260),f%=1260,t[c++]=129+Math.floor(f/10),f%=10,t[c++]=48+f;continue}}}f===a&&(f=this.defaultCharSingleByte),f<256?t[c++]=f:f<65536?(t[c++]=f>>8,t[c++]=255&f):(t[c++]=f>>16,t[c++]=f>>8&255,t[c++]=255&f)}return this.seqObj=r,this.leadSurrogate=n,t.slice(0,c)},r.prototype.end=function(){if(this.leadSurrogate!==-1||void 0!==this.seqObj){var e=new Buffer(10),t=0;if(this.seqObj){var n=this.seqObj[h];void 0!==n&&(n<256?e[t++]=n:(e[t++]=n>>8,e[t++]=255&n)),this.seqObj=void 0}return this.leadSurrogate!==-1&&(e[t++]=this.defaultCharSingleByte,this.leadSurrogate=-1),e.slice(0,t)}},r.prototype.findIdx=o,i.prototype.write=function(e){var t,n=new Buffer(2*e.length),r=this.nodeIdx,i=this.prevBuf,l=this.prevBuf.length,h=-this.prevBuf.length;l>0&&(i=Buffer.concat([i,e.slice(0,10)]));for(var f=0,p=0;f<e.length;f++){var d=f>=0?e[f]:i[f+l],t=this.decodeTables[r][d];if(t>=0);else if(t===a)f=h,t=this.defaultCharUnicode.charCodeAt(0);else if(t===s){var g=h>=0?e.slice(h,f+1):i.slice(h+l,f+1+l),m=12600*(g[0]-129)+1260*(g[1]-48)+10*(g[2]-129)+(g[3]-48),v=o(this.gb18030.gbChars,m);t=this.gb18030.uChars[v]+m-this.gb18030.gbChars[v]}else{if(t<=c){r=c-t;continue}if(!(t<=u))throw new Error("iconv-lite internal error: invalid decoding table value "+t+" at "+r+"/"+d);for(var y=this.decodeTableSeq[u-t],b=0;b<y.length-1;b++)t=y[b],n[p++]=255&t,n[p++]=t>>8;t=y[y.length-1]}if(t>65535){t-=65536;var E=55296+Math.floor(t/1024);n[p++]=255&E,n[p++]=E>>8,t=56320+t%1024}n[p++]=255&t,n[p++]=t>>8,r=0,h=f+1}return this.nodeIdx=r,this.prevBuf=h>=0?e.slice(h):i.slice(h+l),n.slice(0,p).toString("ucs2")},i.prototype.end=function(){for(var e="";this.prevBuf.length>0;){e+=this.defaultCharUnicode;var t=this.prevBuf.slice(1);this.prevBuf=new Buffer(0),this.nodeIdx=0,t.length>0&&(e+=this.write(t))}return this.nodeIdx=0,e}},function(e,t,n){"use strict";e.exports={shiftjis:{type:"_dbcs",table:function(){return n(116)},encodeAdd:{"":92,"":126},encodeSkipVals:[{from:60736,to:63808}]},csshiftjis:"shiftjis",mskanji:"shiftjis",sjis:"shiftjis",windows31j:"shiftjis",xsjis:"shiftjis",windows932:"shiftjis",932:"shiftjis",cp932:"shiftjis",eucjp:{type:"_dbcs",table:function(){return n(114)},encodeAdd:{"":92,"":126}},gb2312:"cp936",gb231280:"cp936",gb23121980:"cp936",csgb2312:"cp936",csiso58gb231280:"cp936",euccn:"cp936",isoir58:"gbk",windows936:"cp936",936:"cp936",cp936:{type:"_dbcs",table:function(){return n(31)}},gbk:{type:"_dbcs",table:function(){return n(31).concat(n(48))}},xgbk:"gbk",gb18030:{type:"_dbcs",table:function(){return n(31).concat(n(48))},gb18030:function(){return n(115)}},chinese:"gb18030",windows949:"cp949",949:"cp949",cp949:{type:"_dbcs",table:function(){return n(113)}},cseuckr:"cp949",csksc56011987:"cp949",euckr:"cp949",isoir149:"cp949",korean:"cp949",ksc56011987:"cp949",ksc56011989:"cp949",ksc5601:"cp949",windows950:"cp950",950:"cp950",cp950:{type:"_dbcs",table:function(){return n(47)}},big5:"big5hkscs",big5hkscs:{type:"_dbcs",table:function(){return n(47).concat(n(112))},encodeSkipVals:[41676]},cnbig5:"big5hkscs",csbig5:"big5hkscs",xxbig5:"big5hkscs"}},function(e,t,n){"use strict";for(var r=[n(100),n(104),n(105),n(101),n(103),n(102),n(97),n(98)],i=0;i<r.length;i++){var e=r[i];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}},function(e,t,n){"use strict";function r(e,t){this.enc=e.encodingName,this.bomAware=e.bomAware,"base64"===this.enc?this.encoder=a:"cesu8"===this.enc&&(this.enc="utf8",this.encoder=s,3==new Buffer("eda080","hex").toString().length&&(this.decoder=u,this.defaultCharUnicode=t.defaultCharUnicode))}function i(e,t){c.call(this,t.enc)}function o(e,t){this.enc=t.enc}function a(e,t){this.prevStr=""}function s(e,t){}function u(e,t){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=t.defaultCharUnicode}e.exports={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:r},r.prototype.encoder=o,r.prototype.decoder=i;var c=n(166).StringDecoder;c.prototype.end||(c.prototype.end=function(){}),i.prototype=c.prototype,o.prototype.write=function(e){return new Buffer(e,this.enc)},o.prototype.end=function(){},a.prototype.write=function(e){e=this.prevStr+e;var t=e.length-e.length%4;return this.prevStr=e.slice(t),e=e.slice(0,t),new Buffer(e,"base64")},a.prototype.end=function(){return new Buffer(this.prevStr,"base64")},s.prototype.write=function(e){for(var t=new Buffer(3*e.length),n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=192+(i>>>6),t[n++]=128+(63&i)):(t[n++]=224+(i>>>12),t[n++]=128+(i>>>6&63),t[n++]=128+(63&i))}return t.slice(0,n)},s.prototype.end=function(){},u.prototype.write=function(e){for(var t=this.acc,n=this.contBytes,r=this.accBytes,i="",o=0;o<e.length;o++){var a=e[o];128!==(192&a)?(n>0&&(i+=this.defaultCharUnicode,n=0),a<128?i+=String.fromCharCode(a):a<224?(t=31&a,n=1,r=1):a<240?(t=15&a,n=2,r=1):i+=this.defaultCharUnicode):n>0?(t=t<<6|63&a,n--,r++,0===n&&(i+=2===r&&t<128&&t>0?this.defaultCharUnicode:3===r&&t<2048?this.defaultCharUnicode:String.fromCharCode(t))):i+=this.defaultCharUnicode}return this.acc=t,this.contBytes=n,this.accBytes=r,i},u.prototype.end=function(){var e=0;return this.contBytes>0&&(e+=this.defaultCharUnicode),e}},function(e,t){"use strict";function n(e,t){if(!e)throw new Error("SBCS codec is called without the data.");if(!e.chars||128!==e.chars.length&&256!==e.chars.length)throw new Error("Encoding '"+e.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(128===e.chars.length){for(var n="",r=0;r<128;r++)n+=String.fromCharCode(r);e.chars=n+e.chars}this.decodeBuf=new Buffer(e.chars,"ucs2");var i=new Buffer(65536);i.fill(t.defaultCharSingleByte.charCodeAt(0));for(var r=0;r<e.chars.length;r++)i[e.chars.charCodeAt(r)]=r;this.encodeBuf=i}function r(e,t){this.encodeBuf=t.encodeBuf}function i(e,t){this.decodeBuf=t.decodeBuf}t._sbcs=n,n.prototype.encoder=r,n.prototype.decoder=i,r.prototype.write=function(e){for(var t=new Buffer(e.length),n=0;n<e.length;n++)t[n]=this.encodeBuf[e.charCodeAt(n)];return t},r.prototype.end=function(){},i.prototype.write=function(e){for(var t=this.decodeBuf,n=new Buffer(2*e.length),r=0,i=0,o=0;o<e.length;o++)r=2*e[o],i=2*o,n[i]=t[r],n[i+1]=t[r+1];return n.toString("ucs2")},i.prototype.end=function(){}},function(e,t){"use strict";e.exports={437:"cp437",737:"cp737",775:"cp775",850:"cp850",852:"cp852",855:"cp855",856:"cp856",857:"cp857",858:"cp858",860:"cp860",861:"cp861",862:"cp862",863:"cp863",864:"cp864",865:"cp865",866:"cp866",869:"cp869",874:"windows874",922:"cp922",1046:"cp1046",1124:"cp1124",1125:"cp1125",1129:"cp1129",1133:"cp1133",1161:"cp1161",1162:"cp1162",1163:"cp1163",1250:"windows1250",1251:"windows1251",1252:"windows1252",1253:"windows1253",1254:"windows1254",1255:"windows1255",1256:"windows1256",1257:"windows1257",1258:"windows1258",28591:"iso88591",28592:"iso88592",28593:"iso88593",28594:"iso88594",28595:"iso88595",28596:"iso88596",28597:"iso88597",28598:"iso88598",28599:"iso88599",28600:"iso885910",28601:"iso885911",28603:"iso885913",28604:"iso885914",28605:"iso885915",28606:"iso885916",windows874:{type:"_sbcs",chars:""},win874:"windows874",cp874:"windows874",windows1250:{type:"_sbcs",chars:""},win1250:"windows1250",cp1250:"windows1250",windows1251:{type:"_sbcs",chars:""},win1251:"windows1251",cp1251:"windows1251",windows1252:{type:"_sbcs",chars:""},win1252:"windows1252",cp1252:"windows1252",windows1253:{type:"_sbcs",chars:""},win1253:"windows1253",cp1253:"windows1253",windows1254:{type:"_sbcs",chars:""},win1254:"windows1254",cp1254:"windows1254",windows1255:{type:"_sbcs",chars:""},win1255:"windows1255",cp1255:"windows1255",windows1256:{type:"_sbcs",chars:""},win1256:"windows1256",cp1256:"windows1256",windows1257:{type:"_sbcs",chars:""},win1257:"windows1257",cp1257:"windows1257",windows1258:{type:"_sbcs",chars:""},win1258:"windows1258",cp1258:"windows1258",iso88591:{type:"_sbcs",chars:""},cp28591:"iso88591",iso88592:{type:"_sbcs",chars:""},cp28592:"iso88592",iso88593:{type:"_sbcs",chars:""},cp28593:"iso88593",iso88594:{type:"_sbcs",chars:""},cp28594:"iso88594",iso88595:{type:"_sbcs",chars:""},cp28595:"iso88595",iso88596:{type:"_sbcs",chars:""},cp28596:"iso88596",iso88597:{type:"_sbcs",chars:""},cp28597:"iso88597",iso88598:{type:"_sbcs",chars:""},cp28598:"iso88598",iso88599:{type:"_sbcs",chars:""},cp28599:"iso88599",iso885910:{type:"_sbcs",chars:""},cp28600:"iso885910",iso885911:{type:"_sbcs",chars:""},cp28601:"iso885911",iso885913:{type:"_sbcs",chars:""},cp28603:"iso885913",iso885914:{type:"_sbcs",chars:""},cp28604:"iso885914",iso885915:{type:"_sbcs",chars:""},cp28605:"iso885915",iso885916:{type:"_sbcs",chars:""},cp28606:"iso885916",cp437:{type:"_sbcs",chars:""},ibm437:"cp437",csibm437:"cp437",cp737:{type:"_sbcs",chars:""},ibm737:"cp737",csibm737:"cp737",cp775:{type:"_sbcs",chars:""},ibm775:"cp775",csibm775:"cp775",cp850:{type:"_sbcs",chars:""},ibm850:"cp850",csibm850:"cp850",cp852:{type:"_sbcs",chars:""},ibm852:"cp852",csibm852:"cp852",cp855:{type:"_sbcs",chars:""},ibm855:"cp855",csibm855:"cp855",cp856:{type:"_sbcs",chars:""},ibm856:"cp856",csibm856:"cp856",cp857:{type:"_sbcs",chars:""},ibm857:"cp857",csibm857:"cp857",cp858:{type:"_sbcs",chars:""},ibm858:"cp858",csibm858:"cp858",cp860:{type:"_sbcs",chars:""},ibm860:"cp860",csibm860:"cp860",cp861:{type:"_sbcs",chars:""},ibm861:"cp861",csibm861:"cp861",cp862:{type:"_sbcs",chars:""},ibm862:"cp862",csibm862:"cp862",cp863:{type:"_sbcs",chars:""},ibm863:"cp863",csibm863:"cp863",cp864:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},ibm864:"cp864",csibm864:"cp864",cp865:{type:"_sbcs",chars:""},ibm865:"cp865",csibm865:"cp865",cp866:{type:"_sbcs",chars:""},ibm866:"cp866",csibm866:"cp866",cp869:{type:"_sbcs",chars:""},ibm869:"cp869",csibm869:"cp869",cp922:{type:"_sbcs",chars:""},ibm922:"cp922",csibm922:"cp922",cp1046:{type:"_sbcs",chars:""},ibm1046:"cp1046",csibm1046:"cp1046",cp1124:{type:"_sbcs",chars:""},ibm1124:"cp1124",csibm1124:"cp1124",cp1125:{type:"_sbcs",chars:""},ibm1125:"cp1125",csibm1125:"cp1125",cp1129:{type:"_sbcs",chars:""},ibm1129:"cp1129",csibm1129:"cp1129",cp1133:{type:"_sbcs",chars:""},ibm1133:"cp1133",csibm1133:"cp1133",cp1161:{type:"_sbcs",chars:""},ibm1161:"cp1161",csibm1161:"cp1161",cp1162:{type:"_sbcs",chars:""},ibm1162:"cp1162",csibm1162:"cp1162",cp1163:{type:"_sbcs",chars:""},ibm1163:"cp1163",csibm1163:"cp1163",maccroatian:{type:"_sbcs",chars:""},maccyrillic:{type:"_sbcs",chars:""},macgreek:{type:"_sbcs",chars:""},maciceland:{type:"_sbcs",chars:""},macroman:{type:"_sbcs",chars:""},macromania:{type:"_sbcs",chars:""},macthai:{type:"_sbcs",chars:"\ufeff"},macturkish:{type:"_sbcs",chars:""},macukraine:{type:"_sbcs",chars:""},koi8r:{type:"_sbcs",chars:""
},koi8u:{type:"_sbcs",chars:""},koi8ru:{type:"_sbcs",chars:""},koi8t:{type:"_sbcs",chars:""},armscii8:{type:"_sbcs",chars:")(.,-"},rk1048:{type:"_sbcs",chars:""},tcvn:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},georgianacademy:{type:"_sbcs",chars:""},georgianps:{type:"_sbcs",chars:""},pt154:{type:"_sbcs",chars:""},viscii:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},iso646cn:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}"},iso646jp:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}"},hproman8:{type:"_sbcs",chars:""},macintosh:{type:"_sbcs",chars:""},ascii:{type:"_sbcs",chars:""},tis620:{type:"_sbcs",chars:""}}},function(e,t){"use strict";e.exports={10029:"maccenteuro",maccenteuro:{type:"_sbcs",chars:""},808:"cp808",ibm808:"cp808",cp808:{type:"_sbcs",chars:""},ascii8bit:"ascii",usascii:"ascii",ansix34:"ascii",ansix341968:"ascii",ansix341986:"ascii",csascii:"ascii",cp367:"ascii",ibm367:"ascii",isoir6:"ascii",iso646us:"ascii",iso646irv:"ascii",us:"ascii",latin1:"iso88591",latin2:"iso88592",latin3:"iso88593",latin4:"iso88594",latin5:"iso88599",latin6:"iso885910",latin7:"iso885913",latin8:"iso885914",latin9:"iso885915",latin10:"iso885916",csisolatin1:"iso88591",csisolatin2:"iso88592",csisolatin3:"iso88593",csisolatin4:"iso88594",csisolatincyrillic:"iso88595",csisolatinarabic:"iso88596",csisolatingreek:"iso88597",csisolatinhebrew:"iso88598",csisolatin5:"iso88599",csisolatin6:"iso885910",l1:"iso88591",l2:"iso88592",l3:"iso88593",l4:"iso88594",l5:"iso88599",l6:"iso885910",l7:"iso885913",l8:"iso885914",l9:"iso885915",l10:"iso885916",isoir14:"iso646jp",isoir57:"iso646cn",isoir100:"iso88591",isoir101:"iso88592",isoir109:"iso88593",isoir110:"iso88594",isoir144:"iso88595",isoir127:"iso88596",isoir126:"iso88597",isoir138:"iso88598",isoir148:"iso88599",isoir157:"iso885910",isoir166:"tis620",isoir179:"iso885913",isoir199:"iso885914",isoir203:"iso885915",isoir226:"iso885916",cp819:"iso88591",ibm819:"iso88591",cyrillic:"iso88595",arabic:"iso88596",arabic8:"iso88596",ecma114:"iso88596",asmo708:"iso88596",greek:"iso88597",greek8:"iso88597",ecma118:"iso88597",elot928:"iso88597",hebrew:"iso88598",hebrew8:"iso88598",turkish:"iso88599",turkish8:"iso88599",thai:"iso885911",thai8:"iso885911",celtic:"iso885914",celtic8:"iso885914",isoceltic:"iso885914",tis6200:"tis620",tis62025291:"tis620",tis62025330:"tis620",10000:"macroman",10006:"macgreek",10007:"maccyrillic",10079:"maciceland",10081:"macturkish",cspc8codepage437:"cp437",cspc775baltic:"cp775",cspc850multilingual:"cp850",cspcp852:"cp852",cspc862latinhebrew:"cp862",cpgr:"cp869",msee:"cp1250",mscyrl:"cp1251",msansi:"cp1252",msgreek:"cp1253",msturk:"cp1254",mshebr:"cp1255",msarab:"cp1256",winbaltrim:"cp1257",cp20866:"koi8r",20866:"koi8r",ibm878:"koi8r",cskoi8r:"koi8r",cp21866:"koi8u",21866:"koi8u",ibm1168:"koi8u",strk10482002:"rk1048",tcvn5712:"tcvn",tcvn57121:"tcvn",gb198880:"iso646cn",cn:"iso646cn",csiso14jisc6220ro:"iso646jp",jisc62201969ro:"iso646jp",jp:"iso646jp",cshproman8:"hproman8",r8:"hproman8",roman8:"hproman8",xroman8:"hproman8",ibm1051:"hproman8",mac:"macintosh",csmacintosh:"macintosh"}},function(e,t){"use strict";function n(){}function r(){}function i(){this.overflowByte=-1}function o(e,t){this.iconv=t}function a(e,t){e=e||{},void 0===e.addBOM&&(e.addBOM=!0),this.encoder=t.iconv.getEncoder("utf-16le",e)}function s(e,t){this.decoder=null,this.initialBytes=[],this.initialBytesLen=0,this.options=e||{},this.iconv=t.iconv}function u(e,t){var n=t||"utf-16le";if(e.length>=2)if(254==e[0]&&255==e[1])n="utf-16be";else if(255==e[0]&&254==e[1])n="utf-16le";else{for(var r=0,i=0,o=Math.min(e.length-e.length%2,64),a=0;a<o;a+=2)0===e[a]&&0!==e[a+1]&&i++,0!==e[a]&&0===e[a+1]&&r++;i>r?n="utf-16be":i<r&&(n="utf-16le")}return n}t.utf16be=n,n.prototype.encoder=r,n.prototype.decoder=i,n.prototype.bomAware=!0,r.prototype.write=function(e){for(var t=new Buffer(e,"ucs2"),n=0;n<t.length;n+=2){var r=t[n];t[n]=t[n+1],t[n+1]=r}return t},r.prototype.end=function(){},i.prototype.write=function(e){if(0==e.length)return"";var t=new Buffer(e.length+1),n=0,r=0;for(this.overflowByte!==-1&&(t[0]=e[0],t[1]=this.overflowByte,n=1,r=2);n<e.length-1;n+=2,r+=2)t[r]=e[n+1],t[r+1]=e[n];return this.overflowByte=n==e.length-1?e[e.length-1]:-1,t.slice(0,r).toString("ucs2")},i.prototype.end=function(){},t.utf16=o,o.prototype.encoder=a,o.prototype.decoder=s,a.prototype.write=function(e){return this.encoder.write(e)},a.prototype.end=function(){return this.encoder.end()},s.prototype.write=function(e){if(!this.decoder){if(this.initialBytes.push(e),this.initialBytesLen+=e.length,this.initialBytesLen<16)return"";var e=Buffer.concat(this.initialBytes),t=u(e,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(t,this.options),this.initialBytes.length=this.initialBytesLen=0}return this.decoder.write(e)},s.prototype.end=function(){if(!this.decoder){var e=Buffer.concat(this.initialBytes),t=u(e,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(t,this.options);var n=this.decoder.write(e),r=this.decoder.end();return r?n+r:n}return this.decoder.end()}},function(e,t){"use strict";function n(e,t){this.iconv=t}function r(e,t){this.iconv=t.iconv}function i(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=""}function o(e,t){this.iconv=t}function a(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=new Buffer(6),this.base64AccumIdx=0}function s(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=""}t.utf7=n,t.unicode11utf7="utf7",n.prototype.encoder=r,n.prototype.decoder=i,n.prototype.bomAware=!0;var u=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;r.prototype.write=function(e){return new Buffer(e.replace(u,function(e){return"+"+("+"===e?"":this.iconv.encode(e,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))},r.prototype.end=function(){};for(var c=/[A-Za-z0-9\/+]/,l=[],h=0;h<256;h++)l[h]=c.test(String.fromCharCode(h));var f="+".charCodeAt(0),p="-".charCodeAt(0),d="&".charCodeAt(0);i.prototype.write=function(e){for(var t="",n=0,r=this.inBase64,i=this.base64Accum,o=0;o<e.length;o++)if(r){if(!l[e[o]]){if(o==n&&e[o]==p)t+="+";else{var a=i+e.slice(n,o).toString();t+=this.iconv.decode(new Buffer(a,"base64"),"utf16-be")}e[o]!=p&&o--,n=o+1,r=!1,i=""}}else e[o]==f&&(t+=this.iconv.decode(e.slice(n,o),"ascii"),n=o+1,r=!0);if(r){var a=i+e.slice(n).toString(),s=a.length-a.length%8;i=a.slice(s),a=a.slice(0,s),t+=this.iconv.decode(new Buffer(a,"base64"),"utf16-be")}else t+=this.iconv.decode(e.slice(n),"ascii");return this.inBase64=r,this.base64Accum=i,t},i.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e},t.utf7imap=o,o.prototype.encoder=a,o.prototype.decoder=s,o.prototype.bomAware=!0,a.prototype.write=function(e){for(var t=this.inBase64,n=this.base64Accum,r=this.base64AccumIdx,i=new Buffer(5*e.length+10),o=0,a=0;a<e.length;a++){var s=e.charCodeAt(a);32<=s&&s<=126?(t&&(r>0&&(o+=i.write(n.slice(0,r).toString("base64").replace(/\//g,",").replace(/=+$/,""),o),r=0),i[o++]=p,t=!1),t||(i[o++]=s,s===d&&(i[o++]=p))):(t||(i[o++]=d,t=!0),t&&(n[r++]=s>>8,n[r++]=255&s,r==n.length&&(o+=i.write(n.toString("base64").replace(/\//g,","),o),r=0)))}return this.inBase64=t,this.base64AccumIdx=r,i.slice(0,o)},a.prototype.end=function(){var e=new Buffer(10),t=0;return this.inBase64&&(this.base64AccumIdx>0&&(t+=e.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),t),this.base64AccumIdx=0),e[t++]=p,this.inBase64=!1),e.slice(0,t)};var g=l.slice();g[",".charCodeAt(0)]=!0,s.prototype.write=function(e){for(var t="",n=0,r=this.inBase64,i=this.base64Accum,o=0;o<e.length;o++)if(r){if(!g[e[o]]){if(o==n&&e[o]==p)t+="&";else{var a=i+e.slice(n,o).toString().replace(/,/g,"/");t+=this.iconv.decode(new Buffer(a,"base64"),"utf16-be")}e[o]!=p&&o--,n=o+1,r=!1,i=""}}else e[o]==d&&(t+=this.iconv.decode(e.slice(n,o),"ascii"),n=o+1,r=!0);if(r){var a=i+e.slice(n).toString().replace(/,/g,"/"),s=a.length-a.length%8;i=a.slice(s),a=a.slice(0,s),t+=this.iconv.decode(new Buffer(a,"base64"),"utf16-be")}else t+=this.iconv.decode(e.slice(n),"ascii");return this.inBase64=r,this.base64Accum=i,t},s.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e}},function(e,t){"use strict";function n(e,t){this.encoder=e,this.addBOM=!0}function r(e,t){this.decoder=e,this.pass=!1,this.options=t||{}}var i="\ufeff";t.PrependBOM=n,n.prototype.write=function(e){return this.addBOM&&(e=i+e,this.addBOM=!1),this.encoder.write(e)},n.prototype.end=function(){return this.encoder.end()},t.StripBOM=r,r.prototype.write=function(e){var t=this.decoder.write(e);return this.pass||!t?t:(t[0]===i&&(t=t.slice(1),"function"==typeof this.options.stripBOM&&this.options.stripBOM()),this.pass=!0,t)},r.prototype.end=function(){return this.decoder.end()}},function(e,t,n){"use strict";e.exports=function(e){var t=void 0;e.supportsNodeEncodingsExtension=!(new Buffer(0)instanceof Uint8Array),e.extendNodeEncodings=function(){if(!t){if(t={},!e.supportsNodeEncodingsExtension)return console.error("ACTION NEEDED: require('iconv-lite').extendNodeEncodings() is not supported in your version of Node"),void console.error("See more info at https://github.com/ashtuchkin/iconv-lite/wiki/Node-v4-compatibility");var r={hex:!0,utf8:!0,"utf-8":!0,ascii:!0,binary:!0,base64:!0,ucs2:!0,"ucs-2":!0,utf16le:!0,"utf-16le":!0};Buffer.isNativeEncoding=function(e){return e&&r[e.toLowerCase()]};var i=n(10).SlowBuffer;if(t.SlowBufferToString=i.prototype.toString,i.prototype.toString=function(n,r,i){return n=String(n||"utf8").toLowerCase(),Buffer.isNativeEncoding(n)?t.SlowBufferToString.call(this,n,r,i):("undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=this.length),e.decode(this.slice(r,i),n))},t.SlowBufferWrite=i.prototype.write,i.prototype.write=function(n,r,i,o){if(isFinite(r))isFinite(i)||(o=i,i=void 0);else{var a=o;o=r,r=i,i=a}r=+r||0;var s=this.length-r;if(i?(i=+i,i>s&&(i=s)):i=s,o=String(o||"utf8").toLowerCase(),Buffer.isNativeEncoding(o))return t.SlowBufferWrite.call(this,n,r,i,o);if(n.length>0&&(i<0||r<0))throw new RangeError("attempt to write beyond buffer bounds");var u=e.encode(n,o);return u.length<i&&(i=u.length),u.copy(this,r,0,i),i},t.BufferIsEncoding=Buffer.isEncoding,Buffer.isEncoding=function(t){return Buffer.isNativeEncoding(t)||e.encodingExists(t)},t.BufferByteLength=Buffer.byteLength,Buffer.byteLength=i.byteLength=function(n,r){return r=String(r||"utf8").toLowerCase(),Buffer.isNativeEncoding(r)?t.BufferByteLength.call(this,n,r):e.encode(n,r).length},t.BufferToString=Buffer.prototype.toString,Buffer.prototype.toString=function(n,r,i){return n=String(n||"utf8").toLowerCase(),Buffer.isNativeEncoding(n)?t.BufferToString.call(this,n,r,i):("undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=this.length),e.decode(this.slice(r,i),n))},t.BufferWrite=Buffer.prototype.write,Buffer.prototype.write=function(n,r,i,o){var a=r,s=i,u=o;if(isFinite(r))isFinite(i)||(o=i,i=void 0);else{var c=o;o=r,r=i,i=c}if(o=String(o||"utf8").toLowerCase(),Buffer.isNativeEncoding(o))return t.BufferWrite.call(this,n,a,s,u);r=+r||0;var l=this.length-r;if(i?(i=+i,i>l&&(i=l)):i=l,n.length>0&&(i<0||r<0))throw new RangeError("attempt to write beyond buffer bounds");var h=e.encode(n,o);return h.length<i&&(i=h.length),h.copy(this,r,0,i),i},e.supportsStreams){var o=n(14).Readable;t.ReadableSetEncoding=o.prototype.setEncoding,o.prototype.setEncoding=function(t,n){this._readableState.decoder=e.getDecoder(t,n),this._readableState.encoding=t},o.prototype.collect=e._collect}}},e.undoExtendNodeEncodings=function(){if(e.supportsNodeEncodingsExtension){if(!t)throw new Error("require('iconv-lite').undoExtendNodeEncodings(): Nothing to undo; extendNodeEncodings() is not called.");delete Buffer.isNativeEncoding;var r=n(10).SlowBuffer;if(r.prototype.toString=t.SlowBufferToString,r.prototype.write=t.SlowBufferWrite,Buffer.isEncoding=t.BufferIsEncoding,Buffer.byteLength=t.BufferByteLength,Buffer.prototype.toString=t.BufferToString,Buffer.prototype.write=t.BufferWrite,e.supportsStreams){var i=n(14).Readable;i.prototype.setEncoding=t.ReadableSetEncoding,delete i.prototype.collect}t=void 0}}}},function(e,t,n){"use strict";var r=n(106),i=e.exports;i.encodings=null,i.defaultCharUnicode="",i.defaultCharSingleByte="?",i.encode=function(e,t,n){e=""+(e||"");var r=i.getEncoder(t,n),o=r.write(e),a=r.end();return a&&a.length>0?Buffer.concat([o,a]):o},i.decode=function(e,t,n){"string"==typeof e&&(i.skipDecodeWarning||(console.error("Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding"),i.skipDecodeWarning=!0),e=new Buffer(""+(e||""),"binary"));var r=i.getDecoder(t,n),o=r.write(e),a=r.end();return a?o+a:o},i.encodingExists=function(e){try{return i.getCodec(e),!0}catch(e){return!1}},i.toEncoding=i.encode,i.fromEncoding=i.decode,i._codecDataCache={},i.getCodec=function(e){i.encodings||(i.encodings=n(99));for(var t=(""+e).toLowerCase().replace(/[^0-9a-z]|:\d{4}$/g,""),r={};;){var o=i._codecDataCache[t];if(o)return o;var a=i.encodings[t];switch(typeof a){case"string":t=a;break;case"object":for(var s in a)r[s]=a[s];r.encodingName||(r.encodingName=t),t=a.type;break;case"function":return r.encodingName||(r.encodingName=t),o=new a(r,i),i._codecDataCache[r.encodingName]=o,o;default:throw new Error("Encoding not recognized: '"+e+"' (searched as: '"+t+"')")}}},i.getEncoder=function(e,t){var n=i.getCodec(e),o=new n.encoder(t,n);return n.bomAware&&t&&t.addBOM&&(o=new r.PrependBOM(o,t)),o},i.getDecoder=function(e,t){var n=i.getCodec(e),o=new n.decoder(t,n);return!n.bomAware||t&&t.stripBOM===!1||(o=new r.StripBOM(o,t)),o};var o="undefined"!=typeof process&&process.versions&&process.versions.node;if(o){var a=o.split(".").map(Number);(a[0]>0||a[1]>=10)&&n(109)(i),n(107)(i)}},function(e,t,n){"use strict";function r(e,t){this.conv=e,t=t||{},t.decodeStrings=!1,o.call(this,t)}function i(e,t){this.conv=e,t=t||{},t.encoding=this.encoding="utf8",o.call(this,t)}var o=n(14).Transform;e.exports=function(e){e.encodeStream=function(t,n){return new r(e.getEncoder(t,n),n)},e.decodeStream=function(t,n){return new i(e.getDecoder(t,n),n)},e.supportsStreams=!0,e.IconvLiteEncoderStream=r,e.IconvLiteDecoderStream=i,e._collect=i.prototype.collect},r.prototype=Object.create(o.prototype,{constructor:{value:r}}),r.prototype._transform=function(e,t,n){if("string"!=typeof e)return n(new Error("Iconv encoding stream needs strings as its input."));try{var r=this.conv.write(e);r&&r.length&&this.push(r),n()}catch(e){n(e)}},r.prototype._flush=function(e){try{var t=this.conv.end();t&&t.length&&this.push(t),e()}catch(t){e(t)}},r.prototype.collect=function(e){var t=[];return this.on("error",e),this.on("data",function(e){t.push(e)}),this.on("end",function(){e(null,Buffer.concat(t))}),this},i.prototype=Object.create(o.prototype,{constructor:{value:i}}),i.prototype._transform=function(e,t,n){if(!Buffer.isBuffer(e))return n(new Error("Iconv decoding stream needs buffers as its input."));try{var r=this.conv.write(e);r&&r.length&&this.push(r,this.encoding),n()}catch(e){n(e)}},i.prototype._flush=function(e){try{var t=this.conv.end();t&&t.length&&this.push(t,this.encoding),e()}catch(t){e(t)}},i.prototype.collect=function(e){var t="";return this.on("error",e),this.on("data",function(e){t+=e}),this.on("end",function(){e(null,t)}),this}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=[["8740",""],["8767",""],["87a1",""],["8840","",4,""],["88a1",""],["8940",""],["8943",""],["8946",""],["894c",""],["89a1",""],["89ab",""],["89b0",""],["89b5",""],["89c1",""],["89c5",""],["8a40",""],["8a43",""],["8a64",""],["8a76",""],["8aa1",""],["8aac",""],["8ab2",""],["8abb",""],["8ac9",""],["8ace",""],["8adf",""],["8af6",""],["8b40",""],["8b55",""],["8ba1",""],["8bde",""],["8c40",""],["8ca1",""],["8ca7",""],["8cc9",""],["8cce",""],["8ce6",""],["8d40",""],["8d42",""],["8da1",""],["8e40",""],["8ea1",""],["8f40",""],["8fa1",""],["9040",""],["90a1",""],["9140",""],["91a1",""],["9240",""],["92a1",""],["9340",""],["93a1",""],["9440",""],["94a1",""],["9540",""],["95a1",""],["9640",""],["96a1",""],["9740",""],["97a1",""],["9840",""],["98a1",""],["9940",""],["99a1",""],["9a40",""],["9aa1",""],["9b40",""],["9b62",""],["9ba1",""],["9c40",""],["9ca1",""],["9d40",""],["9da1",""],["9e40",""],["9ea1",""],["9ead",""],["9ec5",""],["9ef5",""],["9f40",""],["9f4f",""],["9fa1",""],["9fae",""],["9fb2",""],["9fc1",""],["9fc9",""],["9fdb",""],["9fe7",""],["9feb",""],["9ff0",""],["a040",""],["a055",""],["a058",""],["a05b",""],["a063",""],["a073",""],["a0a1",""],["a0a6",""],["a0ae",""],["a0b0",""],["a0d4",""],["a0e2",""],["a3c0","",31,""],["c6a1","",9,"",9,"",9,"",23],["c740","",58,""],["c7a1","",81,"",5,"",4],["c840","",26,"",25,""],["c8a1",""],["c8cd",""],["c8f5",""],["f9fe",""],["fa40",""],["faa1",""],["fb40",""],["fba1",""],["fc40",""],["fca1",""],["fd40",""],["fda1",""],["fe40",""],["fea1",""]]},function(e,t){e.exports=[["0","\0",127],["8141","",4,"",6,""],["8161","",9,"",5,""],["8181","",18,"",4,"",6,"",5,"",6,"",7,"",7,"",4,"",4,""],["8241","",7,"",5],["8261","",6,"",5,""],["8281","",7,"",7,"",4,"",10,"",5,"",17,"",7,"",6,"",7,"",18],["8341","",5,"",5,"",7],["8361","",18,""],["8381","",4,"",6,"",5,"",5,"",46,"",6,"",5,"",8],["8441","",5,"",8],["8461","",18],["8481","",7,"",6,"",5,"",10,"",5,"",18,"",5,"",6,"",5,"",26,""],["8541","",5,"",4,"",6,"",4],["8561","",5,"",5,"",6,""],["8581","",6,"",6,"",9,"",26,"",29,"",6,"",5,""],["8641","",6,"",5,""],["8661","",6,"",10],["8681","",22,"",4,"",6,"",5,"",6,"",22,"",4,""],["8741","",9,"",15],["8761","",18,""],["8781","",5,"",7,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",4],["8841","",4,"",5,"",6,"",4],["8861","",4,""],["8881","",15,"",4,"",6,"",5,"",54,""],["8941","",6,"",5,""],["8961","",10,"",5,""],["8981","",21,"",18,"",18,"",6,"",6,"",7,"",15],["8a41","",10,"",6,""],["8a61","",4,"",18,""],["8a81","",4,"",19,"",5,"",7,"",5,"",6,"",5,"",4,"",5,"",26,""],["8b41","",5,"",4,"",6,""],["8b61","",6,"",8],["8b81","",52,"",4,"",6,"",5,"",18,"",18],["8c41","",15,"",4],["8c61","",6,"",5,"",6,"",5],["8c81","",12,"",26,"",50,"",5,"",16],["8d41","",16,"",8],["8d61","",17,""],["8d81","",4,"",33,"",6,"",7,"",6,"",9,"",6,"",5,"",6,""],["8e41","",6,"",5,"",8],["8e61","",4,"",19],["8e81","",13,"",6,"",4,"",6,"",5,"",6,"",5,"",11,"",7,"",6,"",5,"",7],["8f41","",7,"",17],["8f61","",7,"",6,"",4],["8f81","",5,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",5],["9041","",6,"",5,""],["9061","",5,"",15],["9081","",12,"",6,"",5,"",4,"",6,"",4,"",5,"",11,"",33,""],["9141","",6,"",5],["9161","",9,"",5],["9181","",20,"",4,"",5,"",14,"",33,"",7,"",5,"",6],["9241","",7,"",4,""],["9261","",7,"",7,"",4],["9281","",21,"",18,"",6,"",7,"",6,"",35,""],["9341","",4,""],["9361","",6,"",8],["9381","",37,"",4,"",4,"",6,"",5,"",7,"",22,""],["9441","",5,"",5,"",8],["9461","",5,"",6,"",12],["9481","",5,"",6,"",6,"",9,"",22,"",4,"",6,"",10,"",6,"",24],["9541","",11,"",5,""],["9561","",6,"",5,""],["9581","",6,"",35,"",4,"",4,"",4,"",6,"",5,"",13,"",14],["9641","",23,""],["9661","",6,"",5,"",8],["9681","",10,"",5,"",13,"",33,"",6,"",44],["9741","",16,"",8],["9761","",17,"",7],["9781","",11,"",5,"",6,"",89,""],["9841","",16,"",5,""],["9861","",6,"",15],["9881","",21,"",6,"",5,"",4,"",6,"",5,"",6,"",5,"",6,"",5,""],["9941","",6,"",5,""],["9961","",6,"",5,""],["9981","",8,"",5,"",4,"",11,"",5,"",6,"",6,"",6,"",7,"",6,"",5,""],["9a41","",16],["9a61","",6,"",6,""],["9a81","",4,"",6,"",5,"",5,"",6,"",5,"",5,"",33,"",5,"",6,""],["9b41","",6,"",8],["9b61","",17,"",7],["9b81","",25,"",4,"",5,"",50,"",22,""],["9c41","",4,"",5,"",5],["9c61","",8,"",6,"",9],["9c81","",8,"",6,"",6,"",9,"",26,"",6,"",5,"",18,"",6,"",12],["9d41","",13,"",8],["9d61","",25],["9d81","",8,"",5,"",9,"",6,"",10,"",6,"",5,"",6,"",5,""],["9e41","",7,"",9,""],["9e61","",4,"",6,""],["9e81","",6,"",6,"",6,"",5,"",10,"",5,"",6,"",5,"",6,""],["9f41","",5,"",4,"",5,""],["9f61","",6,"",5,""],["9f81","",4,"",5,"",6,"",5,"",6,"",4,"",6,"",7,"",4,"",4,""],["a041","",5,"",6,""],["a061","",5,"",13],["a081","",4,"",4,"",4,"",6,"",5,"",6,"",5,"",26,"",4,"",5,"",7,""],["a141","",18,""],["a161","",6,"",5,""],["a181","",14,"",5,"",4,"",9,""],["a241","",5,"",18],["a261","",6,"",18],["a281","",7,"",6,"",7,""],["a341","",6,"",10,""],["a361","",6,"",16],["a381","",16,"",4,"",58,"",32,""],["a441","",5,""],["a461","",5,"",12],["a481","",28,"",93],["a541","",4,"",6,"",5,""],["a561","",17,"",5,""],["a581","",16,"",14,"",9],["a5b0","",9],["a5c1","",16,"",6],["a5e1","",16,"",6],["a641","",19,""],["a661","",5,"",5,"",6],["a681","",6,"",18,"",7],["a741","",4,"",6,"",7],["a761","",22,""],["a781","",6,"",5,"",7,"",9,"",9,"",4,"",5,"",4,""],["a841","",10,"",14],["a861","",18,"",6],["a881","",19,"",11,""],["a8a6",""],["a8a8",""],["a8b1","",27,"",25,"",14,""],["a941","",14,"",10],["a961","",18],["a981","",14,"",6,"",27,"",25,"",14,""],["aa41","",6,"",4,""],["aa61","",4,"",5,"",6,""],["aa81","",29,"",82],["ab41","",6,"",5,""],["ab61","",6,"",5,"",5],["ab81","",8,"",6,"",12,"",85],["ac41","",5,"",6,""],["ac61","",11,"",4],["ac81","",28,"",5,"",25],["acd1","",5,"",25],["ad41","",6,"",5,"",7],["ad61","",6,"",10,""],["ad81","",5,"",18,""],["ae41","",5,"",16],["ae61","",5,"",6,"",4],["ae81","",6,"",5,""],["af41","",19],["af61","",13,"",5,""],["af81","",5,"",6,"",5,""],["b041","",5,"",5,"",12],["b061","",5,"",19],["b081","",13,"",6,"",5,"",7,"",4,""],["b141","",6,"",5,""],["b161","",6,"",5,"",11],["b181","",14,"",6,""],["b241","",6,"",5,""],["b261","",18,"",5,""],["b281","",5,"",18,"",6,""],["b341","",19,""],["b361","",5,"",5,"",5],["b381","",5,"",5,"",19,"",4,""],["b441","",5,"",6,"",5],["b461","",6,"",10,""],["b481","",6,"",18,"",4,"",4,""],["b541","",14,"",5],["b561","",5,"",5,"",4],["b581","",6,"",5,"",11,""],["b641","",7,"",17],["b661","",15,""],["b681","",5,"",6,"",5,""],["b741","",13,"",6,""],["b761","",20,""],["b781","",6,"",14,""],["b841","",7,"",17],["b861","",8,"",13],["b881","",5,"",24,"",4,""],["b941","",6,"",5,""],["b961","",14,"",6,""],["b981","",22,"",4,"",4,""],["ba41","",5,"",6,""],["ba61","",5,"",4,"",5],["ba81","",6,"",9,""],["bb41","",4,"",5,"",4,""],["bb61","",6,"",5,""],["bb81","",31,""],["bc41","",17,""],["bc61","",5,"",6,""],["bc81","",4,"",6,"",5,"",5,"",4,""],["bd41","",7,"",7,""],["bd61","",5,"",13],["bd81","",5,"",25,""],["be41","",7,"",14],["be61","",7,"",7,""],["be81","",4,"",4,"",5,"",8,"",6,""],["bf41","",10,"",14],["bf61","",18,""],["bf81","",5,"",7,"",6,"",5,""],["c041","",5,"",6,"",5],["c061","",25],["c081","",6,"",5,"",7,""],["c141","",5,"",6,""],["c161","",19,""],["c181","",31,""],["c241","",4,"",5,""],["c261","",4,"",5,"",6,""],["c281","",5,"",7,"",9,""],["c341","",4],["c361","",4,"",5,"",11],["c381","",5,"",7,"",5,""],["c441","",7,"",7,""],["c461","",5,"",4],["c481","",5,"",11,""],["c541","",6,"",5,""],["c561","",6,"",5,"",4],["c581","",6,"",5,""],["c641","",6,"",5],["c6a1",""],["c7a1",""],["c8a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1","",5,"",4,""],["d2a1","",4,"",5,"",10,"",7,"",5,""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f5a1",""],["f6a1",""],["f7a1",""],["f8a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fda1",""]];
},function(e,t){e.exports=[["0","\0",127],["8ea1","",62],["a1a1","",9,""],["a2a1",""],["a2ba",""],["a2ca",""],["a2dc",""],["a2f2",""],["a2fe",""],["a3b0","",9],["a3c1","",25],["a3e1","",25],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a7a1","",5,"",25],["a7d1","",5,"",25],["a8a1",""],["ada1","",19,"",9],["adc0",""],["addf","",4,""],["b0a1",""],["b1a1",""],["b2a1",""],["b3a1",""],["b4a1",""],["b5a1",""],["b6a1",""],["b7a1",""],["b8a1",""],["b9a1",""],["baa1",""],["bba1",""],["bca1",""],["bda1",""],["bea1",""],["bfa1",""],["c0a1",""],["c1a1",""],["c2a1",""],["c3a1",""],["c4a1",""],["c5a1",""],["c6a1",""],["c7a1",""],["c8a1",""],["c9a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1",""],["d2a1",""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fcf1","",9,""],["8fa2af",""],["8fa2c2",""],["8fa2eb",""],["8fa6e1",""],["8fa6e7",""],["8fa6e9",""],["8fa6ec",""],["8fa6f1",""],["8fa7c2","",10,""],["8fa7f2","",10,""],["8fa9a1",""],["8fa9a4",""],["8fa9a6",""],["8fa9a8",""],["8fa9ab",""],["8fa9af",""],["8fa9c1",""],["8faaa1",""],["8faaba",""],["8faba1",""],["8fabbd",""],["8fabc5",""],["8fb0a1",""],["8fb1a1",""],["8fb2a1","",4,""],["8fb3a1",""],["8fb4a1",""],["8fb5a1",""],["8fb6a1","",5,"",4,""],["8fb7a1","",4,""],["8fb8a1",""],["8fb9a1",""],["8fbaa1","",4,""],["8fbba1",""],["8fbca1","",4,""],["8fbda1","",4,""],["8fbea1","",4,""],["8fbfa1",""],["8fc0a1",""],["8fc1a1",""],["8fc2a1",""],["8fc3a1","",4,""],["8fc4a1",""],["8fc5a1",""],["8fc6a1",""],["8fc7a1",""],["8fc8a1",""],["8fc9a1","",4,"",4,""],["8fcaa1",""],["8fcba1",""],["8fcca1","",9,""],["8fcda1","",5,""],["8fcea1","",6,""],["8fcfa1",""],["8fd0a1",""],["8fd1a1",""],["8fd2a1","",5],["8fd3a1",""],["8fd4a1","",4,""],["8fd5a1",""],["8fd6a1",""],["8fd7a1",""],["8fd8a1",""],["8fd9a1","",4,"",6,""],["8fdaa1","",4,""],["8fdba1","",6,""],["8fdca1","",4,""],["8fdda1","",4,""],["8fdea1","",4,""],["8fdfa1",""],["8fe0a1",""],["8fe1a1","",4,""],["8fe2a1",""],["8fe3a1","",5,"",4,""],["8fe4a1","",4,""],["8fe5a1","",4,""],["8fe6a1",""],["8fe7a1",""],["8fe8a1","",4,""],["8fe9a1","",4],["8feaa1","",4,""],["8feba1","",4,""],["8feca1",""],["8feda1","",4,"",4,""]]},function(e,t){e.exports={uChars:[128,165,169,178,184,216,226,235,238,244,248,251,253,258,276,284,300,325,329,334,364,463,465,467,469,471,473,475,477,506,594,610,712,716,730,930,938,962,970,1026,1104,1106,8209,8215,8218,8222,8231,8241,8244,8246,8252,8365,8452,8454,8458,8471,8482,8556,8570,8596,8602,8713,8720,8722,8726,8731,8737,8740,8742,8748,8751,8760,8766,8777,8781,8787,8802,8808,8816,8854,8858,8870,8896,8979,9322,9372,9548,9588,9616,9622,9634,9652,9662,9672,9676,9680,9702,9735,9738,9793,9795,11906,11909,11913,11917,11928,11944,11947,11951,11956,11960,11964,11979,12284,12292,12312,12319,12330,12351,12436,12447,12535,12543,12586,12842,12850,12964,13200,13215,13218,13253,13263,13267,13270,13384,13428,13727,13839,13851,14617,14703,14801,14816,14964,15183,15471,15585,16471,16736,17208,17325,17330,17374,17623,17997,18018,18212,18218,18301,18318,18760,18811,18814,18820,18823,18844,18848,18872,19576,19620,19738,19887,40870,59244,59336,59367,59413,59417,59423,59431,59437,59443,59452,59460,59478,59493,63789,63866,63894,63976,63986,64016,64018,64021,64025,64034,64037,64042,65074,65093,65107,65112,65127,65132,65375,65510,65536],gbChars:[0,36,38,45,50,81,89,95,96,100,103,104,105,109,126,133,148,172,175,179,208,306,307,308,309,310,311,312,313,341,428,443,544,545,558,741,742,749,750,805,819,820,7922,7924,7925,7927,7934,7943,7944,7945,7950,8062,8148,8149,8152,8164,8174,8236,8240,8262,8264,8374,8380,8381,8384,8388,8390,8392,8393,8394,8396,8401,8406,8416,8419,8424,8437,8439,8445,8482,8485,8496,8521,8603,8936,8946,9046,9050,9063,9066,9076,9092,9100,9108,9111,9113,9131,9162,9164,9218,9219,11329,11331,11334,11336,11346,11361,11363,11366,11370,11372,11375,11389,11682,11686,11687,11692,11694,11714,11716,11723,11725,11730,11736,11982,11989,12102,12336,12348,12350,12384,12393,12395,12397,12510,12553,12851,12962,12973,13738,13823,13919,13933,14080,14298,14585,14698,15583,15847,16318,16434,16438,16481,16729,17102,17122,17315,17320,17402,17418,17859,17909,17911,17915,17916,17936,17939,17961,18664,18703,18814,18962,19043,33469,33470,33471,33484,33485,33490,33497,33501,33505,33513,33520,33536,33550,37845,37921,37948,38029,38038,38064,38065,38066,38069,38075,38076,38078,39108,39109,39113,39114,39115,39116,39265,39394,189e3]}},function(e,t){e.exports=[["0","\0",128],["a1","",62],["8140","",9,""],["8180",""],["81b8",""],["81c8",""],["81da",""],["81f0",""],["81fc",""],["824f","",9],["8260","",25],["8281","",25],["829f","",82],["8340","",62],["8380","",22],["839f","",16,"",6],["83bf","",16,"",6],["8440","",5,"",25],["8470","",5,"",7],["8480","",17],["849f",""],["8740","",19,"",9],["875f",""],["877e",""],["8780","",4,""],["889f",""],["8940",""],["8980",""],["8a40",""],["8a80",""],["8b40",""],["8b80",""],["8c40",""],["8c80",""],["8d40",""],["8d80",""],["8e40",""],["8e80",""],["8f40",""],["8f80",""],["9040",""],["9080",""],["9140",""],["9180",""],["9240",""],["9280",""],["9340",""],["9380",""],["9440",""],["9480",""],["9540",""],["9580",""],["9640",""],["9680",""],["9740",""],["9780",""],["9840",""],["989f",""],["9940",""],["9980",""],["9a40",""],["9a80",""],["9b40",""],["9b80",""],["9c40",""],["9c80",""],["9d40",""],["9d80",""],["9e40",""],["9e80",""],["9f40",""],["9f80",""],["e040",""],["e080",""],["e140",""],["e180",""],["e240",""],["e280",""],["e340",""],["e380",""],["e440",""],["e480",""],["e540",""],["e580",""],["e640",""],["e680",""],["e740",""],["e780",""],["e840",""],["e880",""],["e940",""],["e980",""],["ea40",""],["ea80",""],["ed40",""],["ed80",""],["ee40",""],["ee80",""],["eeef","",9,""],["f040","",62],["f080","",124],["f140","",62],["f180","",124],["f240","",62],["f280","",124],["f340","",62],["f380","",124],["f440","",62],["f480","",124],["f540","",62],["f580","",124],["f640","",62],["f680","",124],["f740","",62],["f780","",124],["f840","",62],["f880","",124],["f940",""],["fa40","",9,"",9,""],["fa80",""],["fb40",""],["fb80",""],["fc40",""]]},function(e,t){e.exports={_args:[[{raw:"tds",scope:null,escapedName:"tds",name:"tds",rawSpec:"",spec:"latest",type:"tag"},"C:\\Users\\nanderson\\projects\\SolidworksLicData"]],_defaultsLoaded:!0,_engineSupported:!0,_from:"tds@latest",_id:"tds@0.1.0",_inCache:!0,_installable:!0,_location:"/tds",_nodeVersion:"v0.6.4",_npmUser:{name:"cretz",email:"chad.retz@gmail.com"},_npmVersion:"1.1.0-alpha-6",_phantomChildren:{},_requested:{raw:"tds",scope:null,escapedName:"tds",name:"tds",rawSpec:"",spec:"latest",type:"tag"},_requiredBy:["#DEV:/","#USER"],_resolved:"http://registry.npmjs.org/tds/-/tds-0.1.0.tgz",_shasum:"4f4238b94a7a46ed9517e6f4df2d574d99abf476",_shrinkwrap:null,_spec:"tds",_where:"C:\\Users\\nanderson\\projects\\SolidworksLicData",author:{name:"Chad Retz",email:"chad.retz@gmail.com"},bugs:{url:"https://github.com/cretz/node-tds/issues"},dependencies:{},description:"TDS client for connecting to Microsoft SQL Server",devDependencies:{mocha:">=0.8.0"},directories:{},dist:{shasum:"4f4238b94a7a46ed9517e6f4df2d574d99abf476",tarball:"https://registry.npmjs.org/tds/-/tds-0.1.0.tgz"},engines:{node:">=0.6.0"},homepage:"http://cretz.github.com/node-tds",keywords:["tds","sql","mssql","database","node-tds"],licenses:[{type:"MIT",url:"http://github.com/cretz/node-tds/raw/master/LICENSE"}],main:"./lib/tds",maintainers:[{name:"cretz",email:"chad.retz@gmail.com"}],name:"tds",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git://github.com/cretz/node-tds.git"},version:"0.1.0"}},function(e,t,n){e.exports=n(23)},function(e,t,n){function r(e){return n(i(e))}function i(e){return o[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var o={"./cli":49,"./cli.js":49,"./connectionstring":32,"./connectionstring.js":32,"./datatypes":3,"./datatypes.js":3,"./isolationlevel":11,"./isolationlevel.js":11,"./main":23,"./main.js":23,"./msnodesql":50,"./msnodesql.js":50,"./msnodesqlv8":51,"./msnodesqlv8.js":51,"./table":24,"./table.js":24,"./tds":52,"./tds-fix":33,"./tds-fix.js":33,"./tds.js":52,"./tedious":53,"./tedious.js":53,"./udt":17,"./udt.js":17};r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=119},function(e,t,n){"use strict";function r(e){return this instanceof r?void i.call(this,e):new r(e)}e.exports=r;var i=n(55),o=n(15);o.inherits=n(16),o.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";function r(){this.head=null,this.tail=null,this.length=0}var i=(n(10).Buffer,n(29));e.exports=r,r.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},r.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},r.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},r.prototype.clear=function(){this.head=this.tail=null,this.length=0},r.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},r.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,r=0;n;)n.data.copy(t,r),r+=n.data.length,n=n.next;return t}},function(e,t,n){var r,i=Object.prototype.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(13).Packet,t.AttentionPacket=function(e){function t(){this.type=6,this.name="ATTENTION"}return o(t,e),t.type=6,t.name="ATTENTION",t.prototype.toBuffer=function(e,t){return this.insertPacketHeader(e,t)},t}(r)},function(e,t){t.BufferBuilder=function(){function e(){this._values=[],this.length=0}return e.getUcs2StringLength=function(e){return 2*e.length},e.prototype.appendBuffer=function(e){return this.length+=e.length,this._values.push({type:"buffer",value:e}),this},e.prototype.appendByte=function(e){return this.length++,this._values.push({type:"byte",value:e}),this},e.prototype.appendBytes=function(e){return this.length+=e.length,this._values.push({type:"byte array",value:e}),this},e.prototype.appendInt32LE=function(e){return this.length+=4,this._values.push({type:"int32LE",value:e}),this},e.prototype.appendString=function(e,t){var n;return n=Buffer.byteLength(e,t),this.length+=n,this._values.push({type:"string",encoding:t,value:e,length:n}),this},e.prototype.appendUcs2String=function(e){return this.appendString(e,"ucs2")},e.prototype.appendAsciiString=function(e){return this.appendString(e,"ascii")},e.prototype.appendUInt16LE=function(e){return this.length+=2,this._values.push({type:"uint16LE",value:e}),this},e.prototype.appendUInt32LE=function(e){return this.length+=4,this._values.push({type:"uint32LE",value:e}),this},e.prototype.insertByte=function(e,t){return this.length++,this._values.splice(t,0,{type:"byte",value:e}),this},e.prototype.insertUInt16BE=function(e,t){return this.length+=2,this._values.splice(t,0,{type:"uint16BE",value:e}),this},e.prototype.insertUInt16LE=function(e,t){return this.length+=2,this._values.splice(t,0,{type:"uint16LE",value:e}),this},e.prototype.insertUInt32LE=function(e,t){return this.length+=4,
this._values.splice(t,0,{type:"uint32LE",value:e}),this},e.prototype.toBuffer=function(){var e,t,n,r,i,o,a,s,u,c;for(e=new Buffer(this.length),n=0,u=this._values,i=0,a=u.length;i<a;i++)switch(r=u[i],r.type){case"buffer":r.value.copy(e,n),n+=r.value.length;break;case"byte":e.set(n,r.value),n++;break;case"byte array":for(c=r.value,o=0,s=c.length;o<s;o++)t=c[o],e.set(n,t),n++;break;case"int32LE":e.writeInt32LE(r.value,n),n+=4;break;case"string":e.write(r.value,n,r.length,r.encoding),n+=r.length;break;case"uint16BE":e.writeUInt16BE(r.value,n),n+=2;break;case"uint16LE":e.writeUInt16LE(r.value,n),n+=2;break;case"uint32LE":e.writeUInt32LE(r.value,n),n+=4;break;default:throw new Error("Unrecognized type: "+r.type)}return e},e}()},function(e,t){var n=Object.prototype.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t.BufferStream=function(){function e(){this._offset=0}return e.prototype.append=function(e){var t;return null==this._buffer?this._buffer=e:(t=new Buffer(this._buffer.length+e.length),this._buffer.copy(t),e.copy(t,this._buffer.length),this._buffer=t)},e.prototype.getBuffer=function(){return this._buffer},e.prototype.beginTransaction=function(){return this._offsetStart=this._offset},e.prototype.commitTransaction=function(){return this._offsetStart=null,this._buffer=this._buffer.slice(this._offset),this._offset=0},e.prototype.rollbackTransaction=function(){return this._offset=this._offsetStart,this._offsetStart=null},e.prototype.assertBytesAvailable=function(t){if(t+this._offset>this._buffer.length)throw console.log("Need %d, length %d",t+this._offset,this._buffer.length),new e.StreamIndexOutOfBoundsError("Index out of bounds")},e.prototype.currentOffset=function(){return this._offset-this._offsetStart},e.prototype.overrideOffset=function(e){return this._offset=this._offsetStart+e},e.prototype.peekByte=function(){return this.assertBytesAvailable(1),this._buffer.get(this._offset)},e.prototype.readBuffer=function(e){var t;return this.assertBytesAvailable(e),t=this._buffer.slice(this._offset,this._offset+e),this._offset+=e,t},e.prototype.readByte=function(){var e;return this.assertBytesAvailable(1),e=this._buffer.get(this._offset),this._offset++,e},e.prototype.readBytes=function(e){var t,n,r;for(this.assertBytesAvailable(e),n=[],t=0,r=e-1;0<=r?t<=r:t>=r;0<=r?t++:t--)n.push(this._buffer.get(this._offset)),this._offset++;return n},e.prototype.readInt32LE=function(){var e;return this.assertBytesAvailable(4),e=this._buffer.readInt32LE(this._offset),this._offset+=4,e},e.prototype.readString=function(e,t){var n;return this.assertBytesAvailable(e),n=this._buffer.toString(t,this._offset,this._offset+e),this._offset+=e,n},e.prototype.readStringFromIndex=function(t,n,r){if(t+this._offsetStart>=this._buffer.length)throw new e.StreamIndexOutOfBoundsError("Index out of bounds");return this._buffer.toString(r,t+this._offsetStart,t+this._offsetStart+n)},e.prototype.readUcs2String=function(e){return this.readString(2*e,"ucs2")},e.prototype.readAsciiString=function(e){return this.readString(e,"ascii")},e.prototype.readUcs2StringFromIndex=function(e,t){return this.readStringFromIndex(e,2*t,"ucs2")},e.prototype.readUInt16BE=function(){var e;return this.assertBytesAvailable(2),e=this._buffer.readUInt16BE(this._offset),this._offset+=2,e},e.prototype.readUInt16LE=function(){var e;return this.assertBytesAvailable(2),e=this._buffer.readUInt16LE(this._offset),this._offset+=2,e},e.prototype.readUInt32LE=function(){var e;return this.assertBytesAvailable(4),e=this._buffer.readUInt32LE(this._offset),this._offset+=4,e},e.prototype.skip=function(e){return this.assertBytesAvailable(e),this._offset+=e},e.StreamIndexOutOfBoundsError=t.StreamIndexOutOfBoundsError=function(e){function t(e){this.message=e,this.stack=(new Error).stack}return r(t,e),t.prototype.name="StreamIndexOutOfBoundsError",t}(Error),e}()},function(e,t,n){var r,i,o=Object.prototype.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)o.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(8).TdsConstants,i=n(9).Token,t.EnvChangeToken=function(e){function t(){this.type=227,this.name="ENVCHANGE",this.handlerFunction="envchange"}return a(t,e),t.type=227,t.name="ENVCHANGE",t.prototype._readValue=function(e,t,n){if(null==e)return t.skip(1),null;if("2byteskip"===e)return t.skip(2),null;switch(e){case"string":return t.readUcs2String(t.readByte());case"bytes":return t.readBuffer(t.readByte());case"byte":return t.readByte();case"longbytes":return t.readBuffer(t.readUInt32LE());case"shortbytes":return t.readBuffer(t.readUInt16LE());default:throw new Error("Unrecognized typedef: "+e)}},t.prototype.fromBuffer=function(e,t){var n;if(this.length=e.readUInt16LE(),this.changeType=e.readByte(),e.assertBytesAvailable(this.length),n=r.envChangeTypesByNumber[this.changeType],null==n)throw new Error("Unrecognized envchange type: "+this.changeType);return this.newValue=this._readValue(n.newValue,e,t),this.oldValue=this._readValue(n.oldValue,e,t)},t}(i)},function(e,t,n){var r,i=Object.prototype.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(62).MessageToken,t.ErrorMessageToken=function(e){function t(){this.type=170,this.name="ERROR",this.error=!0,this.handlerFunction="message"}return o(t,e),t.type=170,t.name="ERROR",t}(r)},function(e,t,n){var r,i=Object.prototype.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(62).MessageToken,t.InfoMessageToken=function(e){function t(){this.type=171,this.name="INFO",this.error=!1,this.handlerFunction="message"}return o(t,e),t.type=171,t.name="INFO",t}(r)},function(e,t,n){var r,i,o=Object.prototype.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)o.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(13).Packet,i=n(8).TdsConstants,t.Login7Packet=function(e){function t(){this.type=16,this.name="LOGIN7"}return a(t,e),t.type=16,t.name="LOGIN7",t.prototype.fromBuffer=function(e,t){var n,r,i,o,a,s,u;i=e.readUInt32LE(),e.assertBytesAvailable(i-4),this.tdsVersion=e.readUInt32LE(),this.packetSize=e.readUInt32LE(),this.clientProgramVersion=e.readUInt32LE(),this.clientProcessId=e.readUInt32LE(),this.connectionId=e.readUInt32LE(),this.optionFlags1=e.readByte(),this.optionFlags2=e.readByte(),this.typeFlags=e.readByte(),this.optionFlags3=e.readByte(),this.clientTimeZone=e.readUInt32LE(),this.clientLcid=e.readUInt32LE(),o={},n=function(t){return o[t]={pos:e.readUInt16LE(),length:e.readUInt16LE()}},n("hostName"),n("userName"),n(".password"),n("appName"),n("serverName"),n("unused"),n("interfaceLibraryName"),n("language"),n("database"),this.clientId=e.readBytes(6),n(".ntlm"),e.skip(4),u=[];for(r in o)s=o[r],t.logDebug&&console.log("Reading %s at %d of length %d",r,s.pos,s.length),a=e.readUcs2String(s.length),t.logDebug&&console.log("Read %s: %s",r,a),r.charAt(!0)?u.push(this[r]=a):u.push(void 0);return u},t.prototype.toBuffer=function(e,t){var r,o,a,s,u,c,l,h,f,p,d,g,m,v;if(null==this.userName||0===this.userName.length)throw new Error("userName not specified");if(null!=this.domain&&this.domain.length>0)throw new Error("NTLM not yet supported");return null==this.hostName&&(this.hostName=n(74).hostname()),null==this.password&&(this.password=""),null==this.appName&&(this.appName="node-tds"),null==this.serverName&&(this.serverName=""),null==this.interfaceLibraryName&&(this.interfaceLibraryName="node-tds"),null==this.language&&(this.language=""),null==this.database&&(this.database=""),o=86+2*(this.hostName.length+this.userName.length+this.password.length+this.appName.length+this.serverName.length+this.interfaceLibraryName.length+this.language.length+this.database.length),e.appendUInt32LE(o),e.appendUInt32LE(null!=(a=this.tdsVersion)?a:i.versionsByVersion["7.1.1"]),e.appendUInt32LE(null!=(l=this.packetSize)?l:0),e.appendUInt32LE(null!=(h=this.clientProgramVersion)?h:7),e.appendUInt32LE(null!=(f=this.clientProcessId)?f:process.pid),e.appendUInt32LE(null!=(p=this.connectionId)?p:0),e.appendByte(null!=(d=this.optionFlags1)?d:0),e.appendByte(null!=(g=this.optionFlags2)?g:3),e.appendByte(null!=(m=this.typeFlags)?m:0),e.appendByte(null!=(v=this.optionFlags3)?v:0),e.appendUInt32LE(null!=(s=this.clientTimeZone)?s:0),e.appendUInt32LE(null!=(u=this.clientLcid)?u:0),r=86,e.appendUInt16LE(r),e.appendUInt16LE(this.hostName.length),r+=2*this.hostName.length,e.appendUInt16LE(r),e.appendUInt16LE(this.userName.length),r+=2*this.userName.length,e.appendUInt16LE(r),e.appendUInt16LE(this.password.length),r+=2*this.password.length,e.appendUInt16LE(r),e.appendUInt16LE(this.appName.length),r+=2*this.appName.length,e.appendUInt16LE(r),e.appendUInt16LE(this.serverName.length),r+=2*this.serverName.length,e.appendUInt16LE(r),e.appendUInt16LE(0),e.appendUInt16LE(r),e.appendUInt16LE(this.interfaceLibraryName.length),r+=2*this.interfaceLibraryName.length,e.appendUInt16LE(r),e.appendUInt16LE(this.language.length),r+=2*this.language.length,e.appendUInt16LE(r),e.appendUInt16LE(this.database.length),r+=2*this.database.length,e.appendBytes(null!=(c=this.clientId)?c:[0,0,0,0,0,0]),e.appendUInt16LE(r),e.appendUInt16LE(0),e.appendUInt32LE(o),e.appendUcs2String(this.hostName),e.appendUcs2String(this.userName),e.appendBuffer(this._encryptPass()),e.appendUcs2String(this.appName),e.appendUcs2String(this.serverName),e.appendUcs2String(this.interfaceLibraryName),e.appendUcs2String(this.language),e.appendUcs2String(this.database),this.insertPacketHeader(e,t)},t.prototype._encryptPass=function(){var e,t,n;for(t=new Buffer(this.password,"ucs2"),e=0,n=t.length-1;0<=n?e<=n:e>=n;0<=n?e++:e--)t[e]=165^((15&t[e])<<4|t[e]>>4);return t},t}(r)},function(e,t,n){var r,i=Object.prototype.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(13).Packet,t.PreLoginPacket=function(e){function t(){this.type=18,this.name="PRELOGIN"}return o(t,e),t.type=18,t.name="PRELOGIN",t.prototype.fromBuffer=function(e,t){var n,r,i,o,a,s;for(r=[];255!==e.readByte();)e.overrideOffset(e.currentOffset()-1),r.push({type:e.readUInt16LE(),offset:e.readUInt16LE(),length:e.readByte()}),t.logDebug&&(i=r[r.length-1],console.log("Added pending value type: %d, offset: %d, length: %d",i.type,i.offset,i.length));for(s=[],o=0,a=r.length;o<a;o++)switch(n=r[o],n.type){case 0:this.version=e.readBytes(6),t.logDebug?s.push(console.log("Version: ",this.version)):s.push(void 0);break;case 1:this.encryption=e.readByte(),t.logDebug?s.push(console.log("Encryption: ",this.encryption)):s.push(void 0);break;case 2:t.logDebug&&console.log("Reading instance name of length: %d",n.length),this.instanceName=e.readAsciiString(n.length-1),e.skip(1),t.logDebug?s.push(console.log("Instance name: ",this.instanceName)):s.push(void 0);break;case 3:t.logDebug?s.push(console.log("Ignoring thread ID: ")):s.push(void 0);break;default:s.push(e.skip(n.length))}return s},t.prototype.toBuffer=function(e,t){if(null==this.version&&(this.version=[8,0,1,85,0,0]),6!==this.version.length)throw new Error("Invalid version length");return e.appendUInt16LE(0),e.appendUInt16LE(21),e.appendByte(6),null==this.encryption&&(this.encryption=2),e.appendUInt16LE(1),e.appendUInt16LE(27),e.appendByte(1),null==this.instanceName&&(this.instanceName=""),e.appendUInt16LE(2),e.appendUInt16LE(28),e.appendByte(this.instanceName.length+1),null==this.threadId&&(this.threadId=process.pid),e.appendUInt16LE(3),e.appendUInt16LE(this.instanceName.length+29),e.appendByte(4),e.appendByte(255),e.appendBytes(this.version),e.appendByte(this.encryption),e.appendAsciiString(this.instanceName).appendByte(0),e.appendUInt32LE(this.threadId),this.insertPacketHeader(e,t)},t}(r)},function(e,t,n){var r,i=Object.prototype.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(9).Token,t.ReturnStatusToken=function(e){function t(){this.type=121,this.name="RETURNSTATUS",this.handlerFunction="returnstatus"}return o(t,e),t.type=121,t.name="RETURNSTATUS",t.prototype.fromBuffer=function(e,t){return this.value=e.readInt32LE()},t}(r)},function(e,t,n){var r,i,o=Object.prototype.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)o.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(63).TdsUtils,i=n(9).Token,t.RowToken=function(e){function t(){this.type=209,this.name="ROW",this.handlerFunction="row"}return a(t,e),t.type=209,t.name="ROW",t.prototype.fromBuffer=function(e,t){var n,r,i,o,a,s;for(this.metadata=t.colmetadata,this.values=new Array(this.metadata.columns.length),a=this.metadata.columns,s=[],r=0,o=a.length;r<o;r++){switch(n=a[r],i={},n.lengthType){case"int32LE":i.length=e.readInt32LE();break;case"uint16LE":i.length=e.readUInt16LE();break;case"uint8":i.length=e.readByte();break;default:i.length=n.length}65535===i.length&&(i.length=-1),0===i.length&&n.type.emptyPossible?i.buffer=new Buffer(0):i.length>0&&(i.buffer=e.readBuffer(i.length)),s.push(this.values[r]=i)}return s},t.prototype.isNull=function(e){var t;if(t=this.metadata.getColumn(e),null==t)throw new Error("Column "+e+" not found");return t.type.emptyPossible?this.values[t.index].length===-1:0===this.values[t.index]},t.prototype.getValueLength=function(e){var t;if(t=this.metadata.getColumn(e),null==t)throw new Error("Column "+e+" not found");return this.values[t.index].length},t.prototype.getValue=function(e){var t,n;if(t=this.metadata.getColumn(e),null==t)throw new Error("Column "+e+" not found");switch(n=this.values[t.index],t.type.sqlType){case"Null":return null;case"Bit":case"TinyInt":return 0===n.length?null:n.buffer.readInt8(0);case"SmallInt":return 0===n.length?null:n.buffer.readInt16LE(0);case"Int":return 0===n.length?null:n.buffer.readInt32LE(0);case"BigInt":return 0===n.length?null:r.bigIntBufferToString(n.buffer);case"Char":case"VarChar":return n.length===-1?null:n.buffer.toString("ascii",0,n.length);case"NChar":case"NVarChar":return n.length===-1?null:n.buffer.toString("ucs2",0,2*n.length);case"Binary":case"VarBinary":return t.length===-1?null:n.buffer;case"Real":return 0===n.length?null:n.buffer.readFloatLE(0);case"Float":return 0===n.length?null:n.buffer.readDoubleLE(0);case"UniqueIdentifier":return 0===n.length?null:n.buffer;case"SmallDateTime":return 0===n.length?null:this._readSmallDateTime(n.buffer);case"DateTime":return 0===n.length?null:this._readDateTime(n.buffer);case"Date":return 0===n.length?null:this._readDate(n.buffer);default:throw new Error("Unrecognized type "+t.type.name)}},t.prototype.getBuffer=function(e){var t;if(t=this.metadata.getColumn(e),null==t)throw new Error("Column "+e+" not found");return this.values[t.index].buffer},t.prototype.toObject=function(){var e,t,n,r,i;for(t={},i=this.metadata.columns,n=0,r=i.length;n<r;n++)e=i[n],t[e.name]=getValue(e.index);return t},t.prototype._readSmallDateTime=function(e){var t;return t=new Date(1900,0,1),t.setDate(t.getDate()+e.readUInt16LE(0)),t.setMinutes(t.getMinutes()+e.readUInt16LE(2)),t},t.prototype._readDateTime=function(e){var t;return t=new Date(1900,0,1),t.setDate(t.getDate()+e.readInt32LE(0)),t.setMilliseconds(t.getMilliseconds()+e.readInt32LE(4)*(10/3)),t},t.prototype._readDate=function(e){throw new Error("Not implemented")},t}(i)},function(e,t,n){var r,i=Object.prototype.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(13).Packet,t.SqlBatchPacket=function(e){function t(){this.type=1,this.name="SQLBatch"}return o(t,e),t.type=1,t.name="SQLBatch",t.prototype.toBuffer=function(e,t){var n;return null==this.sqlText&&(this.sqlText=""),e.appendUcs2String(this.sqlText),n=this.buildTransactionDescriptorAllHeader(0,1),this.insertAllHeaders(e,t,[n]),this.insertPacketHeader(e,t),e},t}(r)},function(e,t,n){var r,i,o,a,s,u,c,l,h,f,p,d,g,m,v,y=function(e,t){return function(){return e.apply(t,arguments)}};f=n(73).Socket,r=n(122).AttentionPacket,i=n(123).BufferBuilder,v=n(124),o=v.BufferStream,d=v.StreamIndexOutOfBoundsError,a=n(59).ColMetaDataToken,s=n(60).DoneToken,u=n(128).Login7Packet,c=n(61).LoginAckToken,l=n(13).Packet,h=n(129).PreLoginPacket,p=n(132).SqlBatchPacket,g=n(8).TdsConstants,m=n(134).TokenStreamPacket,t.TdsClient=function(){function e(e){if(this._handler=e,this._socketClose=y(this._socketClose,this),this._socketEnd=y(this._socketEnd,this),this._socketData=y(this._socketData,this),this._socketError=y(this._socketError,this),this._socketConnect=y(this._socketConnect,this),null==this._handler)throw new Error("Handler required");this.logDebug=this.logError=!1,this.state=g.statesByName.INITIAL}return e.prototype.connect=function(e){var t,n,r;if(this.state!==g.statesByName.INITIAL)throw new Error("Client must be in INITIAL state before connecting");this.state=g.statesByName.CONNECTING,this.logDebug&&console.log("Connecting to SQL Server with config %j",e);try{return this._preLoginConfig=e,this._socket=new f,this._socket.on("connect",this._socketConnect),this._socket.on("error",this._socketError),this._socket.on("data",this._socketData),this._socket.on("end",this._socketEnd),this._socket.on("close",this._socketClose),this._socket.connect(null!=(t=e.port)?t:1433,null!=(n=e.host)?n:"localhost")}catch(e){return this.logError&&console.error("Error connecting: "+e),this.state=g.statesByName.INITIAL,null!=(r=this._handler)&&"function"==typeof r.error&&r.error(e),this.end()}},e.prototype.login=function(e){var t,n,r,i,o;if(this.state!==g.statesByName.CONNECTED)throw new Error("Client must be in CONNECTED state before logging in");this.state=g.statesByName["LOGGING IN"],this.logDebug&&console.log("Logging in with config %j",e);try{n=new u;for(t in e)r=e[t],n[t]=r;return this.tdsVersion=null!=(o=e.tdsVersion)?o:g.versionsByVersion["7.1.1"],this._sendPacket(n)}catch(e){return this.logError&&console.error("Error on login: ",e),this.state=g.statesByName.CONNECTED,"function"==typeof(i=this._handler).error?i.error(e):void 0}},e.prototype.sqlBatch=function(e){var t,n;if(this.state!==g.statesByName["LOGGED IN"])throw new Error("Client must be in LOGGED IN state before executing sql");this.logDebug&&console.log("Executing SQL Batch: %s",e);try{return t=new p,t.sqlText=e,this._sendPacket(t)}catch(e){return this.logError&&console.error("Error executing: ",e.stack),null!=(n=this._handler)&&"function"==typeof n.error?n.error(e):void 0}},e.prototype.cancel=function(){var e;if(this.state!==g.statesByName["LOGGED IN"])throw new Error("Client must be in LOGGED IN state before cancelling");this.logDebug&&console.log("Cancelling");try{return this.cancelling=!0,this._sendPacket(new r)}catch(t){return this.cancelling=void 0,this.logError&&console.error("Error cancelling: ",t.stack),null!=(e=this._handler)&&"function"==typeof e.error?e.error(t):void 0}},e.prototype._socketConnect=function(){var e,t,n,r,i;this.logDebug&&console.log("Connection established, pre-login commencing");try{this._stream=new o,t=new h,r=this._preLoginConfig;for(e in r)n=r[e],t.hasOwnProperty(e)&&(t[e]=n);return this._sendPacket(t)}catch(e){return this.logError&&console.error("Error on pre-login: ",e),this.state=g.statesByName.INITIAL,null!=(i=this._handler)&&"function"==typeof i.error&&i.error(e),this.end()}},e.prototype._socketError=function(e){var t;return this.logError&&console.error("Error in socket: ",e),null!=(t=this._handler)&&"function"==typeof t.error&&t.error(e),this.end()},e.prototype._socketData=function(e){return this.logDebug&&console.log("Received %d bytes at state",e.length,this.state,e),this._stream.append(e),null!=this._tokenStream?this._handleTokenStream():this._handlePacket()},e.prototype._getPacketFromType=function(e){switch(e){case m.type:return this.state===g.statesByName.CONNECTING?new h:new m;case h.type:return new h;default:throw new Error("Unrecognized type: "+e)}},e.prototype._handleToken=function(){var e,t,n,r,i,o;for(n=null,t=!1;;){this._stream.beginTransaction();try{e=this._stream.currentOffset(),n=this._tokenStream.nextToken(this._stream,this),this._tokenStreamRemainingLength-=this._stream.currentOffset()-e,this.logDebug&&console.log("From %d to %d offset, remaining: ",e,this._stream.currentOffset(),this._tokenStreamRemainingLength),this._stream.commitTransaction()}catch(e){if(e instanceof d)return this.logDebug&&console.log("Stream incomplete, rolling back"),void this._stream.rollbackTransaction();throw this.logError&&console.error("Error reading stream: ",e.stack),e}if(0===this._tokenStreamRemainingLength&&(this._tokenStream=this._tokenStreamRemainingLength=null),!this._cancelling||n.type===s.type)switch(this._cancelling=void 0,null!=(i=this._handler)&&"function"==typeof i[r=n.handlerFunction]&&i[r](n),this.logDebug&&console.log("Checking token type: ",n.type),n.type){case c.type:if(this.state!==g.statesByName["LOGGING IN"])throw new Error("Received login ack when not loggin in");t=!0;break;case a.type:this.colmetadata=n}if(null==this._tokenStream)break}if(t)return this.state=g.statesByName["LOGGED IN"],null!=(o=this._handler)&&"function"==typeof o.login?o.login():void 0},e.prototype._handlePacket=function(){var e,t,n;t=null,this._stream.beginTransaction();try{e=l.retrieveHeader(this._stream,this),t=this._getPacketFromType(e.type),t instanceof m?(this.logDebug&&console.log("Found token stream packet"),this._tokenStream=t,this._tokenStreamRemainingLength=e.length-8):(this.logDebug&&console.log("Found non token stream packet"),t.fromBuffer(this._stream,this)),this._stream.commitTransaction()}catch(e){if(e instanceof d)return this.logDebug&&console.log("Stream incomplete, rolling back"),void this._stream.rollbackTransaction();throw this.logError&&console.error("Error reading stream: ",e.stack),e}if(null!=this._tokenStream)return this._handleToken();if(this.logDebug&&console.log("Buffer remaining: ",this._stream.getBuffer()),t instanceof h)return this.state=g.statesByName.CONNECTED,null!=(n=this._handler)&&"function"==typeof n.connect?n.connect(t):void 0;throw this.logError&&console.error("Unrecognized type: "+t.type),new Error("Unrecognized type: "+t.type)},e.prototype._socketEnd=function(){var e;return this.logDebug&&console.log("Socket ended remotely"),this._socket=null,this.state=g.statesByName.INITIAL,null!=(e=this._handler)&&"function"==typeof e.end?e.end():void 0},e.prototype._socketClose=function(){return this.logDebug&&console.log("Socket closed"),this._socket=null,this.state=g.statesByName.INITIAL},e.prototype._sendPacket=function(e){var t,n;return this.logDebug&&console.log("Sending packet: %s at state",e.name,this.state),n=new i,n=e.toBuffer(new i,this),t=n.toBuffer(),this.logDebug&&console.log("Packet size: %d",t.length),this._socket.write(t)},e.prototype.end=function(){var e;this.logDebug&&console.log("Ending socket");try{this._socket.end()}catch(e){}return this._socket=null,this.state=g.statesByName.INITIAL,null!=(e=this._handler)&&"function"==typeof e.end?e.end():void 0},e}()},function(e,t,n){var r,i,o,a,s,u,c,l,h,f=Object.prototype.hasOwnProperty,p=function(e,t){function n(){this.constructor=e}for(var r in t)f.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=n(59).ColMetaDataToken,i=n(60).DoneToken,o=n(125).EnvChangeToken,a=n(126).ErrorMessageToken,s=n(127).InfoMessageToken,u=n(61).LoginAckToken,c=n(13).Packet,l=n(130).ReturnStatusToken,h=n(131).RowToken,t.TokenStreamPacket=function(e){function t(){this.type=4,this.name="TokenStream"}return p(t,e),t.type=4,t.name="TokenStream",t.prototype._getTokenFromType=function(e){switch(e){case r.type:return new r;case i.type:case i.type2:case i.type3:return new i;case o.type:return new o;case a.type:return new a;case s.type:return new s;case u.type:return new u;case l.type:return new l;case h.type:return new h;default:throw new Error("Unrecognized type: "+e)}},t.prototype.nextToken=function(e,t){var n,r;return r=e.readByte(),t.logDebug&&console.log("Retrieved token type: ",r),n=this._getTokenFromType(r),n.fromBuffer(e,t),t.logDebug&&console.log("Retrieved token: ",n),n},t}(c)},function(e,t,n){"use strict";var r=n(6).default,i=n(7).default,o=n(2).default,a=n(1).default;n(19);var s=n(65),u=n(136),c=n(4).EventEmitter,l=n(137).instanceLookup,h=n(26).TYPE,f=n(141),p=n(138),d=n(140),g=n(69),m=n(142),v=n(143),y=n(139),b=n(73).Socket,E=n(155).Parser,w=n(40).Transaction,_=n(40).ISOLATION_LEVEL,T=n(42),I=n(36).ConnectionError,S=n(36).RequestError,L=3e4,N=15e3,C=15e3,k=5e3,U=4096,P="2147483647",B=1433,D="7_4",A=function(e){function t(e){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.config=e,this.reset=this.reset.bind(this),this.socketClose=this.socketClose.bind(this),this.socketEnd=this.socketEnd.bind(this),this.socketConnect=this.socketConnect.bind(this),this.socketError=this.socketError.bind(this),this.requestTimeout=this.requestTimeout.bind(this),this.connectTimeout=this.connectTimeout.bind(this),this.defaultConfig(),this.createDebug(),this.createTokenStreamParser(),this.inTransaction=!1,this.transactionDescriptors=[new Buffer([0,0,0,0,0,0,0,0])],this.transitionTo(this.STATE.CONNECTING)}return i(t,e),o(t,[{key:"close",value:function(){return this.transitionTo(this.STATE.FINAL)}},{key:"initialiseConnection",value:function(){return this.connect(),this.createConnectTimer()}},{key:"cleanupConnection",value:function(e){if(this.redirect=e,!this.closed)return this.clearConnectTimer(),this.clearRequestTimer(),this.closeConnection(),this.redirect?this.emit("rerouting"):this.emit("end"),this.closed=!0,this.loggedIn=!1,this.loginError=null}},{key:"defaultConfig",value:function(){if(this.config.options||(this.config.options={}),this.config.options.textsize||(this.config.options.textsize=P),this.config.options.connectTimeout||(this.config.options.connectTimeout=N),void 0==this.config.options.requestTimeout&&(this.config.options.requestTimeout=C),void 0==this.config.options.cancelTimeout&&(this.config.options.cancelTimeout=k),this.config.options.packetSize||(this.config.options.packetSize=U),this.config.options.tdsVersion||(this.config.options.tdsVersion=D),this.config.options.isolationLevel||(this.config.options.isolationLevel=_.READ_COMMITTED),void 0==this.config.options.encrypt&&(this.config.options.encrypt=!1),this.config.options.cryptoCredentialsDetails||(this.config.options.cryptoCredentialsDetails={}),void 0==this.config.options.useUTC&&(this.config.options.useUTC=!0),void 0==this.config.options.useColumnNames&&(this.config.options.useColumnNames=!1),this.config.options.connectionIsolationLevel||(this.config.options.connectionIsolationLevel=_.READ_COMMITTED),void 0==this.config.options.readOnlyIntent&&(this.config.options.readOnlyIntent=!1),void 0==this.config.options.enableAnsiNullDefault&&(this.config.options.enableAnsiNullDefault=!0),this.config.options.port||this.config.options.instanceName){if(this.config.options.port&&this.config.options.instanceName)throw new Error("Port and instanceName are mutually exclusive, but "+this.config.options.port+" and "+this.config.options.instanceName+" provided");if(this.config.options.port&&(this.config.options.port<0||this.config.options.port>65536))throw new RangeError("Port should be > 0 and < 65536")}else this.config.options.port=B;if(this.config.options.columnNameReplacer&&"function"!=typeof this.config.options.columnNameReplacer)throw new TypeError("options.columnNameReplacer must be a function or null.")}},{key:"createDebug",value:function(){var e=this;return this.debug=new u(this.config.options.debug),this.debug.on("debug",function(t){return e.emit("debug",t)})}},{key:"createTokenStreamParser",value:function(){var e=this;this.tokenStreamParser=new E(this.debug,void 0,this.config.options),this.tokenStreamParser.on("infoMessage",function(t){return e.emit("infoMessage",t)}),this.tokenStreamParser.on("sspichallenge",function(t){return t.ntlmpacket&&(e.ntlmpacket=t.ntlmpacket),e.emit("sspichallenge",t)}),this.tokenStreamParser.on("errorMessage",function(t){return e.emit("errorMessage",t),e.loggedIn?e.request?(e.request.error=S(t.message,"EREQUEST"),e.request.error.number=t.number,e.request.error.state=t.state,e.request.error.class=t.class,e.request.error.serverName=t.serverName,e.request.error.procName=t.procName,e.request.error.lineNumber=t.lineNumber):void 0:e.loginError=I(t.message,"ELOGIN")}),this.tokenStreamParser.on("databaseChange",function(t){return e.emit("databaseChange",t.newValue)}),this.tokenStreamParser.on("languageChange",function(t){return e.emit("languageChange",t.newValue)}),this.tokenStreamParser.on("charsetChange",function(t){return e.emit("charsetChange",t.newValue)}),this.tokenStreamParser.on("loginack",function(t){return t.tdsVersion?t.interface?(e.config.options.tdsVersion=t.tdsVersion,e.loggedIn=!0):(e.loginError=I("Server responded with unsupported interface.","EINTERFACENOTSUPP"),void(e.loggedIn=!1)):(e.loginError=I("Server responded with unknown TDS version.","ETDS"),void(e.loggedIn=!1))}),this.tokenStreamParser.on("routingChange",function(t){return e.routingData=t.newValue,e.dispatchEvent("routingChange")}),this.tokenStreamParser.on("packetSizeChange",function(t){return e.messageIo.packetSize(t.newValue)}),this.tokenStreamParser.on("beginTransaction",function(t){return e.transactionDescriptors.push(t.newValue),e.inTransaction=!0}),this.tokenStreamParser.on("commitTransaction",function(){return e.transactionDescriptors.length=1,e.inTransaction=!1}),this.tokenStreamParser.on("rollbackTransaction",function(){return e.transactionDescriptors.length=1,e.inTransaction=!1,e.emit("rollbackTransaction")}),this.tokenStreamParser.on("columnMetadata",function(t){if(e.request){var n=void 0;if(e.config.options.useColumnNames){n={};for(var r=0,i=t.columns.length;r<i;r++){var o=t.columns[r];null==n[o.colName]&&(n[o.colName]=o)}}else n=t.columns;return e.request.emit("columnMetadata",n)}return e.emit("error",new Error("Received 'columnMetadata' when no sqlRequest is in progress")),e.close()}),this.tokenStreamParser.on("order",function(t){return e.request?e.request.emit("order",t.orderColumns):(e.emit("error",new Error("Received 'order' when no sqlRequest is in progress")),e.close())}),this.tokenStreamParser.on("row",function(t){return e.request?(e.config.options.rowCollectionOnRequestCompletion&&e.request.rows.push(t.columns),e.config.options.rowCollectionOnDone&&e.request.rst.push(t.columns),e.request.emit("row",t.columns)):(e.emit("error",new Error("Received 'row' when no sqlRequest is in progress")),e.close())}),this.tokenStreamParser.on("returnStatus",function(t){if(e.request)return e.procReturnStatusValue=t.value}),this.tokenStreamParser.on("returnValue",function(t){if(e.request)return e.request.emit("returnValue",t.paramName,t.value,t.metadata)}),this.tokenStreamParser.on("doneProc",function(t){if(e.request&&(e.request.emit("doneProc",t.rowCount,t.more,e.procReturnStatusValue,e.request.rst),e.procReturnStatusValue=void 0,void 0!==t.rowCount&&(e.request.rowCount+=t.rowCount),e.config.options.rowCollectionOnDone))return e.request.rst=[]}),this.tokenStreamParser.on("doneInProc",function(t){if(e.request&&(e.request.emit("doneInProc",t.rowCount,t.more,e.request.rst),void 0!==t.rowCount&&(e.request.rowCount+=t.rowCount),e.config.options.rowCollectionOnDone))return e.request.rst=[]}),this.tokenStreamParser.on("done",function(t){if(e.request&&(t.attention&&e.dispatchEvent("attention"),t.sqlError&&!e.request.error&&(e.request.error=S("An unknown error has occurred.","UNKNOWN")),
e.request.emit("done",t.rowCount,t.more,e.request.rst),void 0!==t.rowCount&&(e.request.rowCount+=t.rowCount),e.config.options.rowCollectionOnDone))return e.request.rst=[]}),this.tokenStreamParser.on("resetConnection",function(){return e.emit("resetConnection")}),this.tokenStreamParser.on("tokenStreamError",function(t){return e.emit("error",t),e.close()})}},{key:"connect",value:function(){var e=this;return this.config.options.port?this.connectOnPort(this.config.options.port):l(this.config.server,this.config.options.instanceName,function(t,n){if(e.state!==e.STATE.FINAL)return t?e.emit("connect",I(t,"EINSTLOOKUP")):e.connectOnPort(n)},this.config.options.connectTimeout)}},{key:"connectOnPort",value:function(e){var t=this;this.socket=new b({});var n={host:this.routingData?this.routingData.server:this.config.server,port:this.routingData?this.routingData.port:e};return this.config.options.localAddress&&(n.localAddress=this.config.options.localAddress),this.socket.connect(n),this.socket.on("error",this.socketError),this.socket.on("connect",this.socketConnect),this.socket.on("close",this.socketClose),this.socket.on("end",this.socketEnd),this.messageIo=new y(this.socket,this.config.options.packetSize,this.debug),this.messageIo.on("data",function(e){t.dispatchEvent("data",e)}),this.messageIo.on("message",function(){return t.dispatchEvent("message")}),this.messageIo.on("secure",this.emit.bind(this,"secure"))}},{key:"closeConnection",value:function(){this.socket&&this.socket.destroy()}},{key:"createConnectTimer",value:function(){return this.connectTimer=setTimeout(this.connectTimeout,this.config.options.connectTimeout)}},{key:"createRequestTimer",value:function(){if(this.config.options.requestTimeout)return this.requestTimer=setTimeout(this.requestTimeout,this.config.options.requestTimeout)}},{key:"connectTimeout",value:function(){var e="Failed to connect to "+this.config.server+":"+this.config.options.port+" in "+this.config.options.connectTimeout+"ms";return this.debug.log(e),this.emit("connect",I(e,"ETIMEOUT")),this.connectTimer=void 0,this.dispatchEvent("connectTimeout")}},{key:"requestTimeout",value:function(){return this.requestTimer=void 0,this.messageIo.sendMessage(h.ATTENTION),this.transitionTo(this.STATE.SENT_ATTENTION)}},{key:"clearConnectTimer",value:function(){if(this.connectTimer)return clearTimeout(this.connectTimer)}},{key:"clearRequestTimer",value:function(){if(this.requestTimer)return clearTimeout(this.requestTimer)}},{key:"transitionTo",value:function(e){return this.state===e?void this.debug.log("State is already "+e.name):(this.state&&this.state.exit&&this.state.exit.apply(this),this.debug.log("State change: "+(this.state?this.state.name:void 0)+" -> "+e.name),this.state=e,this.state.enter?this.state.enter.apply(this):void 0)}},{key:"dispatchEvent",value:function(e){if(this.state.events[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];return this.state.events[e].apply(this,t)}return this.emit("error",new Error("No event '"+e+"' in state '"+this.state.name+"'")),this.close()}},{key:"socketError",value:function(e){if(this.state===this.STATE.CONNECTING){var t="Failed to connect to "+this.config.server+":"+this.config.options.port+" - "+e.message;this.debug.log(t),this.emit("connect",I(t,"ESOCKET"))}else{var t="Connection lost - "+e.message;this.debug.log(t),this.emit("error",I(t,"ESOCKET"))}return this.dispatchEvent("socketError",e)}},{key:"socketConnect",value:function(){return this.socket.setKeepAlive(!0,L),this.closed=!1,this.debug.log("connected to "+this.config.server+":"+this.config.options.port),this.dispatchEvent("socketConnect")}},{key:"socketEnd",value:function(){return this.debug.log("socket ended"),this.transitionTo(this.STATE.FINAL)}},{key:"socketClose",value:function(){return this.debug.log("connection to "+this.config.server+":"+this.config.options.port+" closed"),this.state===this.STATE.REROUTING?(this.debug.log("Rerouting to "+this.routingData.server+":"+this.routingData.port),this.dispatchEvent("reconnect")):this.transitionTo(this.STATE.FINAL)}},{key:"sendPreLogin",value:function(){var e=new f({encrypt:this.config.options.encrypt});return this.messageIo.sendMessage(h.PRELOGIN,e.data),this.debug.payload(function(){return e.toString("  ")})}},{key:"emptyMessageBuffer",value:function(){return this.messageBuffer=new Buffer(0)}},{key:"addToMessageBuffer",value:function(e){return this.messageBuffer=Buffer.concat([this.messageBuffer,e])}},{key:"processPreLoginResponse",value:function(){var e=new f(this.messageBuffer);return this.debug.payload(function(){return e.toString("  ")}),"ON"===e.encryptionString||"REQ"===e.encryptionString?this.dispatchEvent("tls"):this.dispatchEvent("noTls")}},{key:"sendLogin7Packet",value:function(){var e=new p({domain:this.config.domain,userName:this.config.userName,password:this.config.password,database:this.config.options.database,serverName:this.routingData?this.routingData.server:this.config.server,appName:this.config.options.appName,packetSize:this.config.options.packetSize,tdsVersion:this.config.options.tdsVersion,initDbFatal:!this.config.options.fallbackToDefaultDb,readOnlyIntent:this.config.options.readOnlyIntent});return this.routingData=void 0,this.messageIo.sendMessage(h.LOGIN7,e.data),this.debug.payload(function(){return e.toString("  ")})}},{key:"sendNTLMResponsePacket",value:function(){var e=new d({domain:this.config.domain,userName:this.config.userName,password:this.config.password,database:this.config.options.database,appName:this.config.options.appName,packetSize:this.config.options.packetSize,tdsVersion:this.config.options.tdsVersion,ntlmpacket:this.ntlmpacket,additional:this.additional});return this.messageIo.sendMessage(h.NTLMAUTH_PKT,e.data),this.debug.payload(function(){return e.toString("  ")})}},{key:"sendDataToTokenStreamParser",value:function(e){return this.tokenStreamParser.addBuffer(e)}},{key:"sendInitialSql",value:function(){var e=new v(this.getInitialSql(),this.currentTransactionDescriptor(),this.config.options);return this.messageIo.sendMessage(h.SQL_BATCH,e.data)}},{key:"getInitialSql",value:function(){var e=this.config.options.abortTransactionOnError?"on":"off",t=this.config.options.enableAnsiNullDefault?"on":"off";return"set textsize "+this.config.options.textsize+"\nset quoted_identifier on\nset arithabort off\nset numeric_roundabort off\nset ansi_warnings on\nset ansi_padding on\nset ansi_nulls on\nset ansi_null_dflt_on "+t+"\nset concat_null_yields_null on\nset cursor_close_on_commit off\nset implicit_transactions off\nset language us_english\nset dateformat mdy\nset datefirst 7\nset transaction isolation level "+this.getIsolationLevelText(this.config.options.connectionIsolationLevel)+"\nset xact_abort "+e}},{key:"processedInitialSql",value:function(){return this.clearConnectTimer(),this.emit("connect")}},{key:"processLogin7Response",value:function(){return this.loggedIn?this.dispatchEvent("loggedIn"):(this.loginError?this.emit("connect",this.loginError):this.emit("connect",I("Login failed.","ELOGIN")),this.dispatchEvent("loginFailed"))}},{key:"processLogin7NTLMResponse",value:function(){return this.ntlmpacket?this.dispatchEvent("receivedChallenge"):(this.loginError?this.emit("connect",this.loginError):this.emit("connect",I("Login failed.","ELOGIN")),this.dispatchEvent("loginFailed"))}},{key:"processLogin7NTLMAck",value:function(){return this.loggedIn?this.dispatchEvent("loggedIn"):(this.loginError?this.emit("connect",this.loginError):this.emit("connect",I("Login failed.","ELOGIN")),this.dispatchEvent("loginFailed"))}},{key:"execSqlBatch",value:function(e){return this.makeRequest(e,h.SQL_BATCH,new v(e.sqlTextOrProcedure,this.currentTransactionDescriptor(),this.config.options))}},{key:"execSql",value:function(e){var t=this;return e.transformIntoExecuteSqlRpc(),null!=e.error?process.nextTick(function(){return t.debug.log(e.error.message),e.callback(e.error)}):this.makeRequest(e,h.RPC_REQUEST,new m(e,this.currentTransactionDescriptor(),this.config.options))}},{key:"newBulkLoad",value:function(e,t){return new s(e,this.config.options,t)}},{key:"execBulkLoad",value:function(e){var t=this,n=new g(e.getBulkInsertSql(),function(n){return n?("UNKNOWN"===n.code&&(n.message+=" This is likely because the schema of the BulkLoad does not match the schema of the table you are attempting to insert into."),e.error=n,e.callback(n)):t.makeRequest(e,h.BULK_LOAD,e.getPayload())});return this.execSqlBatch(n)}},{key:"prepare",value:function(e){return e.transformIntoPrepareRpc(),this.makeRequest(e,h.RPC_REQUEST,new m(e,this.currentTransactionDescriptor(),this.config.options))}},{key:"unprepare",value:function(e){return e.transformIntoUnprepareRpc(),this.makeRequest(e,h.RPC_REQUEST,new m(e,this.currentTransactionDescriptor(),this.config.options))}},{key:"execute",value:function(e,t){var n=this;return e.transformIntoExecuteRpc(t),null!=e.error?process.nextTick(function(){return n.debug.log(e.error.message),e.callback(e.error)}):this.makeRequest(e,h.RPC_REQUEST,new m(e,this.currentTransactionDescriptor(),this.config.options))}},{key:"callProcedure",value:function(e){var t=this;return e.validateParameters(),null!=e.error?process.nextTick(function(){return t.debug.log(e.error.message),e.callback(e.error)}):this.makeRequest(e,h.RPC_REQUEST,new m(e,this.currentTransactionDescriptor(),this.config.options))}},{key:"beginTransaction",value:function(e,t,n){var r=this;n||(n=this.config.options.isolationLevel);var i=new w(t||"",n);if(this.config.options.tdsVersion<"7_2")return this.execSqlBatch(new g("SET TRANSACTION ISOLATION LEVEL "+i.isolationLevelToTSQL()+";BEGIN TRAN "+i.name,e));var o=new g(void 0,function(t){return e(t,r.currentTransactionDescriptor())});return this.makeRequest(o,h.TRANSACTION_MANAGER,i.beginPayload(this.currentTransactionDescriptor()))}},{key:"commitTransaction",value:function(e,t){var n=new w(t||"");if(this.config.options.tdsVersion<"7_2")return this.execSqlBatch(new g("COMMIT TRAN "+n.name,e));var r=new g(void 0,e);return this.makeRequest(r,h.TRANSACTION_MANAGER,n.commitPayload(this.currentTransactionDescriptor()))}},{key:"rollbackTransaction",value:function(e,t){var n=new w(t||"");if(this.config.options.tdsVersion<"7_2")return this.execSqlBatch(new g("ROLLBACK TRAN "+n.name,e));var r=new g(void 0,e);return this.makeRequest(r,h.TRANSACTION_MANAGER,n.rollbackPayload(this.currentTransactionDescriptor()))}},{key:"saveTransaction",value:function(e,t){var n=new w(t);if(this.config.options.tdsVersion<"7_2")return this.execSqlBatch(new g("SAVE TRAN "+n.name,e));var r=new g(void 0,e);return this.makeRequest(r,h.TRANSACTION_MANAGER,n.savePayload(this.currentTransactionDescriptor()))}},{key:"transaction",value:function(e,t){var n=this;if("function"!=typeof e)throw new TypeError("`cb` must be a function");var r=this.inTransaction,i="_tedious_"+T.randomBytes(10).toString("hex"),o=this,a=function(e,t){for(var n=new Array(arguments.length-2),a=0;a<n.length;)n[a++]=arguments[a+1];return e?o.inTransaction&&o.state===o.STATE.LOGGED_IN?o.rollbackTransaction(function(r){return n.unshift(r||e),t.apply(null,n)},i):process.nextTick(function(){return n.unshift(e),t.apply(null,n)}):r?process.nextTick(function(){return n.unshift(null),t.apply(null,n)}):o.commitTransaction(function(e){return n.unshift(e),t.apply(null,n)},i)};return r?this.saveTransaction(function(r){return r?e(r):t?n.execSqlBatch(new g("SET transaction isolation level "+n.getIsolationLevelText(t),function(t){return e(t,a)})):e(null,a)},i):this.beginTransaction(function(t){return t?e(t):e(null,a)},i,t)}},{key:"makeRequest",value:function(e,t,n){if(this.state!==this.STATE.LOGGED_IN){var r="Requests can only be made in the "+this.STATE.LOGGED_IN.name+" state, not the "+this.state.name+" state";return this.debug.log(r),e.callback(S(r,"EINVALIDSTATE"))}return this.request=e,this.request.rowCount=0,this.request.rows=[],this.request.rst=[],this.createRequestTimer(),this.messageIo.sendMessage(t,n.data,this.resetConnectionOnNextRequest),this.resetConnectionOnNextRequest=!1,this.debug.payload(function(){return n.toString("  ")}),this.transitionTo(this.STATE.SENT_CLIENT_REQUEST)}},{key:"cancel",value:function(){if(this.state!==this.STATE.SENT_CLIENT_REQUEST){var e="Requests can only be canceled in the "+this.STATE.SENT_CLIENT_REQUEST.name+" state, not the "+this.state.name+" state";return this.debug.log(e),!1}return this.request.canceled=!0,this.messageIo.sendMessage(h.ATTENTION),this.transitionTo(this.STATE.SENT_ATTENTION),!0}},{key:"reset",value:function(e){var t=new g(this.getInitialSql(),function(t){return e(t)});return this.resetConnectionOnNextRequest=!0,this.execSqlBatch(t)}},{key:"currentTransactionDescriptor",value:function(){return this.transactionDescriptors[this.transactionDescriptors.length-1]}},{key:"getIsolationLevelText",value:function(e){switch(e){case _.READ_UNCOMMITTED:return"read uncommitted";case _.REPEATABLE_READ:return"repeatable read";case _.SERIALIZABLE:return"serializable";case _.SNAPSHOT:return"snapshot";default:return"read committed"}}}]),t}(c);e.exports=A,A.prototype.STATE={CONNECTING:{name:"Connecting",enter:function(){return this.initialiseConnection()},events:{socketError:function(){return this.transitionTo(this.STATE.FINAL)},connectTimeout:function(){return this.transitionTo(this.STATE.FINAL)},socketConnect:function(){return this.sendPreLogin(),this.transitionTo(this.STATE.SENT_PRELOGIN)}}},SENT_PRELOGIN:{name:"SentPrelogin",enter:function(){return this.emptyMessageBuffer()},events:{socketError:function(){return this.transitionTo(this.STATE.FINAL)},connectTimeout:function(){return this.transitionTo(this.STATE.FINAL)},data:function(e){return this.addToMessageBuffer(e)},message:function(){return this.processPreLoginResponse()},noTls:function(){return this.sendLogin7Packet(),this.config.domain?this.transitionTo(this.STATE.SENT_LOGIN7_WITH_NTLM):this.transitionTo(this.STATE.SENT_LOGIN7_WITH_STANDARD_LOGIN)},tls:function(){return this.messageIo.startTls(this.config.options.cryptoCredentialsDetails),this.transitionTo(this.STATE.SENT_TLSSSLNEGOTIATION)}}},REROUTING:{name:"ReRouting",enter:function(){return this.cleanupConnection(!0)},events:{message:function(){},socketError:function(){return this.transitionTo(this.STATE.FINAL)},connectTimeout:function(){return this.transitionTo(this.STATE.FINAL)},reconnect:function(){return this.transitionTo(this.STATE.CONNECTING)}}},SENT_TLSSSLNEGOTIATION:{name:"SentTLSSSLNegotiation",events:{socketError:function(){return this.transitionTo(this.STATE.FINAL)},connectTimeout:function(){return this.transitionTo(this.STATE.FINAL)},data:function(e){return this.messageIo.tlsHandshakeData(e)},message:function(){if(this.messageIo.tlsNegotiationComplete)return this.sendLogin7Packet(),this.transitionTo(this.STATE.SENT_LOGIN7_WITH_STANDARD_LOGIN)}}},SENT_LOGIN7_WITH_STANDARD_LOGIN:{name:"SentLogin7WithStandardLogin",events:{socketError:function(){return this.transitionTo(this.STATE.FINAL)},connectTimeout:function(){return this.transitionTo(this.STATE.FINAL)},data:function(e){return this.sendDataToTokenStreamParser(e)},loggedIn:function(){return this.transitionTo(this.STATE.LOGGED_IN_SENDING_INITIAL_SQL)},routingChange:function(){return this.transitionTo(this.STATE.REROUTING)},loginFailed:function(){return this.transitionTo(this.STATE.FINAL)},message:function(){return this.processLogin7Response()}}},SENT_LOGIN7_WITH_NTLM:{name:"SentLogin7WithNTLMLogin",events:{socketError:function(){return this.transitionTo(this.STATE.FINAL)},connectTimeout:function(){return this.transitionTo(this.STATE.FINAL)},data:function(e){return this.sendDataToTokenStreamParser(e)},receivedChallenge:function(){return this.sendNTLMResponsePacket(),this.transitionTo(this.STATE.SENT_NTLM_RESPONSE)},loginFailed:function(){return this.transitionTo(this.STATE.FINAL)},message:function(){return this.processLogin7NTLMResponse()}}},SENT_NTLM_RESPONSE:{name:"SentNTLMResponse",events:{socketError:function(){return this.transitionTo(this.STATE.FINAL)},connectTimeout:function(){return this.transitionTo(this.STATE.FINAL)},data:function(e){return this.sendDataToTokenStreamParser(e)},loggedIn:function(){return this.transitionTo(this.STATE.LOGGED_IN_SENDING_INITIAL_SQL)},loginFailed:function(){return this.transitionTo(this.STATE.FINAL)},routingChange:function(){return this.transitionTo(this.STATE.REROUTING)},message:function(){return this.processLogin7NTLMAck()}}},LOGGED_IN_SENDING_INITIAL_SQL:{name:"LoggedInSendingInitialSql",enter:function(){return this.sendInitialSql()},events:{connectTimeout:function(){return this.transitionTo(this.STATE.FINAL)},data:function(e){return this.sendDataToTokenStreamParser(e)},message:function(){return this.transitionTo(this.STATE.LOGGED_IN),this.processedInitialSql()}}},LOGGED_IN:{name:"LoggedIn",events:{socketError:function(){return this.transitionTo(this.STATE.FINAL)}}},SENT_CLIENT_REQUEST:{name:"SentClientRequest",events:{socketError:function(e){var t=this.request;return this.request=void 0,t.callback(e),this.transitionTo(this.STATE.FINAL)},data:function(e){return this.sendDataToTokenStreamParser(e)},message:function(){this.clearRequestTimer(),this.transitionTo(this.STATE.LOGGED_IN);var e=this.request;return this.request=void 0,e.callback(e.error,e.rowCount,e.rows)}}},SENT_ATTENTION:{name:"SentAttention",enter:function(){return this.attentionReceived=!1},events:{socketError:function(){return this.transitionTo(this.STATE.FINAL)},data:function(e){return this.sendDataToTokenStreamParser(e)},attention:function(){return this.attentionReceived=!0},message:function e(){if(this.attentionReceived){var t=this.request;if(this.request=void 0,this.transitionTo(this.STATE.LOGGED_IN),t.canceled)return t.callback(S("Canceled.","ECANCEL"));var e="Timeout: Request failed to complete in "+this.config.options.requestTimeout+"ms";return t.callback(S(e,"ETIMEOUT"))}}}},FINAL:{name:"Final",enter:function(){return this.cleanupConnection()},events:{loginFailed:function(){},connectTimeout:function(){},message:function(){},socketError:function(){}}}}},function(e,t,n){"use strict";var r=n(6).default,i=n(7).default,o=n(2).default,a=n(1).default,s=n(4).EventEmitter,u=n(5);e.exports=function(e){function t(e){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.options=e,this.options=this.options||{},this.options.data=this.options.data||!1,this.options.payload=this.options.payload||!1,this.options.packet=this.options.packet||!1,this.options.token=this.options.token||!1,this.indent="  "}return i(t,e),o(t,[{key:"packet",value:function(e,t){this.haveListeners()&&this.options.packet&&(this.log(""),this.log(e),this.log(t.headerToString(this.indent)))}},{key:"data",value:function(e){this.haveListeners()&&this.options.data&&this.log(e.dataToString(this.indent))}},{key:"payload",value:function(e){this.haveListeners()&&this.options.payload&&this.log(e())}},{key:"token",value:function(e){this.haveListeners()&&this.options.token&&this.log(u.inspect(e,!1,5,!0))}},{key:"haveListeners",value:function(){return this.listeners("debug").length>0}},{key:"log",value:function(e){this.emit("debug",e)}}]),t}(s)},function(e,t,n){"use strict";function r(e,t,n,r,l){function h(e){m&&(clearTimeout(m),m=void 0),e=e.toString("ascii",c);var r=i(e,t);return g.close(),r?n(void 0,r):n("Port for "+t+" not found in "+e)}function f(t){return m&&(clearTimeout(m),m=void 0),g.close(),n("Failed to lookup instance on "+e+" - "+t.message)}function p(){return m=void 0,g.close(),d()}function d(){if(v>0){v--;var t=new Buffer([2]);return g=o.createSocket("udp4"),g.on("error",f),g.on("message",h),g.send(t,0,t.length,a,e),m=setTimeout(p,r)}return n("Failed to get response from SQL Server Browser on "+e)}var g=void 0,m=void 0;r=r||s;var v=l||u;return d()}function i(e,t){for(var n=void 0,r=e.split(";;"),i=0,o=r.length;i<o;i++)for(var a=r[i],s=a.split(";"),u=0,c=s.length;u<c;u+=2){var l=s[u],h=s[u+1];if("tcp"===l&&n){var f=parseInt(h,10);return f}"InstanceName"===l&&(n=h.toUpperCase()===t.toUpperCase())}}var o=n(161),a=1434,s=2e3,u=3,c=3;e.exports.instanceLookup=r,e.exports.parseBrowserResponse=i},function(e,t,n){"use strict";var r=n(2).default,i=n(1).default;n(19);var o=n(28),a=n(74),s=n(18).sprintf,u=n(68).name,c=n(37).versions,l={ENDIAN_LITTLE:0,ENDIAN_BIG:1,CHARSET_ASCII:0,CHARSET_EBCDIC:2,FLOAT_IEEE_754:0,FLOAT_VAX:4,FLOAT_ND5000:8,BCP_DUMPLOAD_ON:0,BCP_DUMPLOAD_OFF:16,USE_DB_ON:0,USE_DB_OFF:32,INIT_DB_WARN:0,INIT_DB_FATAL:64,SET_LANG_WARN_OFF:0,SET_LANG_WARN_ON:128},h={INIT_LANG_WARN:0,INIT_LANG_FATAL:1,ODBC_OFF:0,ODBC_ON:2,F_TRAN_BOUNDARY:4,F_CACHE_CONNECT:8,USER_NORMAL:0,USER_SERVER:16,USER_REMUSER:32,USER_SQLREPL:64,INTEGRATED_SECURITY_OFF:0,INTEGRATED_SECURITY_ON:128},f={SQL_DFLT:0,SQL_TSQL:8,OLEDB_OFF:0,OLEDB_ON:16,READ_WRITE_INTENT:0,READ_ONLY_INTENT:32},p={CHANGE_PASSWORD_NO:0,CHANGE_PASSWORD_YES:1,BINARY_XML:2,SPAWN_USER_INSTANCE:4,UNKNOWN_COLLATION_HANDLING:8},d={NTLM_NegotiateUnicode:1,NTLM_NegotiateOEM:2,NTLM_RequestTarget:4,NTLM_Unknown9:8,NTLM_NegotiateSign:16,NTLM_NegotiateSeal:32,NTLM_NegotiateDatagram:64,NTLM_NegotiateLanManagerKey:128,NTLM_Unknown8:256,NTLM_NegotiateNTLM:512,NTLM_NegotiateNTOnly:1024,NTLM_Anonymous:2048,NTLM_NegotiateOemDomainSupplied:4096,NTLM_NegotiateOemWorkstationSupplied:8192,NTLM_Unknown6:16384,NTLM_NegotiateAlwaysSign:32768,NTLM_TargetTypeDomain:65536,NTLM_TargetTypeServer:131072,NTLM_TargetTypeShare:262144,NTLM_NegotiateExtendedSecurity:524288,NTLM_NegotiateIdentify:1048576,NTLM_Unknown5:2097152,NTLM_RequestNonNTSessionKey:4194304,NTLM_NegotiateTargetInfo:8388608,NTLM_Unknown4:16777216,NTLM_NegotiateVersion:33554432,NTLM_Unknown3:67108864,NTLM_Unknown2:134217728,NTLM_Unknown1:268435456,NTLM_Negotiate128:536870912,NTLM_NegotiateKeyExchange:1073741824,NTLM_Negotiate56:2147483648};e.exports=function(){function e(t){i(this,e),this.loginData=t;var n=4,r=this.createFixedData(),a=this.createVariableData(n+r.length),s=n+r.length+a.length,u=new o(300);u.writeUInt32LE(s),u.writeBuffer(r),u.writeBuffer(a),this.data=u.data}return r(e,[{key:"createFixedData",value:function(){this.tdsVersion=c[this.loginData.tdsVersion],this.packetSize=this.loginData.packetSize,this.clientProgVer=0,this.clientPid=process.pid,this.connectionId=0,this.clientTimeZone=(new Date).getTimezoneOffset(),this.clientLcid=1033,this.flags1=l.ENDIAN_LITTLE|l.CHARSET_ASCII|l.FLOAT_IEEE_754|l.BCD_DUMPLOAD_OFF|l.USE_DB_OFF|l.SET_LANG_WARN_ON,this.loginData.initDbFatal?this.flags1|=l.INIT_DB_FATAL:this.flags1|=l.INIT_DB_WARN,this.flags2=h.INIT_LANG_WARN|h.ODBC_OFF|h.USER_NORMAL,this.loginData.domain?this.flags2|=h.INTEGRATED_SECURITY_ON:this.flags2|=h.INTEGRATED_SECURITY_OFF,this.flags3=p.CHANGE_PASSWORD_NO|p.UNKNOWN_COLLATION_HANDLING,this.typeFlags=f.SQL_DFLT|f.OLEDB_OFF,this.loginData.readOnlyIntent?this.typeFlags|=f.READ_ONLY_INTENT:this.typeFlags|=f.READ_WRITE_INTENT;var e=new o(100);return e.writeUInt32LE(this.tdsVersion),e.writeUInt32LE(this.packetSize),e.writeUInt32LE(this.clientProgVer),e.writeUInt32LE(this.clientPid),e.writeUInt32LE(this.connectionId),e.writeUInt8(this.flags1),e.writeUInt8(this.flags2),e.writeUInt8(this.typeFlags),e.writeUInt8(this.flags3),e.writeInt32LE(this.clientTimeZone),e.writeUInt32LE(this.clientLcid),e.data}},{key:"createVariableData",value:function(e){this.variableLengthsLength=58,"7_1"===this.loginData.tdsVersion&&(this.variableLengthsLength=50);var t={offsetsAndLengths:new o(200),data:new o(200,"ucs2"),offset:e+this.variableLengthsLength};return this.hostname=a.hostname(),this.loginData=this.loginData||{},this.loginData.appName=this.loginData.appName||"Tedious",this.libraryName=u,this.clientId=new Buffer([1,2,3,4,5,6]),this.loginData.domain||(this.sspi="",this.sspiLong=0),this.attachDbFile="",this.changePassword="",this.addVariableDataString(t,this.hostname),this.addVariableDataString(t,this.loginData.userName),this.addVariableDataBuffer(t,this.createPasswordBuffer()),this.addVariableDataString(t,this.loginData.appName),this.addVariableDataString(t,this.loginData.serverName),this.addVariableDataString(t,""),this.addVariableDataString(t,this.libraryName),this.addVariableDataString(t,this.loginData.language),this.addVariableDataString(t,this.loginData.database),t.offsetsAndLengths.writeBuffer(this.clientId),this.loginData.domain?(this.ntlmPacket=this.createNTLMRequest(this.loginData),this.sspiLong=this.ntlmPacket.length,t.offsetsAndLengths.writeUInt16LE(t.offset),t.offsetsAndLengths.writeUInt16LE(this.ntlmPacket.length),t.data.writeBuffer(this.ntlmPacket),t.offset+=this.ntlmPacket.length):this.addVariableDataString(t,this.sspi),this.addVariableDataString(t,this.attachDbFile),this.loginData.tdsVersion>"7_1"&&(this.addVariableDataString(t,this.changePassword),t.offsetsAndLengths.writeUInt32LE(this.sspiLong)),Buffer.concat([t.offsetsAndLengths.data,t.data.data])}},{key:"addVariableDataBuffer",value:function(e,t){return e.offsetsAndLengths.writeUInt16LE(e.offset),e.offsetsAndLengths.writeUInt16LE(t.length/2),e.data.writeBuffer(t),e.offset+=t.length}},{key:"addVariableDataString",value:function(e,t){return t||(t=""),e.offsetsAndLengths.writeUInt16LE(e.offset),e.offsetsAndLengths.writeUInt16LE(t.length),e.data.writeString(t),e.offset+=2*t.length}},{key:"createNTLMRequest",value:function(e){var t=escape(e.domain.toUpperCase()),n=e.workstation?escape(e.workstation.toUpperCase()):"",r="NTLMSSP\0",i=40,a=i+t.length,s=new o(a),u=this.getNTLMFlags();return""===n&&(u-=d.NTLM_NegotiateOemWorkstationSupplied),s.writeString(r,"utf8"),s.writeUInt32LE(1),s.writeUInt32LE(u),s.writeUInt16LE(t.length),s.writeUInt16LE(t.length),s.writeUInt32LE(i+n.length),s.writeUInt16LE(n.length),s.writeUInt16LE(n.length),s.writeUInt32LE(i),s.writeUInt8(5),s.writeUInt8(0),s.writeUInt16LE(2195),s.writeUInt8(0),s.writeUInt8(0),s.writeUInt8(0),s.writeUInt8(15),s.writeString(n,"ascii"),s.writeString(t,"ascii"),s.data}},{key:"createPasswordBuffer",value:function(){var e=this.loginData.password||"";e=new Buffer(e,"ucs2");for(var t=0,n=e.length;t<n;t++){var r=e[t],i=15&r,o=r>>4;r=i<<4|o,r^=165,e[t]=r}return e}},{key:"getNTLMFlags",value:function(){return d.NTLM_NegotiateUnicode+d.NTLM_NegotiateOEM+d.NTLM_RequestTarget+d.NTLM_NegotiateNTLM+d.NTLM_NegotiateOemDomainSupplied+d.NTLM_NegotiateOemWorkstationSupplied+d.NTLM_NegotiateAlwaysSign+d.NTLM_NegotiateVersion+d.NTLM_NegotiateExtendedSecurity+d.NTLM_Negotiate128+d.NTLM_Negotiate56}},{key:"toString",value:function(e){return e||(e=""),e+"Login7 - "+s("TDS:0x%08X, PacketSize:0x%08X, ClientProgVer:0x%08X, ClientPID:0x%08X, ConnectionID:0x%08X",this.tdsVersion,this.packetSize,this.clientProgVer,this.clientPid,this.connectionId)+"\n"+e+"         "+s("Flags1:0x%02X, Flags2:0x%02X, TypeFlags:0x%02X, Flags3:0x%02X, ClientTimezone:%d, ClientLCID:0x%08X",this.flags1,this.flags2,this.typeFlags,this.flags3,this.clientTimeZone,this.clientLcid)+"\n"+e+"         "+s("Hostname:'%s', Username:'%s', Password:'%s', AppName:'%s', ServerName:'%s', LibraryName:'%s'",this.hostname,this.loginData.userName,this.loginData.password,this.loginData.appName,this.loginData.serverName,u)+"\n"+e+"         "+s("Language:'%s', Database:'%s', SSPI:'%s', AttachDbFile:'%s', ChangePassword:'%s'",this.loginData.language,this.loginData.database,this.sspi,this.attachDbFile,this.changePassword)}}]),e}()},function(e,t,n){"use strict";var r=n(6).default,i=n(7).default,o=n(2).default,a=n(1).default,s=n(167),u=n(42),c=n(4).EventEmitter,l=n(57).Transform;n(19);var h=n(26).Packet,f=n(26).TYPE,p=n(26).HEADER_LENGTH,d=function(e){function t(){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,{objectMode:!0}),this.buffer=new Buffer(0),this.position=0}return i(t,e),o(t,[{key:"_transform",value:function(e,t,n){for(this.position===this.buffer.length?this.buffer=e:this.buffer=Buffer.concat([this.buffer.slice(this.position),e],this.buffer.length-this.position+e.length),this.position=0;this.buffer.length>=this.position+p;){var r=this.buffer.readUInt16BE(this.position+2);if(!(this.buffer.length>=this.position+r))break;var i=this.buffer.slice(this.position,this.position+r);this.position+=r,this.push(new h(i))}n()}}]),t}(l);e.exports=function(e){function t(e,n,i){var o=this;a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.socket=e,this._packetSize=n,this.debug=i,this.sendPacket=this.sendPacket.bind(this),this.packetStream=new d,this.packetStream.on("data",function(e){o.logPacket("Received",e),o.emit("data",e.data()),e.isLast()&&o.emit("message")}),this.socket.pipe(this.packetStream),this.packetDataSize=this._packetSize-p}return i(t,e),o(t,[{key:"packetSize",value:function(e){return arguments.length>0&&(this.debug.log("Packet size changed from "+this._packetSize+" to "+e),this._packetSize=e,this.packetDataSize=this._packetSize-p),this._packetSize}},{key:"startTls",value:function(e){var t=this,n=s.createSecureContext?s.createSecureContext(e):u.createCredentials(e);this.securePair=s.createSecurePair(n),this.tlsNegotiationComplete=!1,this.securePair.on("secure",function(){var e=t.securePair.cleartext.getCipher();t.debug.log("TLS negotiated ("+e.name+", "+e.version+")"),t.emit("secure",t.securePair.cleartext),t.encryptAllFutureTraffic()}),this.securePair.encrypted.on("data",function(e){t.sendMessage(f.PRELOGIN,e)}),this.securePair.cleartext.write("")}},{key:"encryptAllFutureTraffic",value:function(){this.socket.unpipe(this.packetStream),this.securePair.encrypted.removeAllListeners("data"),this.socket.pipe(this.securePair.encrypted),this.securePair.encrypted.pipe(this.socket),this.securePair.cleartext.pipe(this.packetStream),this.tlsNegotiationComplete=!0}},{key:"tlsHandshakeData",value:function(e){this.securePair.encrypted.write(e)}},{key:"sendMessage",value:function(e,t,n){var r=void 0;t?r=Math.floor((t.length-1)/this.packetDataSize)+1:(r=1,t=new Buffer(0));for(var i=0;i<r;i++){var o=i*this.packetDataSize,a=void 0;a=i<r-1?o+this.packetDataSize:t.length;var s=t.slice(o,a),u=new h(e);u.last(i===r-1),u.resetConnection(n),u.packetId(i+1),u.addData(s),this.sendPacket(u)}}},{key:"sendPacket",value:function(e){this.logPacket("Sent",e),this.securePair&&this.tlsNegotiationComplete?this.securePair.cleartext.write(e.buffer):this.socket.write(e.buffer)}},{key:"logPacket",value:function(e,t){return this.debug.packet(e,t),this.debug.data(t)}}]),t}(c)},function(e,t,n){"use strict";var r=n(2).default,i=n(1).default,o=n(28),a=n(42),s=n(79).n,u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];e.exports=function(){function e(t){i(this,e),this.data=this.createResponse(t)}return r(e,[{key:"toString",value:function(e){return e||(e=""),e+"NTLM Auth"}},{key:"createResponse",value:function(e){var t=this.createClientNonce(),n=24,r=16,i=e.domain,a=e.userName,s=e.password,u=e.ntlmpacket,c=u.target,l=u.nonce,h=64+2*i.length+2*a.length+n+r+8+8+8+4+c.length+4,f=new o(h);f.position=0,f.writeString("NTLMSSP\0","utf8"),f.writeUInt32LE(3);var p=64,d=p,g=d+2*i.length,m=g+2*a.length,v=m+n;f.writeUInt16LE(n),f.writeUInt16LE(n),f.writeUInt32LE(m),f.writeUInt16LE(r),f.writeUInt16LE(r),f.writeUInt32LE(v),f.writeUInt16LE(2*i.length),f.writeUInt16LE(2*i.length),f.writeUInt32LE(d),f.writeUInt16LE(2*a.length),f.writeUInt16LE(2*a.length),f.writeUInt32LE(g),f.writeUInt16LE(0),f.writeUInt16LE(0),f.writeUInt32LE(p),f.writeUInt16LE(0),f.writeUInt16LE(0),f.writeUInt32LE(p),f.writeUInt16LE(33281),f.writeUInt16LE(8),f.writeString(i,"ucs2"),f.writeString(a,"ucs2");var y=this.lmv2Response(i,a,s,l,t);f.copyFrom(y);var b=(new Date).getTime();u=this.ntlmv2Response(i,a,s,l,c,t,b),f.copyFrom(u),f.writeUInt32LE(257),f.writeUInt32LE(0);var E=this.createTimestamp(b);return f.copyFrom(E),f.copyFrom(t),f.writeUInt32LE(0),f.copyFrom(c),f.writeUInt32LE(0),f.data}},{key:"createClientNonce",value:function(){for(var e=new Buffer(8),t=0;t<8;)e.writeUInt8(Math.ceil(255*Math.random()),t),t++;return e}},{key:"ntlmv2Response",value:function(e,t,n,r,i,o,a){var s=this.createTimestamp(a),u=this.ntv2Hash(e,t,n),c=40+i.length,l=new Buffer(c);return r.copy(l,0,0,8),l.writeUInt32LE(257,8),l.writeUInt32LE(0,12),
s.copy(l,16,0,8),o.copy(l,24,0,8),l.writeUInt32LE(0,32),i.copy(l,36,0,i.length),l.writeUInt32LE(0,36+i.length),this.hmacMD5(l,u)}},{key:"createTimestamp",value:function(e){for(var t=new s(e).plus(11644473600).multiply(1e7),n=[],r=[];"0"!==t.val();){var i=t.mod(16);r.unshift(u[i]),2===r.length&&(n.push(r.join("")),r=[])}return r.length>0&&n.push(r[0]+"0"),new Buffer(n.join(""),"hex")}},{key:"lmv2Response",value:function(e,t,n,r,i){var o=this.ntv2Hash(e,t,n),a=new Buffer(r.length+i.length);r.copy(a),i.copy(a,r.length,0,i.length);var s=this.hmacMD5(a,o),u=new Buffer(s.length+i.length);return s.copy(u),i.copy(u,s.length,0,i.length),u}},{key:"ntv2Hash",value:function(e,t,n){var r=this.ntHash(n),i=new Buffer(t.toUpperCase()+e.toUpperCase(),"ucs2");return this.hmacMD5(i,r)}},{key:"ntHash",value:function(e){var t=new Buffer(21);t.fill(0);var n=new Buffer(e,"ucs2"),r=a.createHash("md4").update(n).digest();return r.copy?r.copy(t):new Buffer(r,"ascii").copy(t),t}},{key:"hmacMD5",value:function(e,t){var n=a.createHmac("MD5",t);n.update(e);var r=n.digest();return r.copy?r:new Buffer(r,"ascii").slice(0,16)}}]),e}()},function(e,t,n){"use strict";var r=n(2).default,i=n(1).default,o=n(18).sprintf,a=n(27).WritableTrackingBuffer,s=20,u=1,c=1,l={VERSION:0,ENCRYPTION:1,INSTOPT:2,THREADID:3,MARS:4,TERMINATOR:255},h={OFF:0,ON:1,NOT_SUP:2,REQ:3},f={};for(var p in h){var d=h[p];f[d]=p}var g={OFF:0,ON:1},m={};for(var v in g){var d=g[v];m[d]=v}e.exports=function(){function e(t){i(this,e),t instanceof Buffer?this.data=t:(this.options=t||{},this.createOptions()),this.extractOptions()}return r(e,[{key:"createOptions",value:function(){for(var e=[this.createVersionOption(),this.createEncryptionOption(),this.createInstanceOption(),this.createThreadIdOption(),this.createMarsOption()],t=0,n=0,r=e.length;n<r;n++){var i=e[n];t+=5+i.data.length}t++,this.data=new Buffer(t);for(var o=0,a=5*e.length+1,s=0,r=e.length;s<r;s++){var i=e[s];this.data.writeUInt8(i.token,o+0),this.data.writeUInt16BE(a,o+1),this.data.writeUInt16BE(i.data.length,o+3),o+=5,i.data.copy(this.data,a),a+=i.data.length}return this.data.writeUInt8(l.TERMINATOR,o)}},{key:"createVersionOption",value:function(){var e=new a(s);return e.writeUInt32BE(u),e.writeUInt16BE(c),{token:l.VERSION,data:e.data}}},{key:"createEncryptionOption",value:function(){var e=new a(s);return this.options.encrypt?e.writeUInt8(h.ON):e.writeUInt8(h.NOT_SUP),{token:l.ENCRYPTION,data:e.data}}},{key:"createInstanceOption",value:function(){var e=new a(s);return e.writeUInt8(0),{token:l.INSTOPT,data:e.data}}},{key:"createThreadIdOption",value:function(){var e=new a(s);return e.writeUInt32BE(0),{token:l.THREADID,data:e.data}}},{key:"createMarsOption",value:function(){var e=new a(s);return e.writeUInt8(g.OFF),{token:l.MARS,data:e.data}}},{key:"extractOptions",value:function(){for(var e=0;this.data[e]!==l.TERMINATOR;){var t=this.data.readUInt16BE(e+1),n=this.data.readUInt16BE(e+3);switch(this.data[e]){case l.VERSION:this.extractVersion(t);break;case l.ENCRYPTION:this.extractEncryption(t);break;case l.INSTOPT:this.extractInstance(t);break;case l.THREADID:n>0&&this.extractThreadId(t);break;case l.MARS:this.extractMars(t)}e+=5,t+=n}}},{key:"extractVersion",value:function(e){return this.version={major:this.data.readUInt8(e+0),minor:this.data.readUInt8(e+1),patch:this.data.readUInt8(e+2),trivial:this.data.readUInt8(e+3),subbuild:this.data.readUInt16BE(e+4)}}},{key:"extractEncryption",value:function(e){return this.encryption=this.data.readUInt8(e),this.encryptionString=f[this.encryption]}},{key:"extractInstance",value:function(e){return this.instance=this.data.readUInt8(e)}},{key:"extractThreadId",value:function(e){return this.threadId=this.data.readUInt32BE(e)}},{key:"extractMars",value:function(e){return this.mars=this.data.readUInt8(e),this.marsString=m[this.mars]}},{key:"toString",value:function(e){return e||(e=""),e+"PreLogin - "+o("version:%d.%d.%d.%d %d, encryption:0x%02X(%s), instopt:0x%02X, threadId:0x%08X, mars:0x%02X(%s)",this.version.major,this.version.minor,this.version.patch,this.version.trivial,this.version.subbuild,this.encryption?this.encryption:0,this.encryptionString?this.encryptionString:0,this.instance?this.instance:0,this.threadId?this.threadId:0,this.mars?this.mars:0,this.marsString?this.marsString:0)}}]),e}()},function(e,t,n){"use strict";var r=n(2).default,i=n(1).default,o=n(27).WritableTrackingBuffer,a=n(35).writeToTrackingBuffer,s={BY_REF_VALUE:1,DEFAULT_VALUE:2};e.exports=function(){function e(t,n,r){i(this,e),this.request=t,this.procedure=this.request.sqlTextOrProcedure;var u=new o(500);if(r.tdsVersion>="7_2"){var c=1;a(u,n,c)}"string"==typeof this.procedure?u.writeUsVarchar(this.procedure):(u.writeUShort(65535),u.writeUShort(this.procedure));var l=0;u.writeUInt16LE(l);for(var h=this.request.parameters,f=0,p=h.length;f<p;f++){var d=h[f];u.writeBVarchar("@"+d.name);var g=0;d.output&&(g|=s.BY_REF_VALUE),u.writeUInt8(g);var m={value:d.value},v=d.type;32===(48&v.id)&&(d.length?m.length=d.length:v.resolveLength&&(m.length=v.resolveLength(d))),v.hasPrecision&&(d.precision?m.precision=d.precision:v.resolvePrecision&&(m.precision=v.resolvePrecision(d))),v.hasScale&&(d.scale?m.scale=d.scale:v.resolveScale&&(m.scale=v.resolveScale(d))),v.writeTypeInfo(u,m,r),v.writeParameterData(u,m,r)}this.data=u.data}return r(e,[{key:"toString",value:function(e){return e||(e=""),e+("RPC Request - "+this.procedure)}}]),e}()},function(e,t,n){"use strict";var r=n(2).default,i=n(1).default,o=n(27).WritableTrackingBuffer,a=n(35).writeToTrackingBuffer;e.exports=function(){function e(t,n,r){i(this,e),this.sqlText=t;var s=new o(100+2*this.sqlText.length,"ucs2");if(r.tdsVersion>="7_2"){var u=1;a(s,n,u)}s.writeString(this.sqlText,"ucs2"),this.data=s.data}return r(e,[{key:"toString",value:function(e){return e||(e=""),e+("SQL Batch - "+this.sqlText)}}]),e}()},function(e,t,n){"use strict";e.exports.BulkLoad=n(65),e.exports.Connection=n(135),e.exports.Request=n(69),e.exports.library=n(68),e.exports.TYPES=n(25).typeByName,e.exports.ISOLATION_LEVEL=n(40).ISOLATION_LEVEL,e.exports.TDS_VERSION=n(37).versions},function(e,t,n){"use strict";function r(e,t,n,r){n.type.hasTableName?t.tdsVersion>="7_2"?e.readUInt8(function(t){function n(r){return t===o?r():void e.readUsVarChar(function(e){i.push(e),o++,n(r)})}var i=[],o=0;n(function(){r(i)})}):e.readUsVarChar(r):r(void 0)}function i(e,t,n,r,i){e.readBVarChar(function(e){i(t.columnNameReplacer?t.columnNameReplacer(e,n,r):t.camelCaseColumns?e.replace(/^[A-Z]/,function(e){return e.toLowerCase()}):e)})}function o(e,t,n,o){a(e,t,function(a){r(e,t,a,function(r){i(e,t,n,a,function(e){o({userType:a.userType,flags:a.flags,type:a.type,colName:e,collation:a.collation,precision:a.precision,scale:a.scale,udtInfo:a.udtInfo,dataLength:a.dataLength,tableName:r})})})})}var a=n(20);e.exports=function(e,t,n,r){e.readUInt16LE(function(t){function i(r){return s===t?r():void o(e,n,s,function(e){a.push(e),s++,i(r)})}var a=[],s=0;i(function(){r({name:"COLMETADATA",event:"columnMetadata",columns:a})})})}},function(e,t){"use strict";function n(e,t,n,r){switch(n.name){case"DATABASE":case"LANGUAGE":case"CHARSET":case"PACKET_SIZE":case"DATABASE_MIRRORING_PARTNER":return e.readBVarChar(function(t){e.readBVarChar(function(e){"PACKET_SIZE"===n.name?r(parseInt(t),parseInt(e)):r(t,e)})});case"SQL_COLLATION":case"BEGIN_TXN":case"COMMIT_TXN":case"ROLLBACK_TXN":case"RESET_CONNECTION":return e.readBVarByte(function(t){e.readBVarByte(function(e){r(t,e)})});case"ROUTING_CHANGE":e.readUInt16LE(function(t){e.readBuffer(t,function(t){var n=t.readUInt8(0);if(0!==n)return e.emit("error",new Error("Unknown protocol byte in routing change event"));var i=t.readUInt16LE(1),o=t.readUInt16LE(3),a=t.toString("ucs2",5,5+2*o),s={protocol:n,port:i,server:a};e.readUInt16LE(function(t){e.readBuffer(t,function(e){r(s,e)})})})});break;default:console.error("Tedious > Unsupported ENVCHANGE type "+n.name),e.readBuffer(t-1,function(){r(void 0,void 0)})}}var r={1:{name:"DATABASE",event:"databaseChange"},2:{name:"LANGUAGE",event:"languageChange"},3:{name:"CHARSET",event:"charsetChange"},4:{name:"PACKET_SIZE",event:"packetSizeChange"},7:{name:"SQL_COLLATION",event:"sqlCollationChange"},8:{name:"BEGIN_TXN",event:"beginTransaction"},9:{name:"COMMIT_TXN",event:"commitTransaction"},10:{name:"ROLLBACK_TXN",event:"rollbackTransaction"},13:{name:"DATABASE_MIRRORING_PARTNER",event:"partnerNode"},17:{name:"TXN_ENDED"},18:{name:"RESET_CONNECTION",event:"resetConnection"},20:{name:"ROUTING_CHANGE",event:"routingChange"}};e.exports=function(e,t,i,o){e.readUInt16LE(function(t){e.readUInt8(function(i){var a=r[i];return a?void n(e,t,a,function(e,t){o({name:"ENVCHANGE",type:a.name,event:a.event,oldValue:t,newValue:e})}):(console.error("Tedious > Unsupported ENVCHANGE type "+i),e.readBuffer(t-1,function(){o()}))})})}},function(e,t,n){"use strict";var r=n(37).versionsByValue,i={0:"SQL_DFLT",1:"SQL_TSQL"};e.exports=function(e,t,n,o){e.readUInt16LE(function(){e.readUInt8(function(t){var n=i[t];e.readUInt32BE(function(t){var i=r[t];e.readBVarChar(function(t){e.readUInt8(function(r){e.readUInt8(function(a){e.readUInt8(function(s){e.readUInt8(function(e){o({name:"LOGINACK",event:"loginack",interface:n,tdsVersion:i,progName:t,progVersion:{major:r,minor:a,buildNumHi:s,buildNumLow:e}})})})})})})})})})}},function(e,t,n){"use strict";function r(e,t,n,r){r(null)}var i=n(41);e.exports=function(e,t,n,o){var a=Math.ceil(t.length/8);e.readBuffer(a,function(a){function s(o){if(g===d)return o();var a=t[g];(u[g]?r:i)(e,a,n,function(e){var t={value:e,metadata:a};n.useColumnNames?null==p[a.colName]&&(p[a.colName]=t):p.push(t),g++,s(o)})}for(var u=[],c=0,l=a.length;c<l;c++)for(var h=a[c],f=0;f<=7;f++)u.push(!!(h&1<<f));var p=n.useColumnNames?{}:[],d=t.length,g=0;s(function(){o({name:"NBCROW",event:"row",columns:p})})})}},function(e,t){"use strict";e.exports=function(e,t,n,r){e.readUInt16LE(function(t){function n(t){return a===i?t():void e.readUInt16LE(function(e){o.push(e),a++,n(t)})}var i=t/2,o=[],a=0;n(function(){r({name:"ORDER",event:"order",orderColumns:o})})})}},function(e,t){"use strict";e.exports=function(e,t,n,r){e.readInt32LE(function(e){r({name:"RETURNSTATUS",event:"returnStatus",value:e})})}},function(e,t,n){"use strict";var r=n(20),i=n(41);e.exports=function(e,t,n,o){e.readUInt16LE(function(t){e.readBVarChar(function(a){"@"===a.charAt(0)&&(a=a.slice(1)),e.readUInt8(function(){r(e,n,function(r){i(e,r,n,function(e){o({name:"RETURNVALUE",event:"returnValue",paramOrdinal:t,paramName:a,metadata:r,value:e})})})})})})}},function(e,t,n){"use strict";var r=n(41);e.exports=function(e,t,n,i){function o(i){if(u===s)return i();var c=t[u];r(e,c,n,function(e){var t={value:e,metadata:c};n.useColumnNames?null==a[c.colName]&&(a[c.colName]=t):a.push(t),u++,o(i)})}var a=n.useColumnNames?{}:[],s=t.length,u=0;o(function(){i({name:"ROW",event:"row",columns:a})})}},function(e,t){"use strict";function n(e){var t={};return t.magic=e.slice(0,8).toString("utf8"),t.type=e.readInt32LE(8),t.domainLen=e.readInt16LE(12),t.domainMax=e.readInt16LE(14),t.domainOffset=e.readInt32LE(16),t.flags=e.readInt32LE(20),t.nonce=e.slice(24,32),t.zeroes=e.slice(32,40),t.targetLen=e.readInt16LE(40),t.targetMax=e.readInt16LE(42),t.targetOffset=e.readInt32LE(44),t.oddData=e.slice(48,56),t.domain=e.slice(56,56+t.domainLen).toString("ucs2"),t.target=e.slice(56+t.domainLen,56+t.domainLen+t.targetLen),t}e.exports=function(e,t,r,i){e.readUsVarByte(function(e){i({name:"SSPICHALLENGE",event:"sspichallenge",ntlmpacket:n(e)})})}},function(e,t,n){"use strict";var r=n(6).default,i=n(7).default,o=n(2).default,a=n(1).default,s=n(57).Transform,u=n(71).TYPE,c={};c[u.COLMETADATA]=n(145),c[u.DONE]=n(38).doneParser,c[u.DONEINPROC]=n(38).doneInProcParser,c[u.DONEPROC]=n(38).doneProcParser,c[u.ENVCHANGE]=n(146),c[u.ERROR]=n(70).errorParser,c[u.INFO]=n(70).infoParser,c[u.LOGINACK]=n(147),c[u.ORDER]=n(149),c[u.RETURNSTATUS]=n(150),c[u.RETURNVALUE]=n(151),c[u.ROW]=n(152),c[u.NBCROW]=n(148),c[u.SSPI]=n(153),e.exports=function(e){function t(e,n,i){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,{objectMode:!0}),this.debug=e,this.colMetadata=n,this.options=i,this.buffer=new Buffer(0),this.position=0,this.suspended=!1,this.await=void 0,this.next=void 0}return i(t,e),o(t,[{key:"_transform",value:function(e,t,n){this.position===this.buffer.length?this.buffer=e:this.buffer=Buffer.concat([this.buffer.slice(this.position),e]),this.position=0,this.await=n,this.suspended&&(this.suspended=!1,this.next.call(null)),this.suspended||this.parseTokens()}},{key:"parseTokens",value:function(){for(var e=this,t=function(t){if(t){switch(t.name){case"COLMETADATA":e.colMetadata=t.columns}e.push(t)}};!this.suspended&&this.position+1<=this.buffer.length;){var n=this.buffer.readUInt8(this.position,!0);this.position+=1,c[n]?c[n](this,this.colMetadata,this.options,t):this.emit("error",new Error("Unknown type: "+n))}if(!this.suspended&&this.position===this.buffer.length)return this.await.call(null)}},{key:"suspend",value:function(e){this.suspended=!0,this.next=e,this.await.call(null)}},{key:"awaitData",value:function(e,t){var n=this;this.position+e<=this.buffer.length?t():this.suspend(function(){n.awaitData(e,t)})}},{key:"readInt8",value:function(e){var t=this;this.awaitData(1,function(){var n=t.buffer.readInt8(t.position);t.position+=1,e(n)})}},{key:"readUInt8",value:function(e){var t=this;this.awaitData(1,function(){var n=t.buffer.readUInt8(t.position);t.position+=1,e(n)})}},{key:"readInt16LE",value:function(e){var t=this;this.awaitData(2,function(){var n=t.buffer.readInt16LE(t.position);t.position+=2,e(n)})}},{key:"readInt16BE",value:function(e){var t=this;this.awaitData(2,function(){var n=t.buffer.readInt16BE(t.position);t.position+=2,e(n)})}},{key:"readUInt16LE",value:function(e){var t=this;this.awaitData(2,function(){var n=t.buffer.readUInt16LE(t.position);t.position+=2,e(n)})}},{key:"readUInt16BE",value:function(e){var t=this;this.awaitData(2,function(){var n=t.buffer.readUInt16BE(t.position);t.position+=2,e(n)})}},{key:"readInt32LE",value:function(e){var t=this;this.awaitData(4,function(){var n=t.buffer.readInt32LE(t.position);t.position+=4,e(n)})}},{key:"readInt32BE",value:function(e){var t=this;this.awaitData(4,function(){var n=t.buffer.readInt32BE(t.position);t.position+=4,e(n)})}},{key:"readUInt32LE",value:function(e){var t=this;this.awaitData(4,function(){var n=t.buffer.readUInt32LE(t.position);t.position+=4,e(n)})}},{key:"readUInt32BE",value:function(e){var t=this;this.awaitData(4,function(){var n=t.buffer.readUInt32BE(t.position);t.position+=4,e(n)})}},{key:"readInt64LE",value:function(e){var t=this;this.awaitData(8,function(){var n=Math.pow(2,32)*t.buffer.readInt32LE(t.position+4)+(t.buffer[t.position+4]&!0?1:-1)*t.buffer.readUInt32LE(t.position);t.position+=8,e(n)})}},{key:"readInt64BE",value:function(e){var t=this;this.awaitData(8,function(){var n=Math.pow(2,32)*t.buffer.readInt32BE(t.position)+(t.buffer[t.position]&!0?1:-1)*t.buffer.readUInt32BE(t.position+4);t.position+=8,e(n)})}},{key:"readUInt64LE",value:function(e){var t=this;this.awaitData(8,function(){var n=Math.pow(2,32)*t.buffer.readUInt32LE(t.position+4)+t.buffer.readUInt32LE(t.position);t.position+=8,e(n)})}},{key:"readUInt64BE",value:function(e){var t=this;this.awaitData(8,function(){var n=Math.pow(2,32)*t.buffer.readUInt32BE(t.position)+t.buffer.readUInt32BE(t.position+4);t.position+=8,e(n)})}},{key:"readFloatLE",value:function(e){var t=this;this.awaitData(4,function(){var n=t.buffer.readFloatLE(t.position);t.position+=4,e(n)})}},{key:"readFloatBE",value:function(e){var t=this;this.awaitData(4,function(){var n=t.buffer.readFloatBE(t.position);t.position+=4,e(n)})}},{key:"readDoubleLE",value:function(e){var t=this;this.awaitData(8,function(){var n=t.buffer.readDoubleLE(t.position);t.position+=8,e(n)})}},{key:"readDoubleBE",value:function(e){var t=this;this.awaitData(8,function(){var n=t.buffer.readDoubleBE(t.position);t.position+=8,e(n)})}},{key:"readUInt24LE",value:function(e){var t=this;this.awaitData(3,function(){var n=t.buffer.readUInt16LE(t.position),r=t.buffer.readUInt8(t.position+2);t.position+=3,e(n|r<<16)})}},{key:"readUInt40LE",value:function(e){var t=this;this.awaitData(5,function(){var n=t.buffer.readUInt32LE(t.position),r=t.buffer.readUInt8(t.position+4);t.position+=5,e(4294967296*r+n)})}},{key:"readUNumeric64LE",value:function(e){var t=this;this.awaitData(8,function(){var n=t.buffer.readUInt32LE(t.position),r=t.buffer.readUInt32LE(t.position+4);t.position+=8,e(4294967296*r+n)})}},{key:"readUNumeric96LE",value:function(e){var t=this;this.awaitData(12,function(){var n=t.buffer.readUInt32LE(t.position),r=t.buffer.readUInt32LE(t.position+4),i=t.buffer.readUInt32LE(t.position+8);t.position+=12,e(n+4294967296*r+0x10000000000000000*i)})}},{key:"readUNumeric128LE",value:function(e){var t=this;this.awaitData(16,function(){var n=t.buffer.readUInt32LE(t.position),r=t.buffer.readUInt32LE(t.position+4),i=t.buffer.readUInt32LE(t.position+8),o=t.buffer.readUInt32LE(t.position+12);t.position+=16,e(n+4294967296*r+0x10000000000000000*i+7.922816251426434e28*o)})}},{key:"readBuffer",value:function(e,t){var n=this;this.awaitData(e,function(){var r=n.buffer.slice(n.position,n.position+e);n.position+=e,t(r)})}},{key:"readBVarChar",value:function(e){var t=this;this.readUInt8(function(n){t.readBuffer(2*n,function(t){e(t.toString("ucs2"))})})}},{key:"readUsVarChar",value:function(e){var t=this;this.readUInt16LE(function(n){t.readBuffer(2*n,function(t){e(t.toString("ucs2"))})})}},{key:"readBVarByte",value:function(e){var t=this;this.readUInt8(function(n){t.readBuffer(n,e)})}},{key:"readUsVarByte",value:function(e){var t=this;this.readUInt16LE(function(n){t.readBuffer(n,e)})}}]),t}(s)},function(e,t,n){"use strict";var r=n(6).default,i=n(7).default,o=n(2).default,a=n(1).default,s=n(4).EventEmitter,u=n(154),c=function(e){function t(e,n,i){var o=this;a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.debug=e,this.colMetadata=this.colMetadata,this.options=i,this.parser=new u(this.debug,this.colMetadata,this.options),this.parser.on("data",function(e){e.event&&o.emit(e.event,e)})}return i(t,e),o(t,[{key:"addBuffer",value:function(e){return this.parser.write(e)}},{key:"isEnd",value:function(){return this.parser.buffer.length===this.parser.position}}]),t}(s);e.exports.Parser=c},function(e,t,n){"use strict";var r=n(2).default,i=n(1).default,o=n(39).convertLEBytesToString;e.exports=function(){function e(t,n){i(this,e),this.buffer=t,this.encoding=n,this.buffer||(this.buffer=new Buffer(0),this.encoding=void 0),this.encoding||(this.encoding="utf8"),this.position=0}return r(e,[{key:"add",value:function(e){return this.buffer=Buffer.concat([this.buffer.slice(this.position),e]),this.position=0}},{key:"assertEnoughLeftFor",value:function(e){this.previousPosition=this.position;var t=this.buffer.length-this.position;if(t<e){var n=new Error("required : "+e+", available : "+t);throw n.code="oob",n}}},{key:"empty",value:function(){return this.position===this.buffer.length}},{key:"rollback",value:function(){return this.position=this.previousPosition}},{key:"readUInt8",value:function(){var e=1;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readUInt8(this.position-e)}},{key:"readUInt16LE",value:function(){var e=2;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readUInt16LE(this.position-e)}},{key:"readUInt16BE",value:function(){var e=2;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readUInt16BE(this.position-e)}},{key:"readUInt32LE",value:function(){var e=4;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readUInt32LE(this.position-e)}},{key:"readUInt32BE",value:function(){var e=4;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readUInt32BE(this.position-e)}},{key:"readInt8",value:function(){var e=1;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readInt8(this.position-e)}},{key:"readInt16LE",value:function(){var e=2;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readInt16LE(this.position-e)}},{key:"readInt16BE",value:function(){var e=2;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readInt16BE(this.position-e)}},{key:"readInt32LE",value:function(){var e=4;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readInt32LE(this.position-e)}},{key:"readInt32BE",value:function(){var e=4;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readInt32BE(this.position-e)}},{key:"readFloatLE",value:function(){var e=4;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readFloatLE(this.position-e)}},{key:"readDoubleLE",value:function(){var e=8;return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.readDoubleLE(this.position-e)}},{key:"readUInt24LE",value:function(){var e=3;this.assertEnoughLeftFor(e);var t=this.buffer[this.position+1]<<8;return t|=this.buffer[this.position],t+=this.buffer[this.position+2]<<16>>>0,this.position+=e,t}},{key:"readUInt40LE",value:function(){var e=this.readBuffer(4).readUInt32LE(0),t=Buffer.concat([this.readBuffer(1),new Buffer([0,0,0])]).readUInt32LE(0);return e+4294967296*t}},{key:"readUInt64LE",value:function(){var e=this.readUInt32LE(),t=this.readUInt32LE();return t>=2<<21&&console.warn("Read UInt64LE > 53 bits : high="+t+", low="+e),e+4294967296*t}},{key:"readUNumeric64LE",value:function(){var e=this.readUInt32LE(),t=this.readUInt32LE();return e+4294967296*t}},{key:"readUNumeric96LE",value:function(){var e=this.readUInt32LE(),t=this.readUInt32LE(),n=this.readUInt32LE();return e+4294967296*t+0x10000000000000000*n}},{key:"readUNumeric128LE",value:function(){var e=this.readUInt32LE(),t=this.readUInt32LE(),n=this.readUInt32LE(),r=this.readUInt32LE();return e+4294967296*t+0x10000000000000000*n+7.922816251426434e28*r}},{key:"readString",value:function(e,t){return t||(t=this.encoding),this.assertEnoughLeftFor(e),this.position+=e,this.buffer.toString(t,this.position-e,this.position)}},{key:"readBVarchar",value:function(e){e||(e=this.encoding);var t="ucs2"===e?2:1,n=this.readUInt8()*t;return this.readString(n,e)}},{key:"readUsVarchar",value:function(e){e||(e=this.encoding);var t="ucs2"===e?2:1,n=this.readUInt16LE()*t;return this.readString(n,e)}},{key:"readBuffer",value:function(e){return this.assertEnoughLeftFor(e),this.position+=e,this.buffer.slice(this.position-e,this.position)}},{key:"readArray",value:function(e){return Array.prototype.slice.call(this.readBuffer(e),0,e)}},{key:"readAsStringBigIntLE",value:function(e){return this.assertEnoughLeftFor(e),this.position+=e,o(this.buffer.slice(this.position-e,this.position))}},{key:"readAsStringInt64LE",value:function(){return this.readAsStringBigIntLE(8)}}]),e}()},function(e,t){"use strict";var n=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=function(){function e(e){this.stringData=e.linedata.join(" "),this.action=e.linedata[2].slice(0,-1),this.dateTime=this.createDateTime(e.dateString,e.linedata[0]),this.product=e.linedata[1].slice(1,-1),this.lineNumber=e.line}return e.prototype.createDateTime=function(e,t){var n=new Date(e+" "+t);return n.setHours(n.getHours()-8),n},e}();t.Entry=r;var i=function(e){function t(t){e.call(this,t),this.dateString=t.linedata[3]}return n(t,e),t}(r);t.TimestampLine=i;var o=function(e){function t(t){e.call(this,t),this.entryPoint=t.linedata[3].slice(1,-1),this.user=t.linedata[4],this.dailyMax=0}return n(t,e),t}(r);t.LoginLine=o},function(e,t){"use strict";var n=function(){function e(e,t,n,r){this.path=e,this.setLogData(t||null),this.setLine(n||0),r&&(this.dateString=r)}return e.prototype.incramentLine=function(){this.line+=1},e.prototype.getLine=function(){return this.line},e.prototype.setLine=function(e){this.line=e},e.prototype.setLineData=function(){this.lineData=this.log[this.line].trim().split(" ")},e.prototype.setLogData=function(e){this.log=e},e.prototype.getLineType=function(){return this.lineData[2]},e.prototype.setLineEntry=function(e){this.lineEntry=e},e.prototype.getLineEntry=function(){return this.lineEntry},e.prototype.getLineParams=function(){var e=this.line+1;return{linedata:this.lineData,dateString:this.dateString,line:e}},e.prototype.getPath=function(){return this.path},e.prototype.getLogLength=function(){return this.log.length},e.prototype.setDateString=function(e){this.dateString=e},e.prototype.getDateString=function(){return this.dateString},e.prototype.isLastLine=function(){return!(this.getLine()<this.getLogLength())},e.prototype.getLineCount=function(){return this.log.length},e}();t.LogData=n},function(e,t,n){"use strict";function r(){var e=null,t=30;setInterval(function(){var n=new d.LogData(m,null,v,e);console.log("Still processing:"),y?console.log(y+" ...\n\tDelaying next process for "+t+" seconds"):(console.log(y+" ...\n\tStarting next process"),i(n).then(function(t){e=t.getDateString(),v=t.getLine(),n=t}).catch(u))},1e3*t)}function i(e){return console.log("Start Processing"),y=!0,l(e).then(o).then(c).then(function(e){return y=!1,console.log("Processes are cleared "+(new Date).toLocaleString()),console.log("Last Date "+e.getDateString()),h.resolve(e)})}function o(e){return console.log("Processing Log File"),new h(function(t,n){f.readFile(e.getPath(),"utf8",function(r,i){r&&n(r),e.setLogData(i.trim().split("\r\n")),console.log("Found "+e.getLineCount()+" lines"),t(e)})})}function a(e){return e.incramentLine(),c(e)}function s(e,t){function n(e){var n=e+t;return n<0&&(n=0),n}console.log("Adding Row");var r,i=e.getDateString(),o=e.getLineEntry(),s={user:"readwrite",password:"readwrite",server:"sqldb1.wagstaff.com\\WAGENG",database:"WagEngineering"};return i?(console.log("Found Date String"),r=g.connect(s).then(function(){var e="select top 1 DailyMax from SolidworksLicUse where CAST(DateTime as DATE) = CAST ('"+i+"' as DATE) and Entrypoint = '"+o.entryPoint+"' order by LineNumber DESC";return console.log("Getting Daily Max"),(new g.Request).query(e)}).catch(u).then(function(e){var t;t=n(e&&0==e.length?0:parseInt(e[0].DailyMax)),o.dailyMax=t;var r="select * from SolidworksLicUse where DateTime = '"+o.dateTime.toISOString()+"' and EntryPoint = '"+o.entryPoint+"' and LineNumber = "+o.lineNumber;return console.log("Getting existing Row"),(new g.Request).query(r)}).catch(u).then(function(e){var t;if(0==e.length){console.log(o);var n="insert into SolidworksLicUse values ('"+o.dateTime.toISOString()+"','"+o.product+"','"+o.action+"','"+o.entryPoint+"','"+o.user+"','"+o.stringData+"',"+o.dailyMax+", "+o.lineNumber+" )";t=(new g.Request).query(n)}else console.log("Exists already"),t=h.resolve([]);return t}).catch(u).then(function(t){return a(e)}).catch(u)):(console.log("No Date String"),r=a(e)),r}function u(e){y=!1,console.error("Error was Caught. processing:"+y),"ECONNCLOSED"==e.code?setTimeout(function(){console.log("Done waiting")},3e3):console.error(e)}function c(e){console.log("Processing Line "+e.getLine());var t;if(e.isLastLine())e.setLine(e.getLogLength()),t=h.resolve(e);else switch(e.setLineData(),e.getLineType()){case"IN:":e.setLineEntry(new p.LoginLine(e.getLineParams())),t=s(e,1);break;case"TIMESTAMP":e.setLineEntry(new p.TimestampLine(e.getLineParams())),console.log("Setting Date to: "+e.getLineEntry().dateString),e.setDateString(e.getLineEntry().dateString),t=a(e);break;case"OUT:":e.setLineEntry(new p.LoginLine(e.getLineParams())),t=s(e,-1);break;default:t=a(e)}return t}function l(e){return console.log("Check File Exists"),new h(function(t,n){f.stat(e.getPath(),function(r,i){r&&n(r),t(e)})})}var h=n(72),f=n(43),p=n(157),d=n(158),g=n(118),m="\\\\wsepdm\\c$\\Program Files (x86)\\SolidWorks Corp\\SolidNetWork License Manager\\lmgrd.log",v=0,y=!1;t.init=r,t.catcher=u},function(e,t,n){e.exports=n(5).deprecate},function(e,t){e.exports=require("dgram")},function(e,t){e.exports=msnodesql},function(e,t){e.exports=msnodesqlv8},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("string_decoder")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("url")}]);
//# sourceMappingURL=server.js.map